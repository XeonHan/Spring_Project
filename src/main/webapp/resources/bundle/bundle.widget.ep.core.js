window.__define_resource&&__define_resource("MSG00140","LBL20232","LBL06491","LBL09601","LBL02042","LBL80303","BTN00373","BTN00390","BTN00168","LBL02265","LBL02244","LBL06157","BTN00122","MSG09174","MSG02605","MSG09175","MSG11182","MSG03961","MSG00205","MSG11095","LBL09363","LBL08306","LBL02490","MSG06861","MSG11093","LBL21020","LBL40237","LBL02432","MSG07635","LBL01870","LBL02939","LBL93407","LBL93415","LBL05100","LBL00271","BTN00027","LBL07534","LBL08780","LBL05860","MSG05608","MSG00213","MSG04732","MSG04735","MSG04730","MSG01497","LBL04838","LBL04839","LBL04840","LBL04841","LBL04388","MSG00061","LBL01664","MSG01712","MSG04023","MSG04686","MSG05460","MSG00710","MSG05441","LBL90003","MSG04707","LBL02660","LBL02253","MSG04733","LBL02717","MSG04479","MSG05833","LBL08794","LBL80058","LBL08902","LBL00856","LBL05930","LBL08903","LBL00182","BTN00054","LBL06765","LBL14150","LBL01155","BTN00316","BTN00487","LBL12578","LBL01625","LBL03146","LBL40265","LBL40266","LBL04842","LBL04785","LBL04808","LBL04809","LBL04810","LBL04811","LBL04812","LBL07080","MSG06141","LBL04906","MSG01088","LBL07973","LBL00329","LBL00752","LBL01296","LBL08885","LBL10800","LBL80098","LBL11137","MSG06331","BTN00063","BTN00033","LBL01070","MSG03152","MSG02529","MSG00299","LBL02468","LBL06192","LBL02586","LBL02358","LBL00672","LBL00409","LBL21878","LBL05395","LBL01459","LBL02219","LBL13224","LBL13166","LBL06862","MSG02033","BTN10007","MSG03151","MSG00751","LBL02839","MSG09954","MSG11317","MSG00295","MSG00202","MSG00429","MSG00184","LBL00578","BTN00028","LBL16314","LBL21052","LBL03616","LBL02690","LBL01241","LBL04665","LBL03684","LBL03615","LBL09533","LBL09534","LBL09561","LBL19397","LBL09029","LBL18478","BTN00973","LBL18541","LBL18540","LBL18290","LBL08150","LBL18285");widget.ep={};widget.ep._baseLoaded=!1;widget.ep._export=function(){return{_default:{controlType:"widget.ep",template:'<div class="grid-stack-item ui-draggable ui-resizable ui-resizable-autohide" data-gs-x="{{left}}" data-gs-y="{{top}}" data-gs-width="{{width}}" data-gs-height="{{height}}" data-gs-originheight="{{originHeight}}" data-gs-min-height="{{minHeight}}" ep-id="{{id}}"><div class="ep-loading hidden"><div class="rect1"><\/div><div class="rect2"><\/div><div class="rect3"><\/div><div class="rect4"><\/div><div class="rect5"><\/div><\/div><div class="grid-stack-item-content panel ui-draggable-handle {{collapsed}} {{panelCss}}" ><div class="panel-heading" data-value="titlefolding" data-function="click"><span class="widget-name">{{headerTitle}}<\/span><div class="widget-option"><div class="btn-group link-group">{{functionBtns}}<\/div>{{optionsLayer}}<\/div><\/div><div class="panel-body {{bodyViewFlag}}"><div>{{body}}<\/div><\/div>{{footer}}<\/div><\/div>',tableTemplate:'<table class="table table-hover table-striped table-layout-auto"><thead><tr>{{header}}<\/tr><\/thead><tbody>{{body}}<\/tbody><\/table>',requestForPermissionTemplate:["<div>"+ecount.resource.MSG00140+"<\/div>",'<div class="page page-fluid" style="display: block;">','<div class="wrapper-page-blocked">','<div id ="page-blocked-footer-Ath" class="page-blocked-footer">','<button class="btn btn-default btn-lg" type="button" data-function="click" data-value="authorizationRequest">'+ecount.resource.LBL20232+"<\/button>","<\/div>","<\/div>","<\/div>"].join("\n"),panelCss:"",functionBtnResource:{period:[ecount.resource.LBL06491,ecount.resource.LBL09601,ecount.resource.LBL02042,ecount.resource.LBL80303],"new":ecount.resource.BTN00373,move:ecount.resource.BTN00390},optionsLayerResource:{setting:ecount.resource.BTN00168,"delete":ecount.resource.LBL06157},_showOptionsLayer:!1,init:function(n){$.extend(this,n);this.callbackID=ecount.global.registerCallback(this.ecPageID,this.onMessage,this);this.eventID=ecount.common.uuid("event");this.bodyClickHandler=function(n){var t=$(n.target);this.$el.find(".btn-group.link-group").find(n.target).length<=0&&(this.hideDropdown(),this.$el.css("z-index",""))}.bind(this);n._timeoutOption&&(this._timeoutOption=n._timeoutOption);this.setEcPath();this.setEcIKey()},render:function(n){this.setAuthority();this.setBodyLoad();n.append(this.$el);this._needRequire?$.isArray(this._needRequire)?require.apply(window,this._needRequire.concat(this.afterRenderEl.bind(this))):require(this._needRequire,this.afterRenderEl.bind(this)):this.afterRenderEl()},afterRenderEl:function(){this.setUIAfterBodyLoad(this.epData);this.callBodyApi()},setAuthority:function(){var n=this;this._isDemo!==!0&&(this.epData.isBasic===!0&&this._optionsLayer.find(function(t,i){t==="delete"&&n._optionsLayer.splice(i,1)}),this.epData.allowed===!1&&(this._optionsLayer.find(function(t,i){t==="setting"&&n._optionsLayer.splice(i,1)}),this._functionBtns=[]))},setBodyLoad:function(){var n=this.epData,r=this.getTemplateFunctionBtns(this._functionBtns||["window","refresh","new"]),u=this.getTemplateOptionsLayer(this._optionsLayer||["setting","delete"]),t,i;t=n.allowed===!1?"<div><\/div>":this.getTemplateBody(n.body||{});i=ecount.widget.replaceAttr(this.template,{id:this.id,body:t||"",headerTitle:n.header.title,functionBtns:r,optionsLayer:u,collapsed:n.collapsed?"panel-collapsed":"",bodyViewFlag:n.collapsed?"hidden":"",panelCss:this.panelCss,top:n.top,left:n.left,width:n.width,height:n.collapsed?1:n.height,originHeight:n.originHeight||n.height,minHeight:n.collapsed?1:2,footer:this.getTemplateFooter(),iconHidden:n.collapsed?"hidden":""});this.$el=$(i);this.$periodLayer=this.$el.find("div#div-ep-period");this.$optionsLayer=this.$el.find("ul").last()},setUIAfterBodyLoad:function(n){n.collapsed==!0&&this.$el.find('[data-value="folding"]').text(this.optionsLayerResource.spread)},callBodyApi:function(n){var t={};$.isNull(n)||(this.id=n,this.name=n,this.$el&&this.$el.attr("ep-id",n));this._alwaysLoadByApi==!0&&this.id!=-1&&(t.WIDGET_SEQ=this.id,this.epData.EditFlag=="I"&&(t.IsIncludeEPInfo=!0),this.showLoadingbar(),t=$.extend(t,this.epData.param,this._searchApiParam),this._searchApiURL.toUpperCase().indexOf("/SVC/")!=-1&&(t={Request:{Data:t}}),ecount.common.api({ecPageID:this.ecPageID,isGMC:this._isGMC,url:this._searchApiURL,data:Object.toJSON(t),success:function(n){this.$el&&this.setBodyByApi&&this.setBodyByApi(n.Data)}.bind(this),error:function(n,t,i){$.isNull(this.controlType)||(this.hideLoadingbar(),this.showErrorNotice(!1,t,i))}.bind(this),timeout:this.getTimeoutOption(this.controlType).time}));this.$el&&$.each(this.$el.find("div.btn-group.link-group > a"),function(n,t){var i=!1,r="";$(t).hasClass("ep-refresh")?(i=!0,r=ecount.resource.BTN00122):$(t).hasClass("ep-new-post")?(i=!0,r=ecount.resource.BTN00373):$(t).hasClass("ep-new-window")&&(i=!0,r=ecount.resource.BTN00390);i&&bootstrapFunc.tooltip.call($(t).attr("data-toggle","tooltip").attr("data-original-title",r),{container:"body",placement:"left",trigger:"hover",delay:{show:ecount.common.mouseHoverInTime,hide:ecount.common.mouseHoverOutTime}})})},showErrorNotice:function(n,t,i){var r=!1,u=ecount.resource.MSG09174;if(t==="timeout"){console.log("timeout");this.showTimeCut();return}if(t==="noEpWidget"){console.log("noEpWidget");this.removeBody();this.$el.find("div.panel-body").append("<div class='notice-message'>"+ecount.resource.MSG02605+"<\/div>");return}if(i.Code==="EXP00001"){this._optionsLayer.find(function(n){n==="setting"&&(r=!0)});r&&(u=ecount.resource.MSG09175);this.removeBody();this.$el.find("div.panel-body").append("<div class='notice-message'>"+u+"<\/div>");return}if(n){ecount.popup.openWindow({url:"/ECERP/SVC/Popup/ErrorNotice",modal:!0,param:{Request:{ErrorList:[[{Errors:[i]}]]}},popupType:!1,additional:!0});return}},removeBody:function(){this.$el.find("div.panel-body").empty()},setBodyByApi:function(n,t){var i;this.epData.EditFlag=="I"||t==!0?($.extend(this.epData,n.options),this.$el.attr("ep-id",this.id),this.$el.find("span.widget-name").text(n.options.header.title)):this._searchApiURL.toUpperCase().indexOf("/SVC/")!=-1?$.extend(this.epData,n.options):$.extend(this.epData.body,{data:n});i=this.epData.gwUse==="C"?"<div>"+ecount.resource.MSG11182+"<\/div>":this.epData.gwUse==="U"?"<div>"+String.format(ecount.resource.MSG03961,"("+this.epData.header.title+")")+"<\/div>":this.epData.allowed===!1?this.requestForPermissionTemplate:$.isEmpty(this.epData.body)?"<div>"+ecount.resource.MSG00205+"<\/div>":!_.isEmpty(this.epData.formType)&&this.epData.isFormListEmpty?"<div>"+ecount.resource.MSG11095+"<\/div>":this.getTemplateBody(this.epData.body||{});this.$el.find("div.panel-body > div").empty().append(i);this.epData.EditFlag="M";this._refresh=!1;this.setUIAfterBodyLoad(this.epData);this.hideLoadingbar()},bodyDataConversion:function(n){var r=ecount.config.inventory,c=n.columns,l=n.data||[],f,e,u,t,a,o,s,v,i,y,h;for(config={AMT:ecount.config.company.DEC_AMT,ZERO_CHK:ecount.config.company.ZERO_CHK_YN,ZERO_DISPLAY:ecount.config.company.ZERO_DISPLAY_YN,C_Q:r.DEC_Q,C_U:r.ETC_DEC_UQ,C_P:r.DEC_P,C_PV:r.DEF_PRICE_VAT_DECIMAL_PLACE,C_D:r.DEC_DEFAULT},s=0,v=l.length;s<v;s++)for(u=l[s],i=0,y=c.length;i<y;i++)if(h=u["A"+i],$.isNull(h))u["A"+i]="";else{t=c[i];f=t.dataType.substr(0,1);switch(f){case"1":if(t.dataType.toUpperCase()==="1A")break;case"2":o={dataType:t.dataType};u["A"+i]=ecount.convertor.getDateValueByConvertor(h,o);break;case"8":case"9":e=config.AMT;t.dataType.length>=2?e=t.dataType.substr(1,2):t.decimalType&&t.decimalType!="A"&&(e=config["C_"+t.decimalType]);a=f+e;o=this.epData&&!this.epData.isFormListEmpty?{dataType:f+t.DataFormat,amtCalc:"r",isCheckZero:t.IsCheckZero,isShowIfZero:t.IsDisplayZero,thousandSeparator:t.ThousandSeparator,decimalSeparator:t.DecimalSeparator}:{dataType:a,amtCalc:"r",isCheckZero:config.ZERO_CHK,isShowIfZero:config.ZERO_DISPLAY};t.align="right";u["A"+i]=ecount.convertor.getDecimalValueByConvertor(h,o)}}return n},getTemplateBody:function(n){var i=this.bodyDataConversion(n),o=[],e=[],t,r,u,f;if(!$.isNull(i.columns))for(t=0;t<i.columns.length;t++)r=i.columns[t],t>0&&r.groupFlag!=i.columns[t-1].groupFlag&&o.unshift('<th colspan="'+t+'">'+this.getResourceByGroupflag(i.columns[t-1].groupFlag)+'<\/th><th colspan ="'+(i.columns.length-t)+'">'+this.getResourceByGroupflag(r.groupFlag)+"<\/th><\/tr><tr>"),o.push(ecount.widget.replaceAttr('<th class="{{css}}">{{title}}<\/th>',{title:r.title,css:r.css||""}));if(!$.isNull(i.data))for(t=0;t<i.data.length;t++){for(r=i.data[t],e.push("<tr>"),u=0;u<i.columns.length;u++)f=$.isNull(r["A"+u])?"&nbsp":r["A"+u],f=this.GetColumnLabel?this.GetColumnLabel(i.columns[u],f,t,r):f,e.push(ecount.widget.replaceAttr('<td class="{{css}}">{{cellValue}}<\/td>',{cellValue:this.getTagTemplate(i.columns[u],f,t),css:i.columns[u].align?"text-"+i.columns[u].align:""}));e.push("<\/tr>")}return ecount.widget.replaceAttr(this.tableTemplate,{header:o.join("")||"",body:e.join("")||""})},getResourceByGroupflag:function(n){return n==1?ecount.resource.LBL09363:n==2?ecount.resource.LBL08306:null},getBodyData:function(n,t){var r=_.get(this.getData(),"body.data"),i=_.isArray(r)&&_.isNumber(n)?r[n]:null;return i&&_.isArray(i[t])?i[t]:[]},createDropdownList:function(n){if(n&&!_.isEmpty(_.get(n,"items"))){var t=_.merge({type:"dropdown",hasDropdownLayerIcon:_.get(n,"hasDropdownLayerIcon")||!1,ecPageID:this.ecPageID,ownerKey:this.ecIKey,serviceKey:this.getLayerServiceKey(this),items:[],boundary:{},zIndex:9999},n);ecount.layer.show(t)}},createPopover:function(n,t){ecount.popover.create($(n),{html:!0,placement:"auto",title:t.popoverMessage,trigger:"hover",directShow:!0,type:"tooltip"})},getTemplateFooter:function(){return""},getTagTemplate:function(n,t,i){var r=n.tagType&&n.tagType.toUpperCase()=="LINK",u=this.IsUseTagTemplate&&this.IsUseTagTemplate(n,t,i);return r||u?'<a href="javascript:;" data-colCd="'+n.id+'" data-index="'+i+'" data-value="cellValue" data-function="click">'+t+"<\/a>":t},getTemplateFunctionBtns:function(n){for(var i,r=[],t=0,u=n.length;t<u;t++)n[t]=="period"?(i=this.functionBtnResource.period,r.push(['<div class="btn-group" id="div-ep-period">','<button class="btn btn-default btn-sm" type="button" data-function="click" data-value="periodOption">',this._periodRes?this._periodRes[this.TIME_CHART_TYPE]||i[0]:i[0],'<span class="caret"><\/span>',"<\/button>",'<ul class="dropdown-menu">','<li><a href="javascript:;" data-value="'+n[t]+'" data-function="click" data-periodValue="D">'+i[0]+"<\/a><\/li>",'<li><a href="javascript:;" data-value="'+n[t]+'" data-function="click" data-periodValue="W">'+i[1]+"<\/a><\/li>",'<li><a href="javascript:;" data-value="'+n[t]+'" data-function="click" data-periodValue="M">'+i[2]+"<\/a><\/li>",'<li><a href="javascript:;" data-value="'+n[t]+'" data-function="click" data-periodValue="L">'+i[3]+"<\/a><\/li>","<\/ul>","<\/div>"].join(""))):n[t]=="window"?r.push('<a class="ep-new-window" href="#" data-value="'+n[t]+'" data-function="click"><\/a>'):n[t]=="refresh"?r.push('<a class="ep-refresh'+(this.epData.collapsed?" hidden":"")+'" href="#" data-value="'+n[t]+'" data-function="click"><\/a>'):n[t]=="new"?r.push('<a class="ep-new-post" href="#" data-value="'+n[t]+'" data-function="click"><\/a>'):r.push('<button class="btn btn-default btn-sm" data-value="'+n[t]+'" data-function="click">'+this.functionBtnResource[n[t]]+"<\/button>");return r.join("")},getTemplateOptionsLayer:function(n){for(var r='<div class="btn-group link-group" data-value="option"data-function="click"><a href="javascript:;"><span class="ep-icon-more-vertical"  data-value="option"><\/span><\/a><ul class="dropdown-menu dropdown-menu-right">{{optionsLayer}}<\/ul><\/div>',i=[],t=0,u=n.length;t<u;t++)i.push('<li><a href="javascript:;" data-value="'+n[t]+'" data-function="click">'+this.optionsLayerResource[n[t]]+"<\/a><\/li>");return ecount.widget.replaceAttr(r,{optionsLayer:i.join("")})},getData:function(){return $.extend(this.epData,{collapsed:this.$el.find(".panel").hasClass("panel-collapsed"),left:this.$el.attr("data-gs-x"),top:this.$el.attr("data-gs-y"),width:this.$el.attr("data-gs-width"),height:this.$el.attr("data-gs-height"),originHeight:this.$el.attr("data-gs-originHeight")})},getMoveUrlInfo:function(){return $.extend({hidBodyUrl:this._movePageUrl},this._moveUrlInfo)},ON_CLICK_PERIOD:function(){this.$periodLayer.toggleClass("show")},ON_CLICK_NEW:function(){var n={url:this._newPageUrl,width:800,height:520};this._newPageUrl.toUpperCase().indexOf("/SVC/")>-1?(n.name=ecount.resource.LBL02490,n.Request={Data:{isAddGroup:!0},EditMode:ecenum.editMode.new,FromProgramId:"E040904",UIOption:{Width:800,Height:520,IsShowCloseButton:!0},OrderMgmtRequest:{STETOrderMode:"1"}}):(this._newPageUrl=="/ECERP/SVC/EBD/EBD010M_09"||this._newPageUrl=="/ECERP/SVC/EBD/EBD010M_10")&&$.extend(n,{Request:{Key:{Date:null,No:null},EditMode:ecenum.editMode.new,FromProgramId:"",UIOption:{Width:800,Height:600},TrxType:"40",SerNo:"01"}});this.openPopup(n)},ON_CLICK_MOVE:function(){var n=this.getMoveUrlInfo();ecount.runtime.changeMenu(n)},ON_CLICK_WINDOW:function(){var n={url:this._movePageUrl,width:800,height:600};this.openPopup(n)},ON_CLICK_REFRESH:function(){if(this._refresh){ecount.alert(ecount.resource.MSG06861);return}this._refresh=!0;this.reload()},ON_CLICK_OPTION:function(){if(this.$optionsLayer.toggleClass("show"),this._showOptionsLayer==!1){$(this.eventContainer||document).on("mousedown."+this.eventID,this.bodyClickHandler);this._showOptionsLayer=!0;this.$el.css("z-index",2)}},ON_CLICK_SETTING:function(){!_.isEmpty(this.epData.formType)&&this.epData.isFormListEmpty?ecount.alert(ecount.resource.MSG11093):this.openPopup({url:this._settingUrl,width:500,height:550,epPopup:!1,widgetSeq:this.id});this.hideDropdown()},ON_CLICK_FOLDING:function(){var n=this.$el.data("_gridstack_node"),t=this.$el.find(".panel").eq(0);t.toggleClass("panel-collapsed");t.hasClass("panel-collapsed")?(this.$el.find('[data-value="folding"]').text(this.optionsLayerResource.spread),n.minHeight=1,this.$el.attr("data-gs-min-height",1),this.epData.collapsed=!0):(this.$el.find('[data-value="folding"]').text(this.optionsLayerResource.folding),n.minHeight=2,this.$el.attr("data-gs-min-height",2),this.epData.collapsed=!1);this.hideDropdown();this.containerDelegator&&this.containerDelegator.triggerEvent("dropdown.click",{targetID:this.id,control:this,type:"epFold"})},ON_CLICK_TITLEFOLDING:function(n){var t=this.$el.data("_gridstack_node"),i=this.$el.find(".panel").eq(0);i.toggleClass("panel-collapsed");$(n).find(".widget-option > div:eq(0)").find("[data-value=refresh]").toggleClass("hidden");i.hasClass("panel-collapsed")?(t.minHeight=1,this.$el.attr("data-gs-min-height",1),this.epData.collapsed=!0):(t.minHeight=2,this.$el.attr("data-gs-min-height",2),this.epData.collapsed=!1,this.reload());this.containerDelegator&&this.containerDelegator.triggerEvent("dropdown.click",{targetID:this.id,control:this,type:"epFold"})},ON_CLICK_DELETE:function(){this.$periodLayer=null;this.$optionsLayer=null;$(this.eventContainer||document).unbind("mousedown",this.bodyClickHandler,!1);this.containerDelegator&&this.containerDelegator.triggerEvent("dropdown.click",{targetID:this.id,control:this,type:"epDelete"});this.destroy()},ON_CLICK_CELLVALUE:function(n){var t=Number($(n).attr("data-index")),i=$(n).attr("data-colCd"),r={columns:this.epData.body.columns,data:this.epData.body.data[t],colCd:i,text:$(n).text()};this.OpenLinkPopup&&this.OpenLinkPopup(r)},ON_CLICK_AUTHORIZATIONREQUEST:function(){var n=this,i=ecount.global.findViewBag(this.ecPageID),t=i.InitDatas["epData.memoSign"],r={Data:{RQST_TYPCD:"M",InsertData:[{MenuName:n.epData.header.title,RQST_TGT_ID:n.epData.prgId,PermitAction:ecount.resource.LBL21020,ATHT_CD:"AC001"}]},WIDGET_ID:n.epData.epType,masterInfo_ID:t.ID||"",masterInfo_Name:t.UNAME||"",epMenu:n.epData.header.title};n.showProgressbar(!0);this.openPopup({url:"/ECERP/SVC/EMM/EMM016P_02",name:ecount.resource.LBL40237,width:"450",height:"400",Request:r,alreadyIncludedLayout:!0,isOnlyCloseBtn:!0,additional:!0})},hideDropdown:function(){this._showOptionsLayer&&(this._showOptionsLayer=!1,this.$el.find("ul.dropdown-menu").removeClass("show"),$(this.eventContainer||document).unbind("mousedown."+this.eventID,this.bodyClickHandler))},openPopup:function(n){var t=this,i;t.defaultParam&&t.defaultParam.ProgramId==undefined&&this.ResetDefaultParam&&this.ResetDefaultParam();i=$.extend({},t.defaultParam,{width:n.width,height:n.height,name:(n.popupType===!0?n.id:n.subTitle)||"",url:n.url,popupType:n.popupType===!0,epPopup:n.epPopup,widgetSeq:n.widgetSeq,responseID:n.responseID||t.callbackID,isEPWidget:!0,isSaveOnly:!0,isOnlyCloseBtn:n.isOnlyCloseBtn?n.isOnlyCloseBtn:!1,notSubmitWindowOpen:n.notSubmitWindowOpen,Request:n.Request});n&&n.menu_seq&&(i.menu_seq=n.menu_seq);(n&&n.PRG_ID||n&&n.prg_id)&&(i.PRG_ID=n.PRG_ID||n.prg_id);n&&n.boardId&&(i.boardId=n.boardId);n&&n.tabFlag&&(i.tabFlag=n.tabFlag);n&&n.strBoardId&&(i.strBoardId=n.strBoardId);n&&n.param&&n.param.RPT_GUBUN&&(i.RPT_GUBUN=n.param.RPT_GUBUN);t.delegator&&(t.containerDelegator&&t.containerDelegator.triggerEvent("epType.save",{popupType:i.popupType,targetID:t.id,control:t,controlType:t.controlType}),this.delegator.triggerEvent("control.openPopup",{targetID:t.id,control:t,parameter:i,handler:function(i,r,u,f){var s,o,e;t.responseID=r;i.popupLevel=f;i.parentPageID=u||t.parentPageID;i.__ecPageID=t.ecPageID;s=i.modal||this._modal;o=i.additional;delete i.modal;delete i.additional;e={url:i.url,name:i.name||"",param:i,popupType:i.popupType,popupID:t.ecPageID,modal:i.modal,control:{ctype:t.controlType,name:t.subTitle,id:t.id},popupLevel:f,parentPageID:i.parentPageID,alreadyIncludedLayout:t.alreadyIncludedLayout||!1,additional:o,epPopup:i.epPopup,widgetSeq:i.widgetSeq,isEPWidget:i.isEPWidget,isSaveOnly:i.isSaveOnly,isChangePopupType:i.isChangePopupType,notSubmitWindowOpen:i.notSubmitWindowOpen,isOnlyCloseBtn:i.isOnlyCloseBtn};n.isV5&&(e={isV5:!0,identifier:n.identifier,param:n.param,reqData:n.reqData,width:n.width,height:n.height,popupType:n.popupType,popupLevel:f,responseMessageID:r});ecount.popup.openWindow(e);t.defaultParam={}}}))},onMessage:function(n,t){this.reload();t.callback&&t.callback()},reload:function(){var n=this;n.showLoadingbar();n.containerDelegator&&n.containerDelegator.triggerEvent("reload.ep",{targetID:n.id,control:n,controlType:n.controlType,type:"epReload"})},showLoadingbar:function(){this.$el&&(this.$el.find("div.panel-body").children().addClass("hidden"),this.$el.find("div.ep-loading").removeClass("hidden"))},hideLoadingbar:function(){this.$el&&(this.$el.find("div.panel-body").children().removeClass("hidden"),this.$el.find("div.ep-loading").addClass("hidden"))},showTimeCut:function(){if(this.$el){var n=this.getTimeoutOption(this.controlType).message;this.removeBody();this.$el.find("div.panel-body").append("<div class='notice-message'>"+n+"<\/div>")}},getTimeoutOption:function(n){var t={time:3e3,message:ecount.resource.MSG09175};switch(n){case"widget.ep.customers":case"widget.ep.products":case"widget.ep.emailList":case"widget.ep.flowChart":t.time=0;break;case"widget.ep.memo":case"widget.ep.messageBox":case"widget.ep.training":case"widget.ep.upgradeDetails":case"widget.ep.tutorial":t.message=ecount.resource.MSG09174}return this._timeoutOption&&_.isPlainObject(this._timeoutOption)&&(_.isNil(this._timeoutOption.time)||(t.time=this._timeoutOption.time),_.isNil(this._timeoutOption.message)||(t.message=this._timeoutOption.message)),t},showProgressbar:function(){this.delegator&&this.delegator.triggerEvent("progressbar.show")},hideProgressbar:function(){this.delegator&&this.delegator.triggerEvent("progressbar.hide")}},"=== SAMPLE ===":{controlType:"widget.ep.balance",subTitle:ecount.resource.LBL02432,_alwaysLoadByApi:!0,_isGMC:!0,_searchApiURL:"",_searchApiParam:{},_menuType:"4",_menuSeq:"35",_newPageUrl:"",_movePageUrl:"",_settingUrl:"/ECERP/Popup.Search/CM004P",_functionBtns:["move"],_optionsLayer:["setting","delete"],_decimalGroup:"C",_needRequire:"widget-ep-require",_moveUrlInfo:{menuType:"4",menuSeq:"212",subMenu:"M040700000000",subMenuSeq:"212"}},balance:{controlType:"widget.ep.balance",subTitle:ecount.resource.LBL02432,_alwaysLoadByApi:!0,_searchApiURL:"/Service/EP/GetListInventoryBalanceForWidget",_searchApiParam:{},_menuType:"4",_menuSeq:"35",_newPageUrl:"",_movePageUrl:"/ECERP/SVC/ESZ/ESZ001R",_settingUrl:"/ECERP/ECP/ECP001P_02",_functionBtns:["window","refresh"],_optionsLayer:["setting","delete"],_decimalGroup:"C",_moveUrlInfo:{menuType:"4",menuSeq:"212",subMenu:"M040700000000",subMenuSeq:"212"},_needRequire:"widget-ep-require",setBodyByApi:function(n,t){var i;this.epData.EditFlag=="I"||t==!0?($.extend(this.epData,n.options),this.$el.attr("ep-id",this.id),this.$el.find("span.widget-name").text(n.options.header.title)):$.extend(this.epData,n.options);i=this.epData.allowed===!1?this.requestForPermissionTemplate:$.isEmpty(this.epData.body)?"<div>"+ecount.resource.MSG00205+"<\/div>":ecount.config.inventory.USE_INVENTORY_BASIC_DATE&&ecount.control.date.compareDate(ecount.control.date.strToDate(ecount.config.inventory.INVENTORY_BASIC_DATE),ecount.control.date.serverDate(this.ecPageID).addDays(-this.epData.param.TO_DAYS))?"<div>"+String.format(ecount.resource.MSG07635,"")+"<\/div>":!_.isEmpty(this.epData.formType)&&this.epData.isFormListEmpty?"<div>"+ecount.resource.MSG11095+"<\/div>":this.getTemplateBody(this.epData.body||{});this.$el.find("div.panel-body > div").empty().append(i);this.epData.EditFlag="M";this._refresh=!1;this.setUIAfterBodyLoad(this.epData);this.hideLoadingbar()},GetColumnLabel:function(n,t,i){switch(n.id){case"PRO_REL_INFO":return ecount.resource.LBL01870;case"#tmp.serial":return i+1;default:return t}},IsUseTagTemplate:function(n){return["#tmp.prod_cd","sale003.prod_des","sale003.prod_cd","PRO_REL_INFO"].contains(n.id)},OpenLinkPopup:function(n){var u="",s=this.epData.param.TERM_TYPE,r=new Date,e,t,i,o;switch(s){case"0":r=r.addDays(-this.epData.param.TO_DAYS);break;case"1":r=r.addDays(-1)}var f=r.format("yyyy-MM-")+"01",h=f.toDate().addMonths(-3);if(f=h.format("yyyy-MM-dd"),e=this.epData.param.BUSINESS_NO,t={},_.isEmpty(e)==!1){i=e.split(ecount.delimiter);o=i.splice(0,1)[0];["B","I"].indexOf(i.last())>-1&&(t.PROD_CVS_TYPE=i.splice(-1)[0]);switch(o){case"1":t.PROD_CLASS_CD1=i.join(ecount.delimiter);break;case"2":t.PROD_CLASS_CD2=i.join(ecount.delimiter);break;case"3":t.PROD_CLASS_CD3=i.join(ecount.delimiter);break;case"4":t.WH_CD=i.join(ecount.delimiter)}}switch(n.colCd){case"#tmp.prod_cd":case"sale003.prod_des":case"sale003.prod_cd":u="/ECERP/SVC/ESZ/ESZ003R";this.defaultParam={width:890,height:600,Request:{Data:{BASE_DATE_FROM:f,BASE_DATE_TO:r.format("yyyy-MM-dd"),PROD_CD:n.data.PROD_CD,PROD_DES:n.data.PROD_DES,PROD_CLASS_CD1:t.PROD_CLASS_CD1,PROD_CLASS_CD2:t.PROD_CLASS_CD2,PROD_CLASS_CD3:t.PROD_CLASS_CD3,WH_CD:t.WH_CD,PROD_CVS_TYPE:t.PROD_CVS_TYPE,MAIN_PROD_CD_YN:"N",BAL_FLAG:"N",PRODDES_ORD:"0",ZERO_FLAG:"0",MOVESTORE_FLAG:"1"},IsFromLink:!0}};break;case"PRO_REL_INFO":u="/ECERP/SVC/ESZ/ESZ025R";this.defaultParam={Request:{PROD_CD:n.data.PROD_CD,PROD_DES:n.data.PROD_DES,WidgetValue:{WIDGET_VALUE:{txtClassCd1:t.PROD_CLASS_CD1,txtClassCd2:t.PROD_CLASS_CD2,txtClassCd3:t.PROD_CLASS_CD3,txtSWhCd:t.WH_CD}},IsFromLink:!0}}}_.isEmpty(u)||this.openPopup({url:u,name:""})}},inventory:{controlType:"widget.ep.inventory",subTitle:ecount.resource.LBL02939,_alwaysLoadByApi:!0,_searchApiURL:"/SVC/Common/SlipTransfer/GetEPStatusXFormSlipCommon",_searchApiParam:{MENU_SEQ:494,DATA_KEY:"IO_DATE",DATA_NO:"IO_NO",WriteDateColNm:"SELL.WRITE_DT",EditDateColNm:"SELL.WDATE"},_menuType:"4",_menuSeq:"35",_newPageUrl:"/ECERP/SVC/ESD/ESD006M",_movePageUrl:"/ECERP/SVC/ESG/ESG011R",_settingUrl:"/ECERP/ECP/ECP001P_01",_functionBtns:["window","refresh","new"],_optionsLayer:["setting","delete"],_decimalGroup:"S",_moveUrlInfo:{menuType:"4",menuSeq:"494",subMenu:"M040205010000",subMenuSeq:"494"},IsUseTagTemplate:function(n){return["SELL_D.io_date_no","SELL_D.io_date","MAKE_D.io_date","MAKE_D.io_date_no","sale030.req_date","sale030.req_date_no","SELL_D.req_date","SELL_D.req_date_no"].contains(n.id)},GetColumnLabel:function(n,t,i){switch(n.id){case"SELL_D.io_date_no":case"SELL_D.io_date":case"MAKE_D.io_date":case"MAKE_D.io_date_no":case"sale030.req_date":case"sale030.req_date_no":case"SELL_D.req_date":case"SELL_D.req_date_no":return ecount.convertor.dataTypeConvertor.date(t,{dataType:"Date10"});case"SELL_D.serial":return i+1;default:return t}},OpenLinkPopup:function(n){var t="";switch(n.colCd){case"SELL_D.io_date_no":case"SELL_D.io_date":case"MAKE_D.io_date":case"MAKE_D.io_date_no":t="/ECERP/SVC/ESD/ESD006M";this.defaultParam={Request:{Key:{Date:n.data.IO_DATE,No:n.data.IO_NO},EditMode:ecenum.editMode.modify,FromProgramId:"E040207",PrevUrl:"/ECERP/ECP/ECP001M",UIOption:{Width:800,Height:700}},width:800,height:700};break;case"sale030.req_date":case"sale030.req_date_no":case"SELL_D.req_date":case"SELL_D.req_date_no":t="/ECERP/SVC/ESD/ESD004M";this.defaultParam={Request:{Key:{Date:n.data.REQ_DATE,No:n.data.REQ_NO},EditMode:ecenum.editMode.modify,FromProgramId:"E040208",PrevUrl:"/ECERP/ECP/ECP001M",UIOption:{Width:800,Height:780,FocusRowNumber:1}}}}_.isEmpty(t)||this.openPopup({url:t,name:""})}},outstandingSO:{controlType:"widget.ep.outstandingSO",subTitle:"미판매현황",_alwaysLoadByApi:!0,_searchApiURL:"/SVC/Service/EP/GetEPStatusXFormUnsoldCommon",_searchApiParam:{MENU_SEQ:578,DATA_KEY:"REQ_DATE",DATA_NO:"REQ_NO",WriteDateColNm:"SALE030.WRITE_DT",EditDateColNm:"SALE030.UPDATE_DATE"},_menuType:"4",_menuSeq:"35",_newPageUrl:"/ECERP/SVC/ESD/ESD006M",_movePageUrl:"/ECERP/SVC/ESD/ESD018R",_settingUrl:"/ECERP/ECP/ECP001P_06",_functionBtns:["window","refresh","new"],_optionsLayer:["setting","delete"],_decimalGroup:"S",_moveUrlInfo:{menuType:"4",menuSeq:"499",subMenu:"M040205060000",subMenuSeq:"499"},_slipPath:{Y:["Y","N"],C:["C","Y","N"],Z:[],N:["Y","N"]},_parentMenuCds:[60,30],IsUseTagTemplate:function(n){return["sale030.req_date_no","sale030.req_date","sale030.p_flag_val"].contains(n.id)},GetColumnLabel:function(n,t,i){switch(n.id){case"sale030.req_date_no":case"sale030.req_date":return ecount.convertor.dataTypeConvertor.date(t,{dataType:"Date10"});case"sale031.serial":return i+1;default:return t}},isShowSlipTypeFromTabId:function(n,t){var i=!1;return _.isEmpty(t)?i:(this._slipPath[t].contains(ecount.constValue.stateCodeMap[n])&&(i=!0),i)},ON_CLICK_CELLVALUE:function(n){var o=Number($(n).attr("data-index")),y=$(n).attr("data-colCd"),r={columns:this.epData.body.columns,data:this.epData.body.data[o],colCd:y,text:$(n).text()},t,f,e,u,v;switch(r.colCd){case"sale030.req_date_no":case"sale030.req_date":this.defaultParam={Request:{Key:{Date:r.data.REQ_DATE,No:r.data.REQ_NO},EditMode:ecenum.editMode.modify,FromProgramId:"E040211",PrevUrl:"/ECERP/ECP/ECP001M",UIOption:{Width:800,Height:780,FocusRowNumber:r.data.SER_NO||1}}};this.openPopup({url:"/ECERP/SVC/ESD/ESD004M",name:""});break;case"sale030.p_flag_val":if(t=r.data,t.GB_TYPE!="Z"&&_.isArray(t.STATE_CODES)&&t.STATE_CODES.length>0){var s=ecmodule.common.page.mappingListTabForm(t.STATE_CODES),h=s.filter(function(n){return n.tabId!=ecount.constValue.stateTabIdMap.C&&n.parentMenuCd==0&&n.tabGroup!="3"&&this.isShowSlipTypeFromTabId(n.tabId,t.GB_TYPE)&&n.sort>0},this),c=[],l=[];for(f=0;f<h.length;f++){var i=h[f],p=String.format("Option_{0}",i.menuCd),a=s.filter(function(n){return ecount.constValue.stateParentMenuCdMap[t.GB_TYPE]==i.menuCd?n.parentMenuCd==i.menuCd&&n.stateCode!=t.P_FLAG&&n.canUse==!0&&this._parentMenuCds.contains(n.parentMenuCd)&&n.sort>0&&t.GB_TYPE=="Y":n.parentMenuCd==i.menuCd&&n.canUse==!0&&this._parentMenuCds.contains(n.parentMenuCd)&&n.sort>0},this).sort(function(n,t){return n.sort-t.sort});for(e=0;e<a.length;e++)u=a[e],v=String.format("{0}_{1}",p,u.menuCd),c.push({id:v,label:String.format("{0}",u.tabName),value:i.tabId+ecount.delimiter+o+ecount.delimiter+u.stateCode+ecount.delimiter+u.stateName,group:i.tabName}),l.push(i.tabName)}this.createDropdownList({baseType:!0,boundary:ec$.getZoomedBoundary(n),openGroup:l,items:c,showingUpDelay:10})}}},ON_CLICK_SERVICE:function(n,t,i,r){var u=n.ecFunctionId;r.command=_.camelCase("on_dropdown_progressStatus")}},purchase:{controlType:"widget.ep.purchase",subTitle:"구매현황",_alwaysLoadByApi:!0,_searchApiURL:"/SVC/Common/SlipTransfer/GetEPStatusXFormSlipCommon",_searchApiParam:{MENU_SEQ:513,DATA_KEY:"IO_DATE",DATA_NO:"IO_NO",WriteDateColNm:"BUY.WRITE_DT",EditDateColNm:"BUY.WDATE"},_menuType:"4",_menuSeq:"35",_newPageUrl:"/ECERP/SVC/ESG/ESG009M",_movePageUrl:"/ECERP/SVC/ESG/ESG028R",_settingUrl:"/ECERP/ECP/ECP001P_13",_functionBtns:["window","refresh","new"],_optionsLayer:["setting","delete"],_decimalGroup:"P",_moveUrlInfo:{menuType:"4",menuSeq:"513",subMenu:"M040306010000",subMenuSeq:"513"},IsUseTagTemplate:function(n){return["BUY_D.io_date_no","BUY_D.io_date","MAKE_D.io_date","MAKE_D.io_date_no"].contains(n.id)},GetColumnLabel:function(n,t,i){switch(n.id){case"BUY_D.io_date_no":case"BUY_D.io_date":case"MAKE_D.io_date":case"MAKE_D.io_date_no":return ecount.convertor.dataTypeConvertor.date(t,{dataType:"Date10"});case"BUY_D.serial":return i+1;default:return t}},OpenLinkPopup:function(n){var t="";switch(n.colCd){case"BUY_D.io_date_no":case"BUY_D.io_date":case"MAKE_D.io_date":case"MAKE_D.io_date_no":t="/ECERP/SVC/ESG/ESG009M";this.defaultParam={Request:{Key:{Date:n.data.IO_DATE,No:n.data.IO_NO},EditMode:ecenum.editMode.modify,FromProgramId:"E040305",PrevUrl:"/ECERP/ECP/ECP001M",UIOption:{Width:920,Height:640,FocusRowNumber:n.data.SER_NO||1}}}}_.isEmpty(t)||this.openPopup({url:t,name:""})}},outstandingPO:{controlType:"widget.ep.outstandingPO",subTitle:"미입력현황",_alwaysLoadByApi:!0,_searchApiURL:"/SVC/Service/EP/GetEPStatusXFormUnsoldCommon",_searchApiParam:{DATA_KEY:"ORD_DATE",DATA_NO:"ORD_NO",WriteDateColNm:"SALE040.WRITE_DT",EditDateColNm:"SALE040.UPDATE_DATE"},_menuType:"4",_menuSeq:"35",_newPageUrl:"/ECERP/SVC/ESG/ESG009M",_movePageUrl:"/ECERP/SVC/ESD/ESD018R",_settingUrl:"/ECERP/ECP/ECP001P_05",_functionBtns:["window","refresh","new"],_optionsLayer:["setting","delete"],_decimalGroup:"P",_moveUrlInfo:{menuType:"4",menuSeq:"516",subMenu:"M040306040000",subMenuSeq:"516"},defaultParam:{ProgramId:"E040307"},_slipPath:{Y:["Y","N"],C:["C","Y","N"],Z:[],N:["Y","N"]},_parentMenuCds:[60,30],IsUseTagTemplate:function(n){return["sale040.ord_date","sale040.ord_date_no","sale040.p_flag_val"].contains(n.id)},ResetDefaultParam:function(){this.defaultParam=_.merge(this.defaultParam,{ProgramId:"E040307"})},GetColumnLabel:function(n,t,i){var r=this.epData.body.data[i];switch(n.id){case"sale040.ord_date":case"sale040.ord_date_no":return ecount.convertor.dataTypeConvertor.date(t,{dataType:"Date10"});case"sale041.serial":return i+1;case"sale041.qty_unit":return $.isNull(r.UNIT)?t:String.format("{0}{1}",t,r.UNIT);default:return t}},isShowSlipTypeFromTabId:function(n,t){var i=!1;return _.isEmpty(t)?i:(this._slipPath[t].contains(ecount.constValue.stateCodeMap[n])&&(i=!0),i)},ON_CLICK_CELLVALUE:function(n){var o=Number($(n).attr("data-index")),y=$(n).attr("data-colCd"),r={columns:this.epData.body.columns,data:this.epData.body.data[o],colCd:y,text:$(n).text()},t,f,e,u,v;switch(r.colCd){case"sale040.ord_date":case"sale040.ord_date_no":this.defaultParam={Request:{Key:{Date:r.data.ORD_DATE,No:r.data.ORD_NO},EditMode:ecenum.editMode.modify,FromProgramId:"E040307",PrevUrl:"/ECERP/ECP/ECP001M",UIOption:{Width:920,Height:800,FocusRowNumber:r.data.SER_NO||1}}};this.openPopup({url:"/ECERP/SVC/ESG/ESG004M",name:""});break;case"sale040.p_flag_val":if(t=r.data,t.GB_TYPE!="Z"&&_.isArray(t.STATE_CODES)&&t.STATE_CODES.length>0){var s=ecmodule.common.page.mappingListTabForm(t.STATE_CODES),h=s.filter(function(n){return n.tabId!=ecount.constValue.stateTabIdMap.C&&n.parentMenuCd==0&&n.tabGroup!="3"&&this.isShowSlipTypeFromTabId(n.tabId,t.GB_TYPE)&&n.sort>0},this),c=[],l=[];for(f=0;f<h.length;f++){var i=h[f],p=String.format("Option_{0}",i.menuCd),a=s.filter(function(n){return ecount.constValue.stateParentMenuCdMap[t.GB_TYPE]==i.menuCd?n.parentMenuCd==i.menuCd&&n.stateCode!=t.P_FLAG&&n.canUse==!0&&this._parentMenuCds.contains(n.parentMenuCd)&&n.sort>0&&t.GB_TYPE=="Y":n.parentMenuCd==i.menuCd&&n.canUse==!0&&this._parentMenuCds.contains(n.parentMenuCd)&&n.sort>0},this).sort(function(n,t){return n.sort-t.sort});for(e=0;e<a.length;e++)u=a[e],v=String.format("{0}_{1}",p,u.menuCd),c.push({id:v,label:String.format("{0}",u.tabName),value:i.tabId+ecount.delimiter+o+ecount.delimiter+u.stateCode+ecount.delimiter+u.stateName,group:i.tabName}),l.push(i.tabName)}this.createDropdownList({baseType:!0,boundary:ec$.getZoomedBoundary(n),openGroup:l,items:c,showingUpDelay:10})}}},ON_CLICK_SERVICE:function(n,t,i,r){var u=n.ecFunctionId;r.command=_.camelCase("on_dropdown_progressStatus")}},pendingShipmentStatus:{controlType:"widget.ep.pendingShipmentStatus",subTitle:"미출하현황",_alwaysLoadByApi:!0,_searchApiURL:"/SVC/Service/EP/GetEPStatusXFormUnsoldCommon",_searchApiParam:{DATA_KEY:"OUT_DATE",DATA_NO:"OUT_NO",WriteDateColNm:"OUTORDER.WRITE_DT",EditDateColNm:"OUTORDER.EDIT_DT"},_menuType:"4",_menuSeq:"35",_newPageUrl:"/ECERP/SVC/ESE/ESE004M",_movePageUrl:"/ECERP/SVC/ESD/ESD018R",_settingUrl:"/ECERP/ECP/ECP001P_07",_functionBtns:["window","refresh","new"],_optionsLayer:["setting","delete"],_decimalGroup:"S",_moveUrlInfo:{menuType:"4",menuSeq:"779",subMenu:"M040205140000",subMenuSeq:"779"},_slipPath:{Y:["Y","N"],C:["C","Y","N"],Z:[],N:["Y","N"]},_parentMenuCds:[60,30],defaultParam:{ProgramId:"E040228"},IsUseTagTemplate:function(n){return["out_d.out_date","out_d.out_date_no","outorder.p_flag_val"].contains(n.id)},ResetDefaultParam:function(){this.defaultParam=_.merge(this.defaultParam,{ProgramId:"E040228"})},GetColumnLabel:function(n,t,i){var r=this.epData.body.data[i];switch(n.id){case"out_d.out_date":case"out_d.out_date_no":return ecount.convertor.dataTypeConvertor.date(t,{dataType:"Date10"});case"out_d.qty_unit":return $.isNull(r.UNIT)?t:String.format("{0}{1}",t,r.UNIT);case"out_d.serial":return i+1;default:return t}},isShowSlipTypeFromTabId:function(n,t){var i=!1;return _.isEmpty(t)?i:(this._slipPath[t].contains(ecount.constValue.stateCodeMap[n])&&(i=!0),i)},ON_CLICK_CELLVALUE:function(n){var o=Number($(n).attr("data-index")),y=$(n).attr("data-colCd"),r={columns:this.epData.body.columns,data:this.epData.body.data[o],colCd:y,text:$(n).text()},t,f,e,u,v;switch(r.colCd){case"out_d.out_date":case"out_d.out_date_no":this.defaultParam={Request:{Key:{Date:r.data.OUT_DATE,No:r.data.OUT_NO},EditMode:ecenum.editMode.modify,FromProgramId:"E040205",PrevUrl:"/ECERP/ECP/ECP001M",UIOption:{Width:800,Height:780,FocusRowNumber:r.data.SER_NO||1}}};this.openPopup({url:"/ECERP/SVC/ESE/ESE001M",name:""});break;case"outorder.p_flag_val":if(t=r.data,t.GB_TYPE!="Z"&&_.isArray(t.STATE_CODES)&&t.STATE_CODES.length>0){var s=ecmodule.common.page.mappingListTabForm(t.STATE_CODES),h=s.filter(function(n){return n.tabId!=ecount.constValue.stateTabIdMap.C&&n.parentMenuCd==0&&n.tabGroup!="3"&&this.isShowSlipTypeFromTabId(n.tabId,t.GB_TYPE)&&n.sort>0},this),c=[],l=[];for(f=0;f<h.length;f++){var i=h[f],p=String.format("Option_{0}",i.menuCd),a=s.filter(function(n){return ecount.constValue.stateParentMenuCdMap[t.GB_TYPE]==i.menuCd?n.parentMenuCd==i.menuCd&&n.stateCode!=t.P_FLAG&&n.canUse==!0&&this._parentMenuCds.contains(n.parentMenuCd)&&n.sort>0&&t.GB_TYPE=="Y":n.parentMenuCd==i.menuCd&&n.canUse==!0&&this._parentMenuCds.contains(n.parentMenuCd)&&n.sort>0},this).sort(function(n,t){return n.sort-t.sort});for(e=0;e<a.length;e++)u=a[e],v=String.format("{0}_{1}",p,u.menuCd),c.push({id:v,label:String.format("{0}",u.tabName),value:i.tabId+ecount.delimiter+o+ecount.delimiter+u.stateCode+ecount.delimiter+u.stateName,group:i.tabName}),l.push(i.tabName)}this.createDropdownList({baseType:!0,boundary:ec$.getZoomedBoundary(n),openGroup:l,items:c,showingUpDelay:10})}}},ON_CLICK_SERVICE:function(n,t,i,r){var u=n.ecFunctionId;r.command=_.camelCase("on_dropdown_progressStatus")}},issue:{controlType:"widget.ep.issue",subTitle:"생산불출현황",_alwaysLoadByApi:!0,_searchApiURL:"/SVC/Common/SlipTransfer/GetEPStatusXFormSlipCommon",_searchApiParam:{MENU_SEQ:533,DATA_KEY:"IO_DATE",DATA_NO:"IO_NO",WriteDateColNm:"ISSUE.write_dt",EditDateColNm:"ISSUE.wdate"},_menuType:"4",_menuSeq:"35",_newPageUrl:"/ECERP/SVC/ESJ/ESJ006M",_movePageUrl:"/ECERP/SVC/ESJ/ESJ016R",_settingUrl:"/ECERP/ECP/ECP001P_04",_functionBtns:["window","refresh","new"],_optionsLayer:["setting","delete"],_decimalGroup:"C",_moveUrlInfo:{menuType:"4",menuSeq:"533",subMenu:"M040406030000",subMenuSeq:"533"},IsUseTagTemplate:function(n){return["ISSUE_D.io_date","ISSUE_D.io_date_no"].contains(n.id)},GetColumnLabel:function(n,t,i){switch(n.id){case"ISSUE_D.io_date":case"ISSUE_D.io_date_no":return ecount.convertor.dataTypeConvertor.date(t,{dataType:"Date10"});case"ISSUE_D.serial":return i+1;default:return t}},OpenLinkPopup:function(n){var t="";switch(n.colCd){case"ISSUE_D.io_date":case"ISSUE_D.io_date_no":t="/ECERP/SVC/ESJ/ESJ006M";this.defaultParam={Request:{Key:{Date:n.data.IO_DATE,No:n.data.IO_NO},EditMode:ecenum.editMode.modify,FromProgramId:"E040405",PrevUrl:"/ECERP/ECP/ECP001M",UIOption:{Width:800,Height:780,FocusRowNumber:n.data.SER_NO||1}}}}_.isEmpty(t)||this.openPopup({url:t,name:""})}},receipt:{controlType:"widget.ep.receipt",subTitle:"생산입고현황",_alwaysLoadByApi:!0,_searchApiURL:"/SVC/Common/SlipTransfer/GetEPStatusXFormSlipCommon",_searchApiParam:{MENU_SEQ:534,DATA_KEY:"IO_DATE",DATA_NO:"IO_NO",WriteDateColNm:"MAKE.write_dt",EditDateColNm:"MAKE.wdate"},_menuType:"4",_menuSeq:"35",_newPageUrl:"/ECERP/SVC/ESJ/ESJ009M",_movePageUrl:"/ECERP/SVC/ESJ/ESJ025R",_settingUrl:"/ECERP/ECP/ECP001P_03",_functionBtns:["window","refresh","new"],_optionsLayer:["setting","delete"],_decimalGroup:"C",_moveUrlInfo:{menuType:"4",menuSeq:"534",subMenu:"M040406040000",subMenuSeq:"534"},IsUseTagTemplate:function(n){return["MAKE_D.io_date","MAKE_D.io_date_no"].contains(n.id)},GetColumnLabel:function(n,t,i){var r=this.epData.body.data[i];switch(n.id){case"MAKE_D.io_date":case"MAKE_D.io_date_no":return ecount.convertor.dataTypeConvertor.date(t,{dataType:"Date10"});case"MAKE_D.qty_unit":case"sale200.qty_unit":return $.isNull(r.UNIT)?t:String.format("{0}{1}",t,r.UNIT);case"MAKE_D.serial":return i+1;default:return t}},OpenLinkPopup:function(n){var t="";switch(n.colCd){case"MAKE_D.io_date":case"MAKE_D.io_date_no":t="/ECERP/SVC/ESJ/ESJ008M";n.data.IO_TYPE=="42"&&n.data.TYPE_GUBUN=="3"?t="/ECERP/SVC/ESJ/ESJ022M":n.data.IO_TYPE=="42"&&n.data.TYPE_GUBUN!="3"&&(t="/ECERP/SVC/ESJ/ESJ009M");this.defaultParam={Request:{Key:{Date:n.data.IO_DATE,No:n.data.IO_NO},EditMode:ecenum.editMode.modify,FromProgramId:"E040410",PrevUrl:"/ECERP/ECP/ECP001M",UIOption:{Width:800,Height:700,FocusRowNumber:n.data.SER_NO||1}}}}_.isEmpty(t)||this.openPopup({url:t,name:""})}},repairStatus:{controlType:"widget.ep.repairStatus",subTitle:"미수리현황",_alwaysLoadByApi:!0,_searchApiURL:"/SVC/Service/EP/GetListRepaireStatusWidget",_searchApiParam:{DATA_KEY:"SLIP_DT",DATA_NO:"SLIP_SNO",WriteDateColNm:"RF_SLIP_M.WRT_DTM",EditDateColNm:"RF_SLIP_M.MOD_DTM"},_menuType:"783",_menuSeq:"206",_newPageUrl:"/ECERP/SVC/ESQ/ESQ104M",_movePageUrl:"/ECERP/SVC/ESQ/ESQ109R",_settingUrl:"/ECERP/SVC/ECP/ECP001P_12",_functionBtns:["window","refresh","new"],_optionsLayer:["setting","delete"],_decimalGroup:"C",_moveUrlInfo:{menuType:"783",menuSeq:"562",subMenu:"M100106000000",subMenuSeq:"562"},ON_CLICK_NEW:function(){this.openPopup({url:this._newPageUrl,popupType:!0,width:800})},IsUseTagTemplate:function(n){return["rf_slip_m.slip_dt","rf_slip_m.slip_dt_no"].contains(n.id)},GetColumnLabel:function(n,t,i){switch(n.id){case"rf_slip_m.slip_dt":case"rf_slip_m.slip_dt_no":return ecount.convertor.dataTypeConvertor.date(t,{dataType:"Date10"});case"rf_slip_m.serial":return i+1;default:return t}},OpenLinkPopup:function(n){var t="/ECERP/SVC/ESQ/ESQ104M";switch(n.colCd){case"rf_slip_m.slip_dt":case"rf_slip_m.slip_dt_no":this.defaultParam={Request:{Key:{Date:n.data.SLIP_DT,No:n.data.SLIP_SNO},EditMode:ecenum.editMode.modify,FromProgramId:"E040610",PrevUrl:"/ECERP/ECP/ECP001M",UIOption:{Width:920,Height:640,FocusRowNumber:n.data.DTLS_SNO||1},A_FLAG:"",PAGE:"1",DOC_NO:"1",callPageName:"ESQ109R",focusFlag:"Y"}}}_.isEmpty(t)||this.openPopup({url:t,name:""})}},repairOrderStatus:{controlType:"widget.ep.repairOrderStatus",subTitle:"A/S접수현황",_alwaysLoadByApi:!0,_searchApiURL:"/SVC/Service/EP/GetListRepaireOrderStatusWidget",_searchApiParam:{DATA_KEY:"SLIP_DT",DATA_NO:"SLIP_NO",WriteDateColNm:"RO_SLIP_M.WRT_DTM",EditDateColNm:"RO_SLIP_M.MOD_DTM"},_menuType:"783",_menuSeq:"206",_newPageUrl:"/ECERP/SVC/ESQ/ESQ101M",_movePageUrl:"/ECERP/SVC/ESQ/ESQ112R",_settingUrl:"/ECERP/SVC/ECP/ECP001P_25",_functionBtns:["window","refresh","new"],_optionsLayer:["setting","delete"],_decimalGroup:"C",_moveUrlInfo:{menuType:"783",menuSeq:"561",subMenu:"M100106000000",subMenuSeq:"562"},ON_CLICK_NEW:function(){this.openPopup({url:this._newPageUrl,popupType:!0,width:800})},IsUseTagTemplate:function(n){return["ro_slip_m.slip_dt","ro_slip_m.slip_dt_no"].contains(n.id)},GetColumnLabel:function(n,t,i){switch(n.id){case"ro_slip_m.slip_dt":case"ro_slip_m.slip_dt_no":return ecount.convertor.dataTypeConvertor.date(t,{dataType:"Date10"});case"ro_slip.serial":return i+1;default:return t}},OpenLinkPopup:function(n){var t="/ECERP/SVC/ESQ/ESQ101M";switch(n.colCd){case"ro_slip_m.slip_dt":case"ro_slip_m.slip_dt_no":this.defaultParam={Request:{Key:{Date:n.data.SLIP_DT,No:n.data.SLIP_SNO},EditMode:ecenum.editMode.modify,FromProgramId:"E040610",PrevUrl:"/ECERP/ECP/ECP001M",UIOption:{Width:920,Height:640,FocusRowNumber:n.data.DTLS_SNO||1},A_FLAG:"",PAGE:"1",DOC_NO:"1",callPageName:"ESQ112R",focusFlag:"Y"}}}_.isEmpty(t)||this.openPopup({url:t,name:""})}},customerAP:{controlType:"widget.ep.customerAP",subTitle:"거래처별채권",_alwaysLoadByApi:!0,_searchApiURL:"/SVC/Service/EP/GetListARByCustomerForWidget",_searchApiParam:{},_menuType:"4",_menuSeq:"35",_newPageUrl:"/ECERP/SVC/EBD/EBD010M_01",_movePageUrl:"/ECERP/SVC/ESD/ESD025R",_settingUrl:"/ECERP/ECP/ECP001P_08",_functionBtns:["window","refresh","new"],_optionsLayer:["setting","delete"],_decimalGroup:"C",_moveUrlInfo:{menuType:"4",menuSeq:"500",subMenu:"M040205070000",subMenuSeq:"500"},IsUseTagTemplate:function(n){return["T1.CUST","T1.CUST_NAME","cust_gbusiness.cust_name","cust.cust_name","cust_emp.cust_name"].contains(n.id)},GetColumnLabel:function(n,t,i,r){switch(n.id){case"T1.serial":return i+1;case"T1.CUST_NAME":case"CUST_GBUSINESS.CUST_NAME":return _.isEmpty(t)&&(t="[]"),t;case"T1.BAL_MONTH":if(r){if(!_.isNil(r.BAL_MONTH_LEVEL)&&r.BAL_MONTH_LEVEL==0)return"";if(!_.isNil(r.BAL_MONTH_DES))return!_.isNil(n.IsDisplayZero)&&!n.IsDisplayZero&&t==""?"":r.BAL_MONTH_DES!=""?String.format(r.BAL_MONTH_DES,t):t}default:return t}},getTemplateBody:function(n){return $.isNull(n.data)?"":n.data.length==1&&!$.isEmpty(n.data[0].message)?n.data[0].message:this._super.getTemplateBody.apply(this,arguments)},ON_CLICK_CELLVALUE:function(n){var u=Number($(n).attr("data-index")),f=$(n).attr("data-colCd"),i={columns:this.epData.body.columns,data:this.epData.body.data[u]},t,r;switch(f){case"T1.CUST":case"T1.CUST_NAME":case"cust_gbusiness.cust_name":case"cust.cust_name":case"cust_emp.cust_name":if(t=ecount.global.findViewBag(this.ecPageID).Permission.ArByCustomer,t.UPD==!0&&!t.CAR||t.UPD!=!0&&!t.CW){r=ecount.common.getAuthMessage("",[{MenuResource:ecount.resource.LBL93407,PermissionMode:"U"}]);ecount.alert(r.fullErrorMsg);n.preventDefault();return}this.defaultParam=this.setPrintData(i.data.CUST,i.data.CUST_NAME,i.data.SDATE,i.data.EDATE);this.defaultParam.Request.Data.print_flag="N";this.defaultParam.Request.Data.hidRptGubun="1";this.openPopup({url:"/ECERP/SVC/EBZ/EBZ029R",width:900,height:1100,popupType:!1,additional:!1,fpopupID:this.ecPageID})}},setPrintData:function(n,t,i,r){return{isFromLink:!0,Request:{DefaultSearchParam:{CUST:n,CUST_DES:t,BASE_DATE_FROM:i,BASE_DATE_TO:r},Data:{BOND_DEBT_GUBUN:"1",NotCust:$.isEmpty(n)?"1":"0",RptConfirm:"0"}}}}},vendorAP:{controlType:"widget.ep.vendorAP",subTitle:"거래처별채무",_alwaysLoadByApi:!0,_searchApiURL:"/SVC/Service/EP/GetListAPByVendorForWidget",_searchApiParam:{},_menuType:"4",_menuSeq:"35",_newPageUrl:"/ECERP/SVC/EBD/EBD010M_05_00",_movePageUrl:"/ECERP/SVC/ESD/ESD019R",_settingUrl:"/ECERP/ECP/ECP001P_09",_functionBtns:["window","refresh","new"],_optionsLayer:["setting","delete"],_decimalGroup:"C",_moveUrlInfo:{menuType:"4",menuSeq:"517",subMenu:"M040306050000",subMenuSeq:"517"},IsUseTagTemplate:function(n){return["T1.CUST","T1.CUST_NAME","cust_gbusiness.cust_name","cust.cust_name","cust_emp.cust_name"].contains(n.id)},GetColumnLabel:function(n,t,i,r){switch(n.id){case"T1.serial":return i+1;case"T1.CUST_NAME":case"CUST_GBUSINESS.CUST_NAME":return _.isEmpty(t)&&(t="[]"),t;case"T1.BAL_MONTH":if(r){if(!_.isNil(r.BAL_MONTH_LEVEL)&&r.BAL_MONTH_LEVEL==0)return"";if(!_.isNil(r.BAL_MONTH_DES))return!_.isNil(n.IsDisplayZero)&&!n.IsDisplayZero&&t==""?"":r.BAL_MONTH_DES!=""?String.format(r.BAL_MONTH_DES,t):t}default:return t}},getTemplateBody:function(n){var t,i;if($.isNull(n.data))return"";if(n.data.length!=1||$.isEmpty(n.data[0].message))t=n.columns.select(function(n){if(["T.mt_pre_amt","T.mt_dr_amt","T.mt_cr_amt","T.mt_last_amt"].contains(n.id))return n}),t.length>0&&(i={dataType:"9"+ecount.config.company.DEC_AMT,amtCalc:"r",isCheckZero:ecount.config.company.ZERO_CHK_YN,isShowIfZero:ecount.config.company.ZERO_DISPLAY_YN},$.each(n.data,function(n,r){for(var e,f,o,s,u=0;u<t.length;u++)e=r["A"+t[u].index],t[u].align="right",(e+"").indexOf(ecount.delimiter)>0&&(f=e.split(ecount.delimiter),f.length>1&&(o=ecount.convertor.getDecimalValueByConvertor(f[0].trim()||"0",i),s=ecount.convertor.getDecimalValueByConvertor(f[1].trim(),i),r["A"+t[u].index]=s==""?o:o+"<br/>("+s+")"))}));else return n.data[0].message;return this._super.getTemplateBody.apply(this,arguments)},ON_CLICK_CELLVALUE:function(n){var u=Number($(n).attr("data-index")),f=$(n).attr("data-colCd"),i={columns:this.epData.body.columns,data:this.epData.body.data[u]},t,r;switch(f){case"T1.CUST":case"T1.CUST_NAME":case"cust_gbusiness.cust_name":case"cust.cust_name":case"cust_emp.cust_name":if(t=ecount.global.findViewBag(this.ecPageID).Permission.ApByVendor,t.UPD==!0&&!t.CAR||t.UPD!=!0&&!t.CW){r=ecount.common.getAuthMessage("",[{MenuResource:ecount.resource.LBL93415,PermissionMode:"U"}]);ecount.alert(r.fullErrorMsg);n.preventDefault();return}this.defaultParam=this.setPrintData(i.data.CUST,i.data.CUST_NAME,i.data.SDATE,i.data.EDATE);this.defaultParam.Request.Data.print_flag="N";this.defaultParam.Request.Data.hidRptGubun="1";this.openPopup({url:"/ECERP/SVC/EBZ/EBZ029R",width:900,height:1100,popupType:!1,additional:!1,fpopupID:this.ecPageID})}},setPrintData:function(n,t,i,r){return{isFromLink:!0,Request:{DefaultSearchParam:{CUST:n,CUST_DES:t,BASE_DATE_FROM:i,BASE_DATE_TO:r},Data:{BOND_DEBT_GUBUN:"2",NotCust:$.isEmpty(n)?"1":"0",RptConfirm:"0"}}}}},orderManagement:{controlType:"widget.ep.orderManagement",subTitle:"오더관리진행단계",_alwaysLoadByApi:!0,_searchApiURL:"/SVC/Service/EP/GetListOrderMgmtWidget",_searchApiParam:{},_menuType:"783",_menuSeq:"1390",_newPageUrl:"/ECERP/SVC/ESO/ESO002P_01",_movePageUrl:"/ECERP/SVC/ESO/ESO004M",_itemPageUrl:"/ECERP/SVC/ESA/ESA009M",_custPageUrl:"/ECERP/SVC/ESA/ESA001M",_settingUrl:"/ECERP/ECP/ECP001P_20",_functionBtns:["window","refresh","new"],_optionsLayer:["setting","item","cust","delete"],_moveUrlInfo:{menuType:"783",menuSeq:"1393",subMenu:"M100604000000",subMenuSeq:"1393"},_needRequire:["inventorylib.common","ecmodule.inventory.loadslipinfo","ecmodule.inventory.orderMngt"],listProgress:[],strSignFlag:"",columnList:{},searchFormParameter:{WRITE_FROM_DT:this.recentDataDate,WRITE_TO_DT:this.baseDateTo,ETC_VAL:"0",TYPE_CD:"",PROC_NO:"",WRITE_ID:"",TXT_1:"",TXT_2:"",TXT_3:"",TXT_4:"",TXT_5:"",NUM_1:"",NUM_2:"",NUM_3:"",NUM_4:"",NUM_5:"",CD_1:"",CD_2:"",CD_3:"",CD_4:"",CD_5:"",PROGRESS:"",C_PROGRESS:"",USE_YN:"1",LIST_FLAG:"1",SEARCH_TXT:"",PAGE_SIZE:15,PARAM:"",PAGE_CURRENT:this.PageCurrent,ETC_ACT:"",FORM_TYPE_BY_KEY:"SR800",FORM_SEQ_BY_KEY:"1"},optionsLayerResource:{setting:ecount.resource.BTN00168,item:ecount.resource.LBL05100,cust:ecount.resource.LBL00271,"delete":ecount.resource.LBL06157},init:function(){this._super.init.apply(this,arguments);this.viewBag=ecount.global.findViewBag(this.ecPageID)},getTemplateBody:function(n){var u=this.bodyDataConversion(n),o,e,r,l,t,a;if($.isNull(u.data))return"";if($.isEmpty(u.data))return"<div>"+ecount.resource.MSG00205+"<\/div>";this.strOrderPermit=this.viewBag.InitDatas.ORDER_PERMISSION;this.strOrderPermitDetail=this.viewBag.Permission.ORDER_PERMISSION_DETAIL;o=['<table class="table tabel-bordered table-hover">',"<colgroup>","   {{colgroup}}","<\/colgroup>","<thead><tr>","{{header}}","<\/tr><\/thead>","<tbody>","{{body}}","<\/tbody>","<\/table>",].join("\n");this.listProgress=[];var f="<col {0}>",s="<tr>{0}<\/tr>",h="",i="",c="";for(this.columnList=[],e=u.data||[],t=0;t<n.columns.length;t++)r=n.columns[t].id,l=n.columns[t].title,this.columnList.add(r),c+=r==="SO.PROGRESSSTATE"?String.format(f,'style="width:900px"'):r==="SO.DETAIL"?String.format(f,'style="width:50px"'):String.format(f,'style="width:120px"'),i+=String.format("<th>{0}<\/th>",l);for(i=String.format(s,i),t=0;t<e.length;t++)a=e[t],h+=String.format(s,this.makeRow(a,t));return""+ecount.widget.replaceAttr(o,{body:h,header:i,colgroup:c})},makeRow:function(n,t){for(var o,s,h,f='<td class = "{1}" >{0}<\/td>',r,e=0,u="",i=0;i<this.columnList.length;i++)["SO.PROC_NO","SO.PROC_NM"].contains(this.columnList[i])?(r={tagType:"LINK",id:"order_number",index:t.toString()},u+=String.format(f,this.getTagTemplate(r,n["A"+i],e++))):this.columnList[i]=="SO.PROGRESSSTATE"?(o=this.defineFlowOrder(n,t),s=this.makeOrderProgress(n.PROGRESSSTATE,o),u+=String.format(f,s)):this.columnList[i]=="SO.DETAIL"?(r={tagType:"LINK",id:"order_detail",index:t.toString()},u+=String.format(f,this.getTagTemplate(r,ecount.resource.BTN00027,e),"text-center")):this.columnList[i]=="SO.PROC_DATE"?u+=String.format(f,ecount.convertor.dataTypeConvertor.date(n["A"+i],{dataType:"Date10"})):this.columnList[i]=="SO.LINK_IDX"?(h=n["A"+i]=="0"?"":'class="text-warning-inverse"',r={tagType:"LINK",id:"order_linkIdx",index:t.toString()},u+=String.format(f,'<a href="javascript:;" data-colCd="'+r.id+'" data-index="'+e+'" data-value="cellValue" data-function="click" data-rowkey='+r.index+" "+h+">"+ecount.resource.LBL07534+"<\/a>")):u+=String.format(f,n["A"+i]);return u},getTagTemplate:function(n,t,i){return n.tagType&&n.tagType.toUpperCase()=="LINK"?'<a href="javascript:;" data-colCd="'+n.id+'" data-index="'+i+'" data-value="cellValue" data-function="click" data-rowkey='+n.index+">"+t+"<\/a>":t},checkIsDeletedOrderProcStep:function(n,t){for(var r=[],i=2;arguments.length>i;i++)r.push(arguments[i]);ecount.common.api({url:"/SVC/Inventory/OrderMgmt/CheckIsDeletedOrderProcStep",data:{Request:{Data:{PROC_NO:t.rowItem.PROC_NO,PROC_STEP:parseInt(t.childElementIndex)||1}}},success:function(t){t.Data!=null&&n.apply(this,r)}.bind(this)})},ON_CLICK_ITEM:function(){var n={url:this._itemPageUrl,width:975};this.openPopup(n)},ON_CLICK_CUST:function(){var n={url:this._custPageUrl,width:975};this.openPopup(n)},ON_CLICK_CELLVALUE:function(n){console.log("order button");var i={},t={rowItem:this.epData.body.data[n.getAttribute("data-rowkey")],rowIdx:n.getAttribute("data-rowkey")};n.getAttribute("data-colCd")=="order_number"?(this.isCheckProcNo=!0,i={Request:{EditMode:"02",FromProgramId:"",Key:{Code:t.rowItem.PROC_NO},Data:{isAddGroup:!0}},width:760,height:550},this.checkIsDeletedOrderProcStep(this.fnOpenWindow,t,i,"/ECERP/SVC/ESO/ESO002P_01",ecount.resource.LBL08780)):n.getAttribute("data-colCd")=="order_linkIdx"?ecount.common.api({url:"/Common/Infra/GetMyStorageList",data:{BOARD_TYPE:"ORDERM",PROC_NO:t.rowItem.PROC_NO},success:function(n){if(ecount.infra.getGroupwarePermissionByAlert(this.viewBag.DefaultOption.GroupwarePermission).Excute()){var t=[];$.isEmpty(n.Data)||$.each(n.Data,function(n,i){$.isEmpty(i)||t.push(i.IDX)});this.openWindow({url:"/ECERP/SVC/ENT/ENT004M",name:ecount.resource.LBL05860,param:{width:800,height:600,isApplyPopup:!0,isFileGroupWidget:"Y",LIST_IDX:t.join(ecount.delimiter)}})}}.bind(this)}):(i={width:950,height:400,procNoList:[t.rowItem.PROC_NO]},this.checkIsDeletedOrderProcStep(this.fnOpenWindow,t,i,"/ECERP/SVC/ESO/ESO004P_01",ecount.resource.LBL08780))},ON_CLICK_ORDERLINK:function(n){console.log("order process button");var t={childElementIndex:n.getAttribute("childElementIndex"),childElementId:n.getAttribute("childElementId"),rowItem:this.epData.body.data[n.getAttribute("data-rowkey")],rowIdx:n.getAttribute("data-rowkey")};t.childElementId=="link2"?this.checkIsDeletedOrderProcStep(this.fnOpenFlowIcon,t,t,"write"):t.childElementId=="link3"?this.checkIsDeletedOrderProcStep(this.fnOpenFlowIcon,t,t,"search"):t.childElementId=="link4"?this.checkIsDeletedOrderProcStep(this.fnOpenFlowIcon,t,t,"link"):["link5","link6"].contains(t.childElementId)?this.checkIsDeletedOrderProcStep(this.finishAndCancelStep,t,t):t.childElementId=="link1"&&this.checkIsDeletedOrderProcStep(this.fnValidateProgress,t,t);n.dataset.isorderbox||(n.parentElement.parentElement.classList.remove("show"),n.parentElement.parentElement.classList.add("hide"))},ON_CLICK_ORDERBOX:function(n){$(n).siblings().hasClass("show")?$(n).siblings().removeClass("show").addClass("hide"):(this.$el.find(".show").removeClass("show"),$(n).siblings().removeClass("hide").addClass("show"))},onMessage:function(n,t){switch(n.pageID){case"CM100P_02":case"CM100P_24":this.isCheckFuncSeach=!0;this.reload();break;case"ESO002P_01":this.dataProcNo=t;this.reload();break;case"ES008P":$.isEmpty(this.tmpRowIdx)||$.isEmpty(this.tmpElementIndex)||this.fnOpenFlowIconFromJobOrder(this.tmpRowIdx,this.tmpElementIndex,t);break;case"EBD002M":case"EBD015M":case"EGD002M":case"ECP001P_20":case"EMM016P_02":this.reload()}if(t!=null)switch(t){case"InsertOrderApply":case"DeleteOrderSlip":case"RefreshOrder":this.reload()}t.callback&&t.callback()},fnOpenWindow:function(n,t,i){this.defaultParam=n;this.openPopup({url:t,name:i,param:n,popupType:!1,fpopupID:this.ecPageID})},openWindow:function(n){n.param&&(this.defaultParam=n.param);n.responseID=this.callbackID;this.openPopup(n)},fnValidateProgress:function(n){var u=this,i=n.childElementIndex,r=n.rowItem.PROGRESSSTATE.split(ecount.delimiter)[i-1].split("-"),t=r[2];if(t=="R"||$.isEmpty(t)){ecount.alert(ecount.resource.MSG05608);return}},getNowStep:function(n){var i=this.searchFormParameter.ETC_ACT,r="",t="";return i=="1"?t="N":i=="2"&&(t="Y"),(t=="Y"&&n=="C"||t=="")&&(r="last"),r},handleForCheckActionOrderProc:function(n,t,i){var u=this,s="",f="",e="",h=!1,c,r,o;if(u.strUserYn="Y",i!=""){if(c=this.contents.getGrid().grid.getChecked(),c.length==0){ecount.alert(ecount.resource.MSG00213);return}u.dataOrderProcStepList=[];u.dataOrderProcStepList=u.getDataOrderProcStep(i,n,c)}if(n=="End"){switch(t){case"P":i=="FinishAllStep"?(f="ALLSTATS",e="ALLSTEPSTATUS"):(f="ALLSTATS",e="ORDERSTEP",h=!0);break;case"C":i=="FinishAllStep"?(f="ALLSTATS",e="ALLSTEPSTATUS"):(f="ALLSTATS",e="ORDERSTEP",h=!0)}if(o={TYPE:f,PAGE_TYPE:e,CHKVRFLAG:h,OrderProcStepList:u.dataOrderProcStepList},u.strUserYn=="N"){ecount.alert(ecount.resource.MSG04732);return}u.CallApiForFinishStep(o)}else if(n=="DEL"){switch(t){case"ORDERDEL":s=ecount.resource.MSG04735;break;case"ALLDEL":r="";r+=ecount.resource.MSG04730+"<br/>";r+=ecount.resource.MSG01497+"<br/>";r+=ecount.resource.LBL04838+"<br/>";r+=ecount.resource.LBL04839+"<br/>";r+=ecount.resource.LBL04840+"<br/>";r+=ecount.resource.LBL04841+"<br/>";r+="5. "+ecount.resource.LBL04388+"<br/>";r+="6. "+ecount.resource.MSG00061+"<br/>";r+="7. "+ecount.resource.LBL01664+"<br/>";r+="8. "+ecount.resource.MSG01712+"<br/>";r+="9. "+ecount.resource.MSG04023+"<br/>";r+="10. "+ecount.resource.MSG04686+"<br/>";r+="11. "+ecount.resource.MSG05460;s=r}o={TYPE:t,PAGE_TYPE:"",CHKVRFLAG:!0,OrderProcStepList:u.dataOrderProcStepList};ecount.confirm(s,function(n){if(n==!0)u.CallApiForDeleteSelected(o);else return!1})}},CallApiForFinishStep:function(n){var t=this;t.orderProcStepList=n.OrderProcStepList;t.showProgressbar(!0);ecount.common.api({ecPageID:this.ecPageID,url:"/SVC/Inventory/OrderMgmt/FinishOrderMngStep",data:{Request:{Data:{FinishType:"STEP",VersionCheck:!0,OrderProcStepList:n.OrderProcStepList}},CheckPermissionRequest:{EditMode:ecenum.editMode.modify,ProgramId:"E040904"}},success:function(n){if(t.hideProgressbar(!0),n.Status!="200")ecount.alert("error");else{var i=n.Data[0],r=n.Data[1];if(i=="ALLSTATS"&&r!="0"){ecount.alert(ecount.resource.MSG00710);return}if(i=="ERROR"){ecount.alert(ecount.resource.MSG05441);return}t.reload()}}})},finishAndCancelStep:function(n){var u,t,i;if(this.strOrderPermitDetail&&this.strOrderPermitDetail.UPD==!0&&this.strOrderPermitDetail.CU==!1||!["W"].contains(this.strOrderPermit))return u=ecount.common.getAuthMessage("",[{MenuResource:ecount.resource.LBL90003,PermissionMode:"U"}]),ecount.alert(u.fullErrorMsg),!1;if(n.rowItem.USE_YN=="N"){ecount.alert(ecount.resource.MSG04732);return}t=this;i=n.childElementIndex;t.dataOrderProcStepList=[];t.SetStepConfirm(n.rowItem.PROGRESSSTATE.split(ecount.delimiter)[i-1]);var f=t.dtStep,o=n.rowItem,h=n.rowItem.PROGRESSSTATE.split(ecount.delimiter)[i-1].split("-"),r=f[0][1],c=f[0][1],s=o.PROC_NO,e="";if(r.PROGRESS=="C"&&(e=t.getNowStep(r.PROGRESS),e=="")){ecount.alert(ecount.resource.MSG04707);return}t.dataOrderProcStepList.push({PROGRESS:r.PROGRESS=="P"?"C":"P",PROC_NO:s,PROC_STEP:i});t.handleForCheckActionOrderProc("End",r.PROGRESS,"")},fnGetFlowIconWriteParamx:function(n){var t={EditMode:ecenum.editMode.new,FromProgramId:"E040904",UIOption:{Width:ecount.infra.getPageWidthFromConfig(!0),Height:800},OrderMgmtRequest:{STETOrderMode:"1",STETOrderProcNo:n.PROC_NO,STETOrderProcStep:n.PROC_STEP,STETLinkType:"I"},SlipTransManagerRequest:{FromProgramId:"E040904",FromMenuSeq:n.PREV_MENU_SEQ,ToMenuSeq:n.MENU_SEQ,TransType:"ORDER_PROC",LoadType:n.MENU_SEQ=="488"?"S":"V",IsReLoad:!1,SummaryType:"1",BALANCE_TYPE:"Y"}};return{Request:t}},fnGetFlowIconParam:function(n,t){var r={width:ecount.infra.getPageWidthFromConfig(!0),height:800,STETOrderMode:"1",STETOrderProcNo:n.PROC_NO,STETOrderProcStep:n.PROC_STEP,STETOrderProgress:n.PROGRESS,FROM_TYPE:n.PREV_MENU_SEQ,TO_TYPE:n.MENU_SEQ,PREV_PROC_STEP:n.PREV_PROC_STEP},i;return t=="write"?(i={isOpenPopup:!0,isViewPopupCloseButton:!0,isUnRebuildContent:!1,EditFlag:"ORDER"},(n.MENU_SEQ=="68"||n.MENU_SEQ=="69")&&(i.IsPopup=!0)):(i={slip_type:1,STETIsFromOrderMng:!0,STETLinkType:"S"},n.MENU_SEQ=="526"?i.SS_FLAG="1":n.MENU_SEQ=="527"?i.SS_FLAG="2":n.MENU_SEQ=="528"&&(i.SS_FLAG="3"),t=="search"?(i.STETLinkType="S",n.MENU_SEQ=="68"?(i.ACCCASE="9804",i.ACCCASE_DES=ecount.resource.LBL02660):n.MENU_SEQ=="69"&&(i.ACCCASE="9805",i.ACCCASE_DES=ecount.resource.LBL02253)):t=="link"&&(i.STETLinkType="L",n.MENU_SEQ=="68"?(i.ACCCASE="9804",i.ACCCASE_DES=ecount.resource.LBL02660):n.MENU_SEQ=="69"&&(i.ACCCASE="9805",i.ACCCASE_DES=ecount.resource.LBL02253))),$.extend(r,i),r},fnOpenFlowIcon:function(n,t){var f=this,u=n.rowIdx,i=this.listProgress[u][n.childElementIndex-1],r=this.fnGetFlowIconParam(i,t);if(n.rowItem.USE_YN=="N"&&["write","link"].contains(t))return ecount.alert(ecount.resource.MSG04733),!1;if(i[t]!=null&&i[t]!="")if(t=="write"&&i.PREV_MENU_SEQ=="522"&&["524","526","527","528","738"].contains(i.MENU_SEQ))this.tmpRowIdx=u,this.tmpElementIndex=n.childElementIndex-1,i.DETAIL_FLAG&&["524","526","527","738"].contains(i.MENU_SEQ)?(r.width=450,r.height=500,r=_.merge(r,{Request:{Data:{FLAG:1,isNewDisplayFlag:!0,isOnePopupClose:!1}}}),this.fnOpenWindow(r,"/ECERP/SVC/Popup/ES008P",ecount.resource.LBL02717)):i.MENU_SEQ=="528"?this.fnOpenFlowIconFromJobOrder(this.tmpRowIdx,this.tmpElementIndex):this.fnOpenWindow(r,i[t],i.MENU_NAME);else if(i.MENU_SEQ=="246"){if(this.comGwUse=="1")return ecount.alert(ecount.resource.MSG04479),!1;t=="write"?ecount.common.api({ecPageID:this.ecPageID,url:"/SVC/groupware/eapproval/GetListOrderProcSlips",data:{Request:{Data:{PROC_NO:i.PROC_NO,PROC_STEP:i.PREV_PROC_STEP,PROC_DATE:i.PROC_DATE}}},success:function(n){var r=[],t,u;if(n.Data!=null)for(t=0;t<n.Data.length;t++)r.push({PRG_ID:n.Data[t].PRG_ID,DATE:n.Data[t].IO_DATE,NO:n.Data[t].IO_NO,VERSION_NO:n.Data[t].VERSION_NO,MAKE_TYPE:"S"});u={STETOrderProcNo:i.PROC_NO,STETOrderProcStep:i.PROC_STEP};r.length!=0&&(u.ERPS=r);ecmodule.common.eapproval.createGWERDoc(f,u)}.bind(this)}):this.fnOpenWindow({STETOrderProcNo:i.PROC_NO,STETOrderProcStep:i.PROC_STEP,PageDisplayType:"2",TRX_TYPE:ecmodule.common.eapproval.code.menuSeqToErpCD(i.PREV_MENU_SEQ)},i[t],i.MENU_NAME)}else t=="write"&&["490","659","543","486","488","541","736","775","1325","508","506","528","738","524","504","510","527","526","522","68","69"].contains(i.MENU_SEQ)?(r=this.fnGetFlowIconWriteParamx(i,t),this.fnOpenWindow(r,i[t],i.MENU_NAME)):this.fnOpenWindow(r,i[t],i.MENU_NAME)},fnOpenFlowIconFromJobOrder:function(n,t,i){var f=this,e="write",u=this.listProgress[n][t],r={};r=this.fnGetFlowIconWriteParamx(u,e);ecount.common.api({ecPageID:this.ecPageID,url:"/SVC/Inventory/OrderMgmt/GetListByLineOrderMngt",data:{Request:{Data:{PROC_NO:u.PROC_NO,PROC_STEP:u.PROC_STEP}}},success:function(n){u.MENU_SEQ=="528"?r.PlanList=f.fnSetJobOrderList(n.Data,1):(r.Request.Data={},r.Request.Data.PlanList=f.fnSetJobOrderList(n.Data,n.Data.length));r.IsBalanceFlag=!0;r.ProcessType="A";u.MENU_SEQ!="528"&&i.data&&(r.Request.SlipTransManagerRequest.WhCd=i.data.WH_CD);u.MENU_SEQ=="524"?(r.Request.Data.WH_CD_T=i==null?"":i.data.WH_CD,r.Request.Data.BOM_FLAG=this.viewBag.InitDatas.GUSH_BOM_FLAG,r.Request.Data.IsBalanceFlag=!0,r.Request.Data.IsConsumeBalanceFlag=!0,r.Request.Data.CONSUME_BOM_FLAG=this.viewBag.InitDatas.GUSH_BOM_FLAG,r.Request.Data.HalfIncludeYn="Y",r.Request.Data.isQtyByUser=!1,r.Request.Data.ProcessType="C",r.Request.Data.isAdd=!0,r.Request.Data.IsByJobOrder=!0):(r.WH_CD_F=i==null?"":i.data.WH_CD,(u.MENU_SEQ=="526"||u.MENU_SEQ=="527"||u.MENU_SEQ=="528")&&(r.Request.Data.BOM_FLAG=this.viewBag.InitDatas.WARE_BOM_FLAG,r.Request.Data.ProcessType="A",r.Request.Data.WH_CD_F=i==null?"":i.data.WH_CD,r.Request.Data.IsBalanceFlag=!0,r.Request.Data.IsByJobOrder=!0),u.MENU_SEQ=="738"&&(r.Request.Data.ProcessType="M",r.Request.Data.BOM_FLAG="2",r.Request.Data.IsConsumeBalanceFlag=!1,r.Request.Data.IsBalanceFlag=!1,r.Request.Data.WH_CD_F=i.data.WH_CD,r.Request.Data.WH_DES_F=i.data.WH_DES,r.Request.Data.WH_CD_T=i.data.WH_CD));this.fnOpenWindow(r,u[e],u.MENU_NAME)}.bind(this)})},fnSetJobOrderList:function(n,t){var u=[],r;for(i=0;i<t;i++)r={},r.INDEX=i,r.BOM_NO=n[i].BOM_NO,r.PLAN_DATE=n[i].PLAN_DATE,r.PLAN_NO=n[i].PLAN_NO,r.PLAN_PROD=n[i].PROD_CD,r.PLAN_PROD_SER=n[i].PLAN_PROD_SER,r.PLAN_QTY=n[i].QTY,r.PLAN_WH=n[i].WH_CD,r.BOM_CD=n[i].PROD_CD,r.BOM_NO=n[i].BOM_NO,r.PROD_BOM_NM=n[i].PROD_BOM_NM,r.ITEM_CD=n[i].ITEM_CD,r.ITEM_DES="",r.PROD_DES=n[i].PROD_DES,r.SIZE_DES=n[i].SIZE_DES,r.PROD_QTY=n[i].QTY,r.CUST_DES=n[i].CUST_NAME,u.push(r);return u},defineFlowOrder:function(n,t){var u=this,r={},i,tt;if(r.controlType="widget.flow.order",!$.isEmpty(n.PROGRESSSTATE)){u.SetStepConfirm(n.PROGRESSSTATE,n.PROC_NO);var f=n.PROGRESSSTATE.split(ecount.delimiter),w=0,e="",o="0",v="",b="",k="gray label-opened",nt="N",d=!1,g,s,y,h,c,p;for(r.label=[],r.numStatement=[],r.order=[],r.data=[],i=0;i<f.length;i++)if(!$.isEmpty(f[i])){if(g=s=y=h=c=p=!1,r.data.push(f[i].split("-")[0]),tt="",e=u.dtStep[i][1].PROGRESS,o=u.dtStep[i][4].DISABLE_BY_PREV,v=u.dtStep[i][8].PREV_PROGRESS,r.label.push(f[i].split("-")[4]),r.numStatement.push(f[i].split("-")[5]),f[w]!=null||f[w]!=undefined){var it=parseInt(u.dtStep[i][3].PREV_PROC_STEP),l=f[it-1],a=f[i].split("§")[2].split("-");b=l!=undefined||l!=null?String.format(ecount.resource.MSG05833,l.split("-")[4],l.split("-")[0]):ecount.resource.LBL08794;nt=a[0]=="1"||a[1]=="1"||a[2]=="1"||a[3]=="1"?"Y":"N";e!="R"&&(o=="0"||o=="1"&&v=="C")&&(k="primary label-opened",e=="C"&&(s=!1),y=!0,c=!0,h=!0);e=="P"?(o=="0"||o=="1"&&v=="C")&&(s=!0):e=="C"&&(k="lightgray label-opened",s=!1,h=!1,c=!1,p=!0);e!="R"}u.dtStep[i][5].MENU_SEQ=="246"&&(h=!1);d=u.strSignFlag=="N"&&e!="C"||u.strSignFlag=="Y"&&e=="C"||u.strSignFlag==""?!1:!0;r.order.push({normal:{hide:d,keepIndex:!0,visible:g,attrs:{"data-toggle":"tooltip","data-placement":"bottom","data-html":"true","data-original-title":b,"data-function":"click","data-value":"orderLink","data-rowkey":t.toString()}},write:{visible:s,attrs:{"data-toggle":"tooltip","data-placement":"bottom","data-html":"true","data-original-title":ecount.resource.LBL80058,"data-function":"click","data-value":"orderLink","data-rowkey":t.toString()}},search:{visible:y,attrs:{"class":"visible","data-toggle":"tooltip","data-placement":"bottom","data-html":"true","data-original-title":ecount.resource.LBL08902,"data-function":"click","data-value":"orderLink","data-rowkey":t.toString()}},connect:{visible:h,attrs:{"data-toggle":"tooltip","data-placement":"bottom","data-html":"true","data-original-title":ecount.resource.LBL00856,"data-function":"click","data-value":"orderLink","data-rowkey":t.toString()}},complete:{visible:c,attrs:{"data-toggle":"tooltip","data-placement":"bottom","data-html":"true","data-original-title":ecount.resource.LBL05930,"data-function":"click","data-value":"orderLink","data-rowkey":t.toString()}},completeCancel:{visible:p,attrs:{"data-toggle":"tooltip","data-placement":"bottom","data-html":"true","data-original-title":ecount.resource.LBL08903,"data-function":"click","data-value":"orderLink","data-rowkey":t.toString()}}})}}return{columnOption:r}},SetStepConfirm:function(n,t){var o=n.split(ecount.delimiter),h=[],u,r;for(this.dtStep=[],u=0;u<o.length;u++){var i=[],f=[],e=[];$.isEmpty(o[u])?(i.push({PROC_STEP:f[0]}),i.push({PROGRESS:f[2]}),i.push({STATUS:f[3]}),i.push({PREV_PROC_STEP:e[0]}),i.push({DISABLE_BY_PREV:f[6]}),i.push({MENU_SEQ:f[1]}),i.push({MENU_NAME:f[4]}),i.push({PREV_MENU_SEQ:e[1]}),i.push({PREV_PROGRESS:e[2]}),i.push({DETAIL_FLAG:!0}),i.push({PROC_DATE:procDate})):(f=o[u].split("§")[0].split("-"),e=o[u].split("§")[1].split("-"),procDate=o[u].split("§")[2],i.push({PROC_STEP:f[0]}),i.push({PROGRESS:f[2]}),i.push({STATUS:f[3]}),i.push({PREV_PROC_STEP:e[0]}),i.push({DISABLE_BY_PREV:f[6]}),i.push({MENU_SEQ:f[1]}),i.push({MENU_NAME:f[4]}),i.push({PREV_MENU_SEQ:e[1]}),i.push({PREV_PROGRESS:e[2]}),i.push({DETAIL_FLAG:!0}),i.push({PROC_DATE:procDate}));this.dtStep.push(i);t!=undefined&&t!=null&&t!=""&&(r={PROC_NO:t,write:"",search:"",link:""},$.each(i,function(n,t){r[Object.keys(t)]=t[Object.keys(t)]}),r.MENU_SEQ!=null&&r.MENU_SEQ!=""&&(r.write=ecmodule.inventory.orderMngt._listUrl[r.MENU_SEQ].write,r.search=ecmodule.inventory.orderMngt._listUrl[r.MENU_SEQ].search,r.link=ecmodule.inventory.orderMngt._listUrl[r.MENU_SEQ].link),h.push(r))}var c="",l="",a="",v="",y="",s=[];for(u=0;u<this.dtStep.length;u++)r=this.dtStep[u],c=r[1].PROGRESS,l=r[2].STATUS,y=r[3].PREV_PROC_STEP,u!=0&&(s=this.dtStep.where(function(n){return n[0].PROC_STEP==y}),s.length!=0&&(a=s[0][1].PROGRESS,v=s[0][2].STATUS)),c!="C"&&(this.dtStep[u][1].PROGRESS=u==0?"P":a!="C"&&l=="N"&&v=="N"?"R":"P");t!=null&&t!=""&&this.listProgress.push(h)},makeOrderProgress:function(n,t){var v="",u=t.columnOption.label,tt=t.columnOption.numStatement,o=t.columnOption.order,k='<div class="label-group label-group-hover label-group-order-mgmt label-group-proceed-step {4}">{0}<ul class="dropdown-menu hide" data-value="orderBoxLayer"><li class="text-center">{1}<\/li><li class="text-center">{2}<\/li><li class="text-center">{3}<\/li><\/ul><\/div>',d='<div class="label-group label-group-order-mgmt label-group-proceed-step">{0}<\/div>',l=searchTag=connectTag=completeTag=completeAttrsString=useDual="",a=0,e,r,f,s,h,c,i,g,p,w,y,b,nt;if($.isString(u)&&(u=[u]),o!=undefined&&o!=null&&$.isArray(o))for(i=0,g=u.length;i<g;i++){if(e=o[i].normal||{},r=o[i].write||{},f=o[i].search||{},s=o[i].connect||{},h=o[i].complete||{},c=o[i].completeCancel||{},(e.attrs==null||e.attrs==undefined)&&(e.attrs={}),(r.attrs==null||r.attrs==undefined)&&(r.attrs={}),(f.attrs==null||f.attrs==undefined)&&(f.attrs={}),(s.attrs==null||s.attrs==undefined)&&(s.attrs={}),(h.attrs==null||h.attrs==undefined)&&(h.attrs={}),(c.attrs==null||c.attrs==undefined)&&(c.attrs={}),e.attrs=$.extend(!0,e.attrs,t.attrs||{}),r.attrs=$.extend(!0,r.attrs,t.attrs||{}),f.attrs=$.extend(!0,f.attrs,t.attrs||{}),s.attrs=$.extend(!0,s.attrs,t.attrs||{}),h.attrs=$.extend(!0,h.attrs,t.attrs||{}),c.attrs=$.extend(!0,c.attrs,t.attrs||{}),e.attrs.childElementLabel=u[i],r.attrs.childElementLabel=u[i],f.attrs.childElementLabel=u[i],h.attrs.childElementLabel=u[i],s.attrs.childElementLabel=u[i],c.attrs.childElementLabel=u[i],e.attrs.childElementIndex=i+1-a,r.attrs.childElementIndex=i+1-a,f.attrs.childElementIndex=i+1-a,h.attrs.childElementIndex=i+1-a,s.attrs.childElementIndex=i+1-a,c.attrs.childElementIndex=i+1-a,isShade=o[i].isShade&&o[i].isShade===!0?!0:!1,isWrite=r.visible===!0?!0:!1,isSearch=f.visible===!0?!0:!1,isConnect=s.visible===!0?!0:!1,isComplete=h.visible===!0?!0:!1,isCompleteCancel=c.visible===!0?!0:!1,isHide=e.hide,isKeepIndex=e.keepIndex,l=searchTag=connectTag=completeTag="",completeAttrsString="",isHide&&!isKeepIndex){a++;continue}p=document.createElement("canvas");p.id="myCanvas";p.style="display:none";$("body").append(p);w=p.getContext("2d");w.font="12px Arial";y=u[i];b=tt[i];w.measureText(u[i]).width>75&&(nt=parseInt(75/(w.measureText(u[i]).width/u[i].length)),y=u[i].slice(0,nt)+"..");$("#myCanvas").remove();e.attrs.childElementId=ecount.constValue.multiControlId.link1;isWrite?(r.attrs.childElementId=ecount.constValue.multiControlId.link2,r.attrs["class"]||(r.attrs["class"]=[],r.attrs["class"].push({})),r.attrs["class"][0]="label-group-edit "+r.attrs["class"][0],isShade?(useDual="use-label-group-option-dual",l='<SPAN class="label label-muted ellipsis" data-function="click" data-value="orderBox" data-isorderbox="true">'+y+'<span class="label-group-option">('+b+')<A href="javascript:;" data-isorderbox="true" '+this.setAttrsToString(r.attrs)+"><\/A><\/span><\/span>"):(useDual="use-label-group-option-dual",l='<SPAN class="label label-primary label-light ellipsis" data-function="click" data-value="orderBox" data-isorderbox="true">'+y+'<span class="label-group-option">('+b+')<A href="javascript:;" data-isorderbox="true" '+this.setAttrsToString(r.attrs)+"><\/A><\/span><\/span>")):isSearch||isConnect||isComplete||isCompleteCancel?(useDual="",l='<SPAN class="label label-default ellipsis" data-function="click" data-value="orderBox" data-isorderbox="true">'+y+'<span class="label-group-option">('+b+")<\/span><\/span>"):(useDual="",l='<SPAN class="label label-muted ellipsis" data-function="click" data-value="orderBox" data-isorderbox="true"><A href="javascript:;" data-isorderbox="true" '+this.setAttrsToString(e.attrs)+">"+y+"<\/A><\/SPAN>");f.attrs.childElementId=ecount.constValue.multiControlId.link3;f.attrs["class"]?searchTag='<A href="javascript:;" '+(isSearch?"":"class='hide ' ")+this.setAttrsToString(f.attrs)+">"+ecount.resource.LBL08902+"<\/A>":f.attrs["class"]+=" hide ";s.attrs.childElementId=ecount.constValue.multiControlId.link4;connectTag='<A href="javascript:;" '+(isConnect?"":"class='hide ' ")+this.setAttrsToString(s.attrs)+">"+ecount.resource.LBL00856+"<\/A>";isComplete?(h.attrs.childElementId=ecount.constValue.multiControlId.link5,completeAttrsString=this.setAttrsToString(h.attrs)):isCompleteCancel&&(c.attrs.childElementId=ecount.constValue.multiControlId.link6,completeAttrsString=this.setAttrsToString(c.attrs));completeTag='<A href="javascript:;" '+(isComplete||isCompleteCancel?"":"class='hide ' ")+completeAttrsString+">"+(isComplete?ecount.resource.LBL00182:isCompleteCancel?ecount.resource.LBL08903:"")+"<\/A>";isHide||(v=isSearch||isConnect||isComplete||isCompleteCancel?v==""?String.format(k,l,searchTag,connectTag,completeTag,useDual):v+" "+String.format(k,l,searchTag,connectTag,completeTag,useDual):v==""?String.format(d,l):v+" "+String.format(d,l))}return v},setAttrsToString:function(n){var r="",t="",u,f,i;if(n){n["data-content"]!=null&&n["data-content"]!=undefined&&(u=n["data-content"]==undefined||n["data-content"]==null?"":n["data-content"],f=n["data-html"]===!0||n["data-html"]==="true",f&&(n["data-content"]=u.replace(/\n/g,"<br/>")));n["class"]||(n["class"]="event-target");for(i in n)t=$.isArray(n[i])?n[i].join(" "):n[i],t=i!=="data-key"?t:t.escapeHTML(),(i==="class"||i==="Class")&&typeof t=="string"&&(t.test(/event-target/g)||(t+=" event-target ")),t?r+=i+'="'+t+'" ':t==null&&(r+=i+" ")}return r}},cashReport:{controlType:"widget.ep.cashReport",subTitle:"자금일보",_alwaysLoadByApi:!0,_searchApiURL:"/SVC/Service/EP/GetListCashBookEP",_searchApiParam:{},_menuType:"1",_menuSeq:"17",_newPageUrl:"",_movePageUrl:"/ECERP/EBZ/EBZ001R",_settingUrl:"/ECERP/ECP/ECP001P_10",_functionBtns:["window","refresh"],_optionsLayer:["setting","delete"],_moveUrlInfo:{menuType:"1",menuSeq:"110",subMenu:"M010901000000",subMenuSeq:"110"},getTemplateBody:function(n){var t,i;if($.isNull(n.data))return"";if(n.data.length!=1||$.isEmpty(n.data[0].message))t=n.columns.select(function(n){if(["T.mt_pre_amt","T.mt_dr_amt","T.mt_cr_amt","T.mt_last_amt"].contains(n.id))return n}),t.length>0&&(i={dataType:"9"+ecount.config.company.DEC_AMT,amtCalc:"r",isCheckZero:ecount.config.company.ZERO_CHK_YN,isShowIfZero:ecount.config.company.ZERO_DISPLAY_YN},$.each(n.data,function(n,r){for(var e,f,o,s,u=0;u<t.length;u++)e=r["A"+t[u].index],t[u].align="right",(e+"").indexOf(ecount.delimiter)>0&&(f=e.split(ecount.delimiter),f.length>1&&(o=ecount.convertor.getDecimalValueByConvertor(f[0].trim()||"0",i),s=ecount.convertor.getDecimalValueByConvertor(f[1].trim(),i),r["A"+t[u].index]=s==""?o:o+"<br/>("+s+")"))}));else return n.data[0].message;return this._super.getTemplateBody.apply(this,arguments)}},salesPurchase:{controlType:"widget.ep.salesPurchase",subTitle:"매입매출장",_alwaysLoadByApi:!0,_searchApiURL:"/SVC/Service/EP/GetListSalesPurchaseBookEP",_searchApiParam:{},_menuType:"1",_menuSeq:"17",_newPageUrl:"",_movePageUrl:"/ECERP/SVC/EBZ/EBZ060R",_settingUrl:"/ECERP/ECP/ECP001P_11",_functionBtns:["window","refresh"],_optionsLayer:["setting","delete"],_moveUrlInfo:{menuType:"1",menuSeq:"362",subMenu:"M010907030000",subMenuSeq:"362"}},ecTaxError:{controlType:"widget.ep.ecTaxError",subTitle:"(세금)계산서진행단계",_alwaysLoadByApi:!0,_searchApiURL:"/SVC/Common/SlipTransfer/GetEPListXFormSlipAccountCommon",_searchApiParam:{PRG_ID:"E010849"},_menuType:"1",_menuSeq:"79",_newPageUrl:"/ECERP/SVC/EBD/EBD010M_09",_movePageUrl:"/ECERP/SVC/ECTAX/ECTAX023M",_settingUrl:"/ECERP/ECP/ECP001P_16",_functionBtns:["window","refresh","new"],_optionsLayer:["setting","delete"],_moveUrlInfo:{menuType:"1",menuSeq:"1322",subMenu:"M011008000000",subMenuSeq:"1322"},_needRequire:"ecmodule.account.common",init:function(){this._super.init.apply(this,arguments);this.viewBag=ecount.global.findViewBag(this.ecPageID);this.ecTaxAllowSlipPage=["/ECMAIN/EBD/EBD010M_09.ASPX","/ECMAIN/EBD/EBD001M.ASPX","/ECERP/EBD/EBD010M_09","/ECERP/EBD/EBD001M","/ECERP/EBD/EBD014M","/ECMAIN/EBD/EBD010M_31.ASPX","/ECERP/EBD/EBD010M_31","/ECERP/ETA/ETA001P_01"]},bodyDataConversion:function(n){for(var t,i,u,l,f=n.columns||[],o=n.data||[],s,h,c,r=0,e=f.length;r<e;r++)f[r].id.toUpperCase()==="FUNCTION"?s=r:f[r].id.toUpperCase()==="SIGNALLAMP"?h=r:f[r].id.toUpperCase()==="HISTORY"&&(c=r);for(r=0,e=o.length;r<e;r++)t=o[r],i=[],t.ECTAX_FLAG!="00"&&t.ECTAX_TYPE=="0"&&t.ECTAX_GB!="AF"?i.push("인증서첨부"):t.ECTAX_FLAG!="00"&&(t.SUBMIT_STATUS=="N"||t.SUBMIT_STATUS=="E")&&i.push("인증서첨부 취소"),t.ECTAX_FLAG!="00"&&t.SUBMIT_STATUS=="N"&&t.ECTAX_GB!="AF"&&t.ECTAX_TYPE!="X"&&i.push("즉시전송"),t.ECTAX_TYPE!="X"&&t.SUBMIT_STATUS=="C"&&t.EMAIL_STATUS!="2"&&t.EMAIL_STATUS!="3"?i.push("Email발송"):(t.EMAIL_STATUS=="2"||t.EMAIL_STATUS=="3")&&t.SUBMIT_STATUS=="C"&&i.push("Email재발송"),t.SUBMIT_STATUS=="C"&&t.ECTAX_FLAG=="99"&&i.push("수정(세금)계산서"),t.ECTAX_FLAG=="00"&&i.push("전자로변환"),t.ECTAX_FLAG!="00"&&t.ECTAX_TYPE=="0"&&t.ECTAX_GB!="AF"&&t.ECTAX_TYPE!="X"?i.push("타발행으로"):t.ECTAX_TYPE=="X"&&i.push("전자로변환"),t.ECTAX_FLAG!="00"&&t.ECTAX_TYPE=="0"&&t.ECTAX_GB!="AF"&&t.ECTAX_TYPE!="X"?i.push("기한후전송"):t.ECTAX_GB=="AF"&&i.push("전자로변환"),t.SUBMIT_STATUS!="E"&&t.SUBMIT_STATUS!="C"&&t.EMAIL_STATUS=="0"&&i.push("예약Mail등록"),t.ECTAX_FLAG!="00"&&t.ECTAX_TYPE=="0"&&t.ECTAX_GB!="AF"?u="인증서 첨부전":t.ECTAX_TYPE=="1"&&$.isEmpty(t.ID_ISSUE)?u="인증서 첨부중":t.SUBMIT_STATUS=="C"?t.EMAIL_STATUS=="2"||t.EMAIL_STATUS=="3"?u="Email발송완료":(u="전송완료",t.EMAIL_STATUS=="1"&&(u+='<span class="text-primary">(Email예약발송)<\/span>')):t.SUBMIT_STATUS=="Y"||t.SUBMIT_STATUS=="R"?(u=t.SUBMIT_STATUS=="R"?"전송접수중":"국세청결과대기",t.EMAIL_STATUS=="1"&&(u+='<span class="text-primary">(Email예약발송)<\/span>')):t.ECTAX_FLAG!="00"&&t.SUBMIT_STATUS=="E"?u="전송에러":t.ECTAX_FLAG!="00"&&t.SUBMIT_STATUS=="N"?(u="전송대기",t.EMAIL_STATUS=="1"&&(u+='<span class="text-primary">(Email예약발송)<\/span>')):u=t.ECTAX_FLAG!="00"&&t.ECTAX_TYPE=="X"?"타발행(세금)계산서":t.ECTAX_FLAG!="00"&&t.ECTAX_GB=="AF"?"기한후전송 (세금)계산서":"대상아님",l=t.PRG_URL&&t.PRG_URL.toUpperCase()!="/ECMAIN/ETA/ETA004M.ASPX"?"이력":"N",t["A"+s]=i.join(ecount.delimiter),t["A"+h]=u,t["A"+c]=l;return this._super.bodyDataConversion.apply(this,arguments)},getTagTemplate:function(n,t,i){var r=t,u=this.epData.body.data[i],e,o,s,f;if(["FUNCTION","HISTORY","IO_DATE","IO_DATE_NO"].contains(n.id)){for(e=t.split(ecount.delimiter),o=0,s=e.length;o<s;o++)e[o]='<a href="javascript:;" data-colCd="'+n.id+'" data-index="'+i+'" data-value="cellValue" data-function="click">'+e[o]+"<\/a>";r=e.join(" ")}else if(["PRINT"].contains(n.id))r='<a href="javascript:;" data-colCd="'+n.id+'" data-index="'+i+'" data-value="cellValue" data-function="click">'+ecount.resource.BTN00054+"<\/a>";else if(["ECTAX_FLAG_DES"].contains(n.id)){f="";switch(u.ECTAX_FLAG){case"99":f=ecount.resource.LBL06765;break;case"00":f=ecount.resource.LBL14150;break;default:f=ecount.resource.LBL01155}r=(u.ECTAX_TYPE!="0"&&u.ECTAX_TYPE!="X"||u.ECTAX_TYPE=="X"||u.ECTAX_GB=="AF")==!1?'<a href="javascript:;" data-colCd="'+n.id+'" data-index="'+i+'" data-value="cellValue" data-function="click">'+f+"<\/a>":f}else if(["SIGNALLAMP"].contains(n.id))r='<span data-colCd="'+n.id+'" data-index="'+i+'" data-value="cellValue" data-function="click">'+t+"<\/span>";else if(["ACC301.s_detail"].contains(n.id))switch(u.S_SYSTEM){case"S":r='<a href="javascript:;" data-colCd="viewTrans" data-index="'+i+'" data-value="cellValue" data-function="click">'+ecount.resource.BTN00316+'<\/a><a href="javascript:;" data-colCd="salesSlip" data-index="'+i+'" data-value="cellValue" data-function="click">'+ecount.resource.BTN00487+"<\/a>";break;case"C":r='<a href="javascript:;" data-colCd="viewTrans" data-index="'+i+'" data-value="cellValue" data-function="click">'+ecount.resource.BTN00316+'<\/a><a href="javascript:;" data-colCd="estimated" data-index="'+i+'" data-value="cellValue" data-function="click">'+ecount.resource.LBL12578+"<\/a>";break;case"B":case"P":r=ecount.resource.BTN00316;break;default:r=u.TRX_NO=="0"?ecount.resource.LBL01625:ecount.resource.LBL03146}return r},setUIAfterBodyLoad:function(n){var r,t,u,i;for(this._super.setUIAfterBodyLoad.apply(this,arguments),r=this.$el.find("a[data-colCd=PRINT]"),t=0,u=r.length;t<u;t++)i=r.eq(t),index=Number(i.attr("data-index")),rowItem=n.body.data[index],(this.isFromCS||$.isNull(rowItem.LATELY_DATE))&&(!this.isFromCS||$.isNull(rowItem.CS_LATELY_DATE))||i.addClass("text-warning-inverse"),i.attr("data-toggle","popover").popover({content:$.isEmpty(rowItem.LATELY_DATE)?ecount.resource.LBL40265.unescapeHTML():String.format(ecount.resource.LBL40266,rowItem.LATELY_ID,Date.ecFormat("G",rowItem.LATELY_DATE)),container:"body",placement:"left",trigger:"hover",html:!0,delay:{show:400,hide:0}})},openWindow:function(n){n.param&&(this.defaultParam=n.param);this.openPopup(n)},onMessage:function(n,t){switch(n.pageID){case"ES300M":ecount.common.api({ecPageID:this.ecPageID,url:"/Account/ETaxInvoice/GetEctaxEmailStatusUpdate",data:Object.toJSON({EmailInfomation:t,Slips:this.ecTaxattachmentECTAXRequestBaseInfo.Slips}),error:function(){ecount.alert("예약Mail등록 처리 시 Error",function(){this.hideProgressbar()}.bind(this))}.bind(this),success:function(){this.reload();this.hideProgressbar()}.bind(this)});break;case"EBD001M":case"ETA001P_01":case"ESD006M":case"ECTAX000P":case"EBD010M_09":case"ECTAX023P_01_KR":default:n.close();this.reload()}},ON_CLICK_CELLVALUE:function(n){var c=Number($(n).attr("data-index")),i=$(n).attr("data-colCd"),t={columns:this.epData.body.columns,data:this.epData.body.data[c],colCd:i,text:$(n).text()},i=t.colCd,s=t.text,u,r,e,o,h,f;if(["IO_DATE","IO_DATE_NO"].contains(i))this.fnEcTaxDateNoLink(t.data);else if(i=="PRINT")this.fnEcTaxPrint(t.data);else if(i=="HISTORY")this.fnEctaxHistory(t.data);else if(i=="FUNCTION")u=!0,u=this.checkPermission(function(){this.hideProgressbar()}.bind(this),s),u&&this.fnEcTaxFuncForStep(t.data,s);else if(i=="ECTAX_FLAG_DES"){if(u=this.checkPermission(function(){this.hideProgressbar()}.bind(this)),u){switch(t.data.ECTAX_FLAG){case"00":r=ecount.resource.LBL04842||"종이(세금)계산서";break;case"99":r=ecount.resource.LBL04785||"전자(세금)계산서";break;case"01":r=ecount.resource.LBL04808||"기재사항착오정정";break;case"02":r=ecount.resource.LBL04809||"공급가액변동";break;case"03":r=ecount.resource.LBL04810||"환입";break;case"04":r=ecount.resource.LBL04811||"계약의해제";break;case"05":r=ecount.resource.LBL04812||"내국신용장개설";break;case"06":r=ecount.resource.LBL07080||"착오에의한이중발행"}this.defaultParam={width:ecount.infra.getPageWidthFromConfig(!0),height:250,editFlag:"M",IO_DATE:t.data.IO_DATE,IO_NO:t.data.IO_NO,ECTAX_FLAG:t.data.ECTAX_FLAG,ECTAX_FLAG_DES:r,VERSION_NO:t.data.VERSION_NO,TRX_DATE:t.data.TRX_DATE,TRX_NO:t.data.TRX_NO,ORG_ID_ISSUE:t.data.ORG_ID_ISSUE,S_SYSTEM:t.data.S_SYSTEM,isCloseDisplayFlag:!0,popupType:!0,additional:!1};this.openPopup({url:"/ECERP/Popup.Form/ECTAX023P_01"})}}else i=="SIGNALLAMP"?(this.defaultParam={width:520,height:300,IO_DATE:t.data.IO_DATE,IO_NO:t.data.IO_NO,ID_ISSUE:t.data.ID_ISSUE||""},this.openPopup({url:"/ECERP/Popup.Form/ECTAX023P_02"})):i=="viewTrans"?(e="B",o=t.data.TRX_TYPE+t.data.SER_NO,t.data.S_SYSTEM=="C"&&(e="C",o=t.data.TRX_DATE+t.data.TRX_NO),this.defaultParam={Request:{Data:{TrxDate:t.data.TRX_DATE,TrxNo:t.data.TRX_NO,S_system:t.data.S_SYSTEM,ConfirmFlag:t.data.GB_TYPE=="Y"?"9":"1",PermitCode:"40",rbRptSort:e,PermitCodeNew:o,FromProgramId:"E010849"},FromProgramId:"E010849"},width:850,height:500},this.openPopup({url:"/ECERP/SVC/EBZ/EBZ032P_03"})):i=="salesSlip"?ecount.common.api({url:"/Account/Common/GetSellDetail",ecPageID:this.ecPageID,data:{TRX_DATE:t.data.TRX_DATE,TRX_NO:t.data.TRX_NO},success:function(n){if(n.Status!="200")ecount.alert("error");else{var t=[];$.each(n.Data,function(n,i){t.push({IO_DATE:i.IO_DATE,IO_NO:i.IO_NO,SER_NO:i.SER_NO,IO_TYPE:i.IO_TYPE,GB_TYPE:i.GB_TYPE,CUST:i.CUST})});this.defaultParam={width:1e3,height:850,Request:{Slips:t,DivisionType:"ACCOUNT",FORM_TYPE:"SF030",BASIC_TYPE:"0",TAX_FLAG:"N",cs_flag:this.isFromCS&&this.isFromCS===!0?"Y":"N",allP_Flag:"Y",fax_Flag:"Y",Data:{FROM_DATE:"",TO_DATE:"",TradingStatementPrintingYn:"Y",IS_FROM_SALES_BATCH_PRINT:"Y",IsBill:!0},FromProgramId:"E010849"}};this.openPopup({url:"/ECERP/SVC/ESD/ESD007R"})}}.bind(this)}):i=="estimated"&&(h={TRX_DATE:t.data.TRX_DATE,TRX_NO:t.data.TRX_NO},f=[],ecount.common.api({url:"/Account/ContractMgmt/GetListACMNContractBillDetailListByTrx",ecPageID:this.ecPageID,data:h,success:function(n){if(n.Status!="200")ecount.alert("error");else{var t="",i="",r="",u="";n.Data!=null&&n.Data.length>0?($.each(n.Data,function(n,f){t+=f.BILL_DATE+ecount.delimiter;i+=f.BILL_NO+ecount.delimiter;r+=f.BILL_SER+ecount.delimiter;u+=f.CUST+ecount.delimiter}),f.push({IO_DATE:t.substring(t.length-1,0),IO_NO:i.substring(i.length-1,0),SER_NO:r.substring(r.length-1,0),CUST:u.substring(u.length-1,0)})):f.push({IO_DATE:"",IO_NO:"",SER_NO:"",CUST:""});this.defaultParam={width:1e3,height:850,Request:{Slips:f,FORM_TYPE:"AF810",BASIC_TYPE:"0",cs_flag:"N",fax_Flag:"Y",TradingStatementPrintingYn:"Y",IsBill:!1}};this.openPopup({url:"/ECERP/SVC/EBP/EBP009P_02"})}}.bind(this)}))},checkPermission:function(n,t){var i;if(t=="예약Mail등록"||t=="Email발송"||t=="Email재발송"){if(this.viewBag.Permission.ecTaxError.UPD==!0&&this.viewBag.Permission.ecTaxError.CS==!1||this.viewBag.Permission.ecTaxError.UPD!=!0&&this.viewBag.Permission.ecTaxError.Value!="W"&&this.viewBag.Permission.ecTaxError.Value!="U")return i=ecount.common.getAuthMessage("",[{MenuResource:"(세금)계산서진행단계",PermissionMode:"CS"}]),ecount.alert(i.fullErrorMsg),n&&n(),!1}else if(this.viewBag.Permission.ecTaxError.UPD==!0&&this.viewBag.Permission.ecTaxError.CW==!1||this.viewBag.Permission.ecTaxError.UPD!=!0&&this.viewBag.Permission.ecTaxError.Value!="W"&&this.viewBag.Permission.ecTaxError.Value!="U")return i=ecount.common.getAuthMessage("",[{MenuResource:"(세금)계산서진행단계",PermissionMode:"W"}]),ecount.alert(i.fullErrorMsg),n&&n(),!1;return!0},fnEcTaxDateNoLink:function(n){var i=this,t={};t.PARAM={width:800,height:600,EditFlag:"M",s_system:n.S_SYSTEM,hidEditFlag:"M",hidNewFrm:"Y",IoDateOfJournalView:n.IO_DATE,IoNoOfJournalView:n.IO_NO,isOpenPopup:!0,isSearchXml:!1,isEPWidget:!0};t.hidSearchData={TRX_DATE:n.TRX_DATE,TRX_NO:n.TRX_NO,TRX_TYPE:n.TRX_TYPE,SER_NO:n.SER_NO,PRG_URL:n.PRG_URL,PARENT_URL:""};t.isCheckinventory=ecount.config.inventory.USE_BALANCE_BASIS==!1?!0:!1;t.isCheckbonddebitUpDown=!0;t.callback=function(t){if(t.URL){t.URL.indexOf("ETA004M")>-1?(t.PARAM.IO_DATE=n.IO_DATE,t.PARAM.IO_NO=n.IO_NO,t.PARAM.Io_Type=n.TRX_TYPE,t.PARAM.isOpenPopup=!0):(!t.URL.toUpperCase().equals("/ECERP/ESD/ESD006M")||$.isEmpty(t.PARAM.IO_DATE))&&(t.PARAM.IO_DATE=n.TRX_DATE,t.PARAM.IO_NO=n.TRX_NO,t.PARAM.Io_Type=n.SER_NO);t.URL.toUpperCase().equals("/ECERP/SVC/ESD/ESD006M")?t.PARAM={Request:{Key:{Date:n.IO_DATE,No:n.IO_NO},EditMode:ecenum.editMode.modify,FromProgramId:"E010849",UIOption:{Width:800,Height:600}}}:(t.URL.toUpperCase().equals("/ECERP/SVC/EBD/EBD010M_09")||t.URL.toUpperCase().equals("/ECERP/SVC/EBD/EBD001M"))&&(t.PARAM={Request:{Key:{Date:n.TRX_DATE,No:n.TRX_NO},EditMode:ecenum.editMode.modify,FromProgramId:"E010849",UIOption:{Width:800,Height:600}},TrxType:n.TRX_TYPE,SerNo:n.SER_NO});var r={url:t.URL,param:t.PARAM,tabId:"all"};(t.URL.indexOf("ETA004M")>-1||t.URL.indexOf(".aspx")>-1)&&(r.popupType=!0);i.openWindow(r)}};t.ecPageID=i.ecPageID;ecmodule.account.common.checkConnectInvoice(t)},fnEcTaxPrint:function(n){var r,t,i;if(n.IO_TYPE!=""&&n.IO_TYPE!="11"&&n.IO_TYPE!="12"&&n.IO_TYPE!="13"&&n.IO_TYPE!="15"&&n.IO_TYPE!="18"&&n.IO_TYPE!="19")return ecount.alert(ecount.resource.MSG06141),!1;r=this;t=[];t.push({IO_DATE:n.IO_DATE,IO_NO:n.IO_NO,SER_NO:"0",IO_TYPE:"",GB_TYPE:n.GB_TYPE,CUST:"",SUBMIT_STATUS:n.SUBMIT_STATUS});i={width:800,height:600,Request:{Slips:t,FORM_TYPE:"AF080",FORM_SEQ:n.NO_FORM,BASIC_TYPE:"0",cs_flag:"N",fax_Flag:"Y",S_SYSTEM:n.S_SYSTEM,SUPPLIER_PRINT_YN:ecount.config.company.SUPPLIER_PRINT_YN,PURCHASER_PRINT_YN:ecount.config.company.PURCHASER_PRINT_YN,IsEtax:!0}};this.openWindow({url:"/ECERP/SVC/EBZ/EBZ032P_07",name:ecount.resource.LBL04906,param:i,popupType:!1})},fnEctaxHistory:function(n){var t;n.PRG_URL.toUpperCase().indexOf("ETA004M")>-1?(t={hidHistoryDate:n.IO_DATE,hidHistoryNo:n.IO_NO,hiLastData:String.format("{0}[{1}]",ecount.infra.getECDateFormat("DATE11",!1,n.UPDATE_DATE.toDate()),n.LOGID),hidPageGubun:"P"},this.openWindow({url:"/ECMain/CM2/ES/ES303P.aspx",name:"전자(세금)계산서이력",param:t,popupType:!0,fpopupID:this.ecPageID})):(t={IO_DATE:n.IO_DATE,IO_NO:n.IO_NO,TRX_DATE:n.TRX_DATE||"",TRX_NO:n.TRX_NO},this.openWindow({width:570,height:530,url:"/ECERP/Popup.Form/ECTAX023P_03",name:"전자(세금)계산서이력",param:t,popupType:!1,fpopupID:this.ecPageID}))},fnEcTaxFuncForStep:function(n,t){var u,r,f,i,e,o,s,h;if(t=="인증서첨부")i=[{IO_DATE:n.IO_DATE,IO_NO:n.IO_NO,SlipIssueType:n.S_SYSTEM,VersionNo:n.VERSION_NO}],ecount.document.openPopupCertificate(this,"/ECERP/SVC/ECTAX/ECTAX023M",this.viewBag.DefaultOption.This_Business_No,i,!1);else if(t=="타발행으로"||t=="기한후전송"||t=="전자로변환")u="99",r="X",t=="기한후전송"?r="B":t=="전자로변환"&&(r=n.ECTAX_FLAG=="00"?"99":n.ECTAX_FLAG,u="00",n.ECTAX_GB=="AF"&&(u="B",r="99")),i=[{IO_DATE:n.IO_DATE,IO_NO:n.IO_NO,TRX_DATE:n.TRX_DATE,TRX_NO:n.TRX_NO,VersionNo:n.VERSION_NO,List_Type:u,Action_Type:r}],this.showProgressbar(),ecount.common.api({ecPageID:this.ecPageID,parentData:this._getPopupMetadata(),url:"/SVC/Account/ETaxInvoice/ECTAXEtcProcessing",data:Object.toJSON({RequestSlips:i,isSendMessage:ecenum.useYn.yes,Key:String.format("{0}-{1}",n.IO_DATE,n.IO_NO)}),success:function(n){var t=n.Data.where(function(n){return n.Error_Flag=="Y"}),i,r;t.length==0?this.reload():(i=this.setDataCustom(t),r={name:"frmDetail",width:650,height:500,Result_Datas:i,popupType:!1,additional:!1},this.openWindow({url:"/ECERP/ECTAX/NoticeCanNotSlips",param:r}));this.hideProgressbar()}.bind(this)});else if(t=="인증서첨부 취소")i=[{ID_ISSUE:n.ID_ISSUE,VersionNo:n.VERSION_NO,TRX_DATE:n.TRX_DATE,TRX_NO:n.TRX_NO,SUBMIT_STATUS:n.SUBMIT_STATUS}],ecount.confirm("선택하신 전표를 발행취소 하시겠습니까?",function(t){t?(this.showProgressbar(),ecount.common.api({ecPageID:this.ecPageID,parentData:this._getPopupMetadata(),url:"/SVC/Account/ETaxInvoice/CancelIssue",data:Object.toJSON({CancelIssueCollection:i,isSendMessage:ecenum.useYn.yes,Key:String.format("{0}-{1}",n.IO_DATE,n.IO_NO)}),success:function(n){var t=n.Data.where(function(n){return n.Error_Flag=="Y"}),i,r;t.length==0?(this.reload(),this.hideProgressbar()):(i=this.setDataCustom(t),r={name:"frmDetail",width:650,height:500,Result_Datas:i,popupType:!1,additional:!1},this.openWindow({url:"/ECERP/ECTAX/NoticeCanNotSlips",param:r}))}.bind(this)})):this.hideProgressbar()}.bind(this));else if(t=="수정(세금)계산서"){f=n.TAX_FLAG!="T"&&n.S_SYSTEM!="S"?"0":n.S_SYSTEM=="S"?"S":"T";function c(t){if(n.TAX_FLAG==="T"){t&&t(!0);return}ecount.infra.getVersionCheck({Version_No:n.VERSION_NO,IO_DATE:n.TRX_DATE,IO_NO:n.TRX_NO,IO_TYPE:null,UID:null,EDMS_FLAG:null,ResultData:null,EDMS_IDX:null,VoucherType:"ACCT",callback:function(n){n?$.isFunction(t)==!0&&t():ecount.alert(String.format(ecount.resource.MSG01088,"",""))}.bind(this)})}c(function(){this.openWindow({url:"/ECERP/SVC/ECTAX/ECTAX023P_01_KR",param:{width:860,height:650,Request:{Data:{ORIGINAL_TRX_DATE:n.TAX_FLAG==="T"?n.IO_DATE:n.TRX_DATE,ORIGINAL_TRX_NO:n.TAX_FLAG==="T"?n.IO_NO:n.TRX_NO,ORIGINAL_VERSION_NO:n.VERSION_NO,ORIGINAL_SLIPISSUETYPE:f,ORIGINAL_SLIP_URL:n.PRG_URL,ORIGINAL_TRX_TYPE:n.TRX_TYPE,ORIGINAL_SER_NO:n.SER_NO,ORIGINAL_IO_TYPE:n.IO_TYPE}},NEW_FLAG:this.ecTaxAllowSlipPage.contains(n.PRG_URL.toUpperCase())==!0?"Y":"N",modal:!0}})}.bind(this))}else t=="즉시전송"?(i=[{ID_ISSUE:n.ID_ISSUE,VersionNo:n.VERSION_NO,IO_DATE:n.IO_DATE,IO_NO:n.IO_NO}],e="국세청에 전송하시겠습니까?",[0].contains(this.viewBag.LocalTime.toDate().getHours())&&(e="현재‘인증서 첨부 시스템’정기점검 중입니다.<\/br>* 점검 시간 : 00시 ~ 01시 (1시간)<\/br><\/br>점검 시간내에 ‘즉시전송‘ 한 전자(세금)계산서는<\/br>점검 완료 후, 국세청에 일괄 전송되며<\/br>발행 취소는 할 수 없습니다.<\/br><\/br>계속 진행하시겠습니까?"),ecount.confirm(e,function(n){n?(this.showProgressbar(),ecount.common.api({ecPageID:this.ecPageID,url:"/SVC/Account/ETaxInvoice/NtsSend",data:Object.toJSON({NtsSendCollection:i,CheckPermissionRequest:{EditMode:ecenum.editMode.new,ProgramId:"E010849"}}),error:function(){ecount.alert("즉시전송 처리 시 Error",function(){this.hideProgressbar()}.bind(this))}.bind(this),success:function(n){var t=n.Data.where(function(n){return n.Error_Flag=="Y"}),i,r;t.length==0?(this.reload(),this.hideProgressbar()):(i=this.setDataCustom(t),r={name:"frmDetail",width:650,height:500,Result_Datas:i,popupType:!1,additional:!1},this.openWindow({url:"/ECERP/ECTAX/NoticeCanNotSlips",param:r}))}.bind(this)})):this.hideProgressbar()}.bind(this))):t=="예약Mail등록"?(this.ecTaxattachmentECTAXRequestBaseInfo={BusinessNo:this.viewBag.DefaultOption.This_Business_No,Page:"/ECErp/SVC/ECTAX/ECTAX023M",RearwardFlag:"N",Slips:[{IO_DATE:n.IO_DATE,IO_NO:n.IO_NO,SlipIssueType:0,VersionNo:n.VERSION_NO,HID:n.HID,ID_ISSUE:n.ID_ISSUE,S_SYSTEM:n.S_SYSTEM}]},ecount.confirm("국세청전송완료 후 전자(세금)계산서 메일을 자동발송하시겠습니까?",function(t){var i,r;t&&(i={width:1200,height:800,FORM_TYPE:"ELECTRIC",DATE_LIST:n.IO_DATE,NO_LIST:n.IO_NO,IsNotAttachment:this.IsService?!0:!1},this.defaultParam=i,r={width:1200,height:1e3,Request:{FORM_TYPE:"ELECTRIC",DATE_LIST:n.IO_DATE,NO_LIST:n.IO_NO,IsNotAttachment:this.IsService?!0:!1,S_SYSTEM:n.S_SYSTEM,NotiProgramId:"C001158",CheckPermissionRequest:{EditMode:ecenum.editMode.smsFaxEmailSend,ProgramId:"E010849"}}},this.openWindow({url:"/ECERP/SVC/Popup/SendOutside",param:r,popupType:!1}))}.bind(this))):(t=="Email발송"||t=="Email재발송")&&(o=[],s=[],o.push({IO_DATE:n.IO_DATE,IO_NO:n.IO_NO,SER_NO:"0",IO_TYPE:"",GB_TYPE:"Y",NO_FORM:n.NO_FORM,CUST:"",S_SYSTEM:n.S_SYSTEM,SUBMIT_STATUS:n.SUBMIT_STATUS}),s.push({IO_DATE:n.IO_DATE,IO_NO:n.IO_NO,TRX_DATE:n.TRX_DATE||"",TRX_NO:n.TRX_NO}),h={width:1200,height:1e3,Request:{Slips:o,TrxDataInfos:s,FORM_TYPE:"ECTAX",FORM_SEQ:n.NO_FORM,S_SYSTEM:n.S_SYSTEM,TradingStatementPrintingYn:"N",BASIC_TYPE:"0",NotiProgramId:"C001161",CheckPermissionRequest:{EditMode:ecenum.editMode.smsFaxEmailSend,ProgramId:"E010849"}}},this.openWindow({url:"/ECERP/SVC/Popup/SendOutside",param:h}))},setDataCustom:function(n){var t=[];return n.forEach(function(n){var i={IO_DATE:String.format("{0}/{1}/{2}",n.IO_DATE.substring(0,4),n.IO_DATE.substring(4,6),n.IO_DATE.substring(6,8)),IO_NO:n.IO_NO,ERROR_MESSAGE:n.ResultAttachmentECTAX.select(function(n){return n.Error_Message})};t.push(i)}),t.toJSON()},onClickAlertLink:function(){var n={width:this.viewBag.InitDatas.AlertManual.PopupWidth,height:this.viewBag.InitDatas.AlertManual.PopupHeight};this.openWindow({url:"/ECERP/SVC/EAM/EAM012M?boardType=A&seq="+this.viewBag.InitDatas.AlertManual.BoardSeq,name:ecount.resource.LBL07973,param:n,popupType:!0,additional:!1})},onClickEctaxAlertLink:function(){var n={width:this.viewBag.InitDatas.AlertManualEcTax.PopupWidth,height:this.viewBag.InitDatas.AlertManualEcTax.PopupHeight};this.openWindow({url:"/ECERP/SVC/EAM/EAM012M?boardType=A&seq="+this.viewBag.InitDatas.AlertManualEcTax.BoardSeq,name:ecount.resource.LBL07973,param:n,popupType:!0,additional:!1})},_getPopupMetadata:function(n){return n=n||{},n.parentPageID=this.popupID||this.pageID,n.__ecPageID=this.ecPageID,n.popupLevel=n.popupLevel==undefined?this.popupLevel?parseInt(this.popupLevel)+1:1:parseInt(n.popupLevel)+1,n.responseID=this.callbackID,n.alreadyIncludedLayout=!0,this.__ecOpenPopup==="popupType3fromIframe"&&(n.alreadyIncludedLayout=!0),n}},tutorial:{controlType:"widget.ep.tutorial",subTitle:"이카운트 시작하기",_alwaysLoadByApi:!0,_searchApiURL:"/SelfCustomize/Tutorial/GetListCoepTutorial",_searchApiParam:{},_menuType:"6",_menuSeq:"0",_newPageUrl:"",_movePageUrl:"/ECERP/ESC/ESC004M?RPTGUBUN=53&sub_menu=9999&m_type=T",_settingUrl:"",_functionBtns:["window","refresh"],_optionsLayer:["delete"],_moveUrlInfo:{menuType:"6",menuSeq:"0",subMenu:"9999"},_urlList:{videoAPI:"/SelfCustomize/Tutorial/GetListComnTutorialVideo",videoCollection:"/ECERP/ESC/ESC004M_02?menu_seq={0}",manualPage:"/ECERP/SVC/ECU/ECU930M?navIndex=1&menu_seq={0}&PRG_ID={1}",completeGuideMenu:"/SelfCustomize/Tutorial/CompleteCoepTutorial",checkMenuPermissionAPI:"/SelfCustomize/Tutorial/GetComnMenuAuthPermission",forbiddenPage:"/ECERP/Infra/Forbidden",checkAccessibleMenuAPI:"/SelfCustomize/Tutorial/GetAccessibleMenu"},_listMenuNotReference:[235,629,265,270,781],getTemplateBody:function(n){var u,r,t,i,e;if($.isEmptyObject(n))return"";for(r=0;r<n.length;r++)u=!1;var f=[],o=['<table class="table table-striped table-layout-auto">',"<thead>","<tr>","<th>"+ecount.resource.LBL00752+"<\/th>","<th>"+ecount.resource.LBL01296+"<\/th>","<th>"+ecount.resource.LBL08885+"<\/th>","<th>"+ecount.resource.LBL10800+"<\/th>","<th>"+ecount.resource.LBL80098+"<\/th>","<\/tr>","<\/thead>","<tbody>","{{body}}","<\/tbody>","<\/table>"].join("\n");for(r=0,e=n.length;r<e;r++)t=n[r],i=["<tr>"],i.push(String.format("<td>{0}<\/td>",t.PARENT_MENU_MN!=null?t.PARENT_MENU_MN:t.GROUP_CD)),$.inArray(t.MENU_SEQ,this._listMenuNotReference)>-1?i.push(String.format("<td>{0} ({1})<\/td>",t.MENU_MN,t.DATA_NO&&t.DATA_NO>0?t.DATA_NO:"0")):i.push(String.format('<td><a href="javascript:;" data-value="cellMenu" data-nmKey="{0}" data-menuUrl="{1}" data-prgKey="{4}" data-function="click">{2} {3}<\/a><\/td>',t.MENU_SEQ,t.MENU_URL,t.MENU_MN,t.DATA_NO&&t.DATA_NO>0?"("+t.DATA_NO+")":"",t.PRG_ID)),u&&(t.SCENARIO_ID&&t.SCENARIO_ID!=undefined?i.push(String.format('<td class="text-center"><a href="javascript:;" data-value="cellTutorial" data-function="click" data-noVid="{0}" data-nmKey="{1}" data-prgKey="{2}" class="text-muted-primary"><span class="qm-icon-tutorial event-target "><\/span><\/a><\/td>',t.SCENARIO_ID,t.MENU_SEQ,t.PRG_ID)):i.push(String.format("<td><\/td>",""))),t.VIDEO_TOTAL&&t.VIDEO_TOTAL>0?i.push(String.format('<td class="text-center"><a href="javascript:;" data-value="cellVideo" data-function="click" data-noVid="{0}" data-nmKey="{1}" data-prgKey="{2}" class="text-muted-primary"><span class="fa fa-youtube-play"><\/span><\/a><\/td>',t.SCENARIO_ID,t.MENU_SEQ,t.PRG_ID)):i.push(String.format("<td><\/td>","")),i.push(String.format('<td class="text-center"><a href="javascript:;" data-value="cellManual" data-function="click" data-nmKey="{0}" data-prgKey="{1}" class="text-muted-primary"><span class="fa fa-file-text"><\/span><\/a><\/td>',t.MENU_SEQ,t.PRG_ID)),i.push(String.format('<td class="text-center"><a href="javascript:;" data-value="cellDelete" data-function="click" data-nmKey="{0}" data-prgKey="{1}" class="text-muted-primary"><span class="fa fa-trash"><\/span><\/a><\/td>',t.MENU_SEQ,t.PRG_ID)),i.push("<\/tr>"),f.push(i.join("\n"));return""+ecount.widget.replaceAttr(o,{body:f.join("\n")})},setBodyByApi:function(n,t){var i;(this.epData.EditFlag=="I"||t==!0)&&this.$el.attr("ep-id",this.id);$.extend(this.epData,{data:n});i=this.epData.allowed===!1?this.requestForPermissionTemplate:this.getTemplateBody(this.epData.data||{});this.$el.find("div.panel-body > div").empty().append(i);this.epData.EditFlag="M";this._refresh=!1;this.setUIAfterBodyLoad(this.epData);this.hideLoadingbar()},setUIAfterBodyLoad:function(){for(var r=this.$el.find("table > tbody > tr > td:first-child"),u=null,e="",n=1,t=0,i,f;t<=r.length;t++)t==r.length?n>1&&u.attr("rowspan",n):(i=$(r[t]),f=i.text(),e!=f?(n>1&&u.attr("rowspan",n),u=i,e=f,n=1):(i.remove(),n++));this._super.setUIAfterBodyLoad.apply(this,arguments)},openWindow:function(n){n.param&&(this.defaultParam=n.param);this.openPopup(n)},ON_CLICK_CELLVIDEO:function(n){var i=n.getAttribute("data-noVid"),t=n.getAttribute("data-nmKey");i==1?this._openSingleVideo(t):this._openVideoCollection(t)},ON_CLICK_CELLMANUAL:function(n){var t=n.getAttribute("data-nmKey"),i=n.getAttribute("data-prgKey");this._openManualPopup(t,i)},ON_CLICK_CELLDELETE:function(n){var i=n.getAttribute("data-nmKey"),t=this,r={KEY:{MENU_SEQ:i}};ecount.common.api({ecPageID:this.ecPageID,url:t._urlList.completeGuideMenu,data:JSON.stringify(r),success:function(n){if(n.Status!="200"){ecount.alert(n.fullErrorMsg);return}t.onMessage(t,{type:"reload"})},error:function(n,t,i){ecount.alert(i.Message)}})},ON_CLICK_CELLMENU:function(n){var r=n.getAttribute("data-nmKey"),i=n.getAttribute("data-menuUrl"),t=this;t._checkMenuPermission(r,i,function(n){t._checkAccessibleMenu(n.PERMISSION_ID,function(){t._openReferencePopup(i)})})},ON_CLICK_CELLTUTORIAL:function(n){var t=n.getAttribute("data-noVid");this.openWindow({url:ecount.common.buildSessionUrl("/ECERP/ECP/ECP050M")+"&SCENARIO_ID="+t,name:"",param:{width:930,height:650},popupType:!0,popupID:this.pageID})},_openReferencePopup:function(n){var t=this._prepareReferencePopupUrl(n),i=this._prepareReferencePopupParam(t),r,u;(r=/PRG_ID=(\w*)&?/g.exec(t))&&(u=r[1]);this.openPopup({url:t,name:n,param:i,popupType:t.toLowerCase().indexOf(".aspx")!=-1,fpopupID:this.ecPageID,isOpenPopup:!1,width:1024,height:768,Request:i.Request,PRG_ID:u||""})},_prepareReferencePopupUrl:function(n){var t=(new Date).toLocaleString();return n},_prepareReferencePopupParam:function(n){var t={};return n.indexOf("ESM004M")!==-1?t.io_type=57:n.indexOf("ESM017M")!==-1?t.io_type=58:n.indexOf("ESP010R")!==-1||n.indexOf("ESP011R")!==-1?t.isReference=!0:n.indexOf("RPT_GUBUN")>-1?t.RPT_GUBUN=n.split("RPT_GUBUN=")[1].substr(0,1):(n.indexOf("/ECERP/SVC/EBD/EBD010M_09")!==-1||n.indexOf("/ECERP/SVC/EBD/EBD010M_10")!==-1)&&(t=$.extend(t,{Request:{EditMode:ecenum.editMode.new,FromProgramId:"",PrevUrl:"",UIOption:{Width:800,Height:600}}})),t},_checkMenuPermission:function(n,t,i){var r=this,u={MENU_SEQ:n,MENU_URL:t};ecount.common.api({ecPageID:this.ecPageID,url:r._urlList.checkMenuPermissionAPI,data:JSON.stringify(u),success:function(n){if(n.Status!="200"){ecount.alert(n.fullErrorMsg);return}$.isEmpty(n.Data.PERMISSION.Value)||n.Data.PERMISSION.Value=="X"?r.openPopUp({url:r._urlList.forbiddenPage,param:{ProgramId:n.Data.PERMISSION_ID,Title:ecount.resource.LBL11137},popupType:!1,width:560,height:398,fpopupID:r.ecPageID}):i&&i(n.Data)},error:function(n,t,i){ecount.alert(i.Message)}})},_checkAccessibleMenu:function(n,t){ecount.common.api({ecPageID:this.ecPageID,url:this._urlList.checkAccessibleMenuAPI,data:JSON.stringify({PROGRAMID:n}),success:function(n){if(n.Status!="200"){ecount.alert(n.fullErrorMsg);return}if(n.Data.ACCESSIBLE_YN=="X"){ecount.alert(ecount.resource.MSG06331);return}t&&t(n)},error:function(n,t,i){ecount.alert(i.Message.replace("\\n","<br/>"))}})},_openSingleVideo:function(n){ecount.common.api({ecPageID:this.ecPageID,url:this._urlList.videoAPI,data:JSON.stringify({Request:{MENU_SEQ:n}}),success:function(n){if(n.Status!="200"){ecount.alert(n.fullErrorMsg);return}n.Data.length!=0&&window.open(n.Data[0].VIDEO_LINK,"viewvideo","width=800px,height=660px,scrollbars=yes,resizable=yes")},error:function(n,t,i){ecount.alert(i.Message)}})},_openVideoCollection:function(n){this.defaultParam={menuType:"flowChart"};this.openPopup({type:"GET",url:String.format(this._urlList.videoCollection,n),name:ecount.resource.LBL08885,param:{MENU_SEQ:n},popupType:!1,additional:!1})},_openManualPopup:function(n,t){this.openPopup({url:String.format(this._urlList.manualPage,n,t),name:"View Manual",width:1024,height:768,popupType:!1,fpopupID:this.ecPageID,menu_seq:n,PRG_ID:t})}},memo:{controlType:"widget.ep.memo",subTitle:"메모",_alwaysLoadByApi:!0,_searchApiURL:"/Service/EP/GetListMemoForWidget",_searchApiParam:{},_newPageUrl:"",_movePageUrl:"/ECMain/ECP/ECP201M.aspx",_settingUrl:"",_functionBtns:["window","refresh","new"],_optionsLayer:["delete"],_editFlag:"",_currentData:{},panelCss:"panel-ep-memo",editorTemplate:'<div class="wrapper-memo-write" style="display: none;">\n<textarea class="form-control"><\/textarea>\n<\/div>',getTemplateBody:function(n){var r,f,t;if($.isNull(n.data))return"";if($.isEmpty(n.data))return"<div>"+ecount.resource.MSG00205+"<\/div>"+this.editorTemplate;var e=['<table class="table table-border-no-a table-hover table-striped table-ellipsis">',"<colgroup>",'<col class="col1">','<col class="col2">',"<\/colgroup>","<tbody>","{{body}}","<\/tbody>","<\/table>",this.editorTemplate,].join("\n"),i=[],u=[];for(r=0,f=n.data.length;r<f;r++)i=[],t=n.data[r],i.push("<tr>"),i.push(String.format('<td><a href=\'javascript:;\' data-no="{0}" data-date="{1}" data-memo="{2}" data-value="cellValue" data-function="click">{3}<\/a><\/td>',t.NO_MEMO,t.DT_MEMO,escape(t.TE_MEMO),t.TE_MEMO)),i.push(String.format("<td>{0}<\/td>",ecount.infra.getECDateFormat("DATE10",!1,new Date(t.DT_MEMO.substring(0,4),t.DT_MEMO.substring(4,6)-1,t.DT_MEMO.substring(6,8))))),i.push("<\/tr>"),u.push(i.join("\n"));return""+ecount.widget.replaceAttr(e,{body:u.join("\n")})},getTemplateFooter:function(){return['<div class="panel-footer" style="display: none">','<div class="wrapper-toolbar">','<button class="btn btn-sm btn-primary" data-function="click" data-value="saveButton">'+ecount.resource.BTN00063+"<\/button>",'<button class="btn btn-sm btn-default" data-function="click" data-value="deleteButton">'+ecount.resource.BTN00033+"<\/button>",'<button class="btn btn-sm btn-default" data-function="click" data-value="listButton">'+ecount.resource.LBL01070+"<\/button>","<\/div>","<\/div>"].join("\n")},ON_CLICK_FOLDING:function(){var n=this.$el.find(".panel");n.hasClass("panel-collapsed")&&this._closeEditor();this._super.ON_CLICK_FOLDING.apply(this,arguments)},ON_CLICK_TITLEFOLDING:function(){var n=this.$el.find(".panel");n.hasClass("panel-collapsed")&&this._closeEditor();this._super.ON_CLICK_TITLEFOLDING.apply(this,arguments)},ON_CLICK_NEW:function(){this.$el.find(".panel-collapsed").length==0&&(this._editFlag="I",this._openEditor())},ON_CLICK_WINDOW:function(){console.log("ON_CLICK_WINDOW 메모 새창 클릭 >> ");$("ecMemo").removeClass("open");ecount.popup.openWindow("/ECMain/ECP/ECP201M.aspx?hidIsPopUp=Y","memo",{width:330,height:188},!0)},ON_CLICK_CELLVALUE:function(n){this._editFlag="M";var t=$(n);this._currentData={NO_MEMO:t.attr("data-no"),TE_MEMO:unescape(t.attr("data-memo")||""),DT_MEMO:t.attr("data-date")};this._setValue(this._currentData.TE_MEMO);this._openEditor()},ON_CLICK_SAVEBUTTON:function(){var t=this.$el.find("textarea").val().trim(),n=this;if($.isEmpty(t)){ecount.alert(ecount.resource.MSG03152);return}this._currentData.TE_MEMO=t;this._editFlag=="M"?ecount.common.api({ecPageID:this.ecPageID,url:"/Service/EP/UpdateMemoEpWidget",data:Object.toJSON(n._currentData),success:function(t){if(t.Status!="200"){ecount.alert(ecount.resource.MSG02529);return}n._closeEditor();n.onMessage(n,{type:"reload"})},error:function(){ecount.alert(ecount.resource.MSG02529);return}}):this._editFlag=="I"&&ecount.common.api({ecPageID:this.ecPageID,url:"/Service/EP/SaveMemoEpWidget",data:Object.toJSON(n._currentData),success:function(t){if(t.Status!="200"){ecount.alert(ecount.resource.MSG02529);return}n._closeEditor();n.onMessage(n,{type:"reload"})},error:function(){ecount.alert(ecount.resource.MSG02529);return}})},ON_CLICK_DELETEBUTTON:function(){var n=this;ecount.confirm(ecount.resource.MSG00299,function(t){if(t==!0)ecount.common.api({ecPageID:this.ecPageID,url:"/Service/EP/DeleteMemoEpWidget",data:Object.toJSON(n._currentData),success:function(t){if(t.Status!="200"){ecount.alert(ecount.resource.MSG02529);return}n._closeEditor();n.onMessage(n,{type:"reload"})},error:function(){ecount.alert(ecount.resource.MSG02529);return}});else return})},ON_CLICK_LISTBUTTON:function(){this._closeEditor();this.onMessage(this,{type:"reload"})},_setValue:function(n){this.$el.find("textarea").text(n)},_openEditor:function(){this.$el.find(".wrapper-memo-write").show();this.$el.find(".panel-footer").show();this.$el.find("table").hide();this._editFlag=="I"&&(this.$el.find("[data-value='deleteButton']").hide(),this._setValue(""));this.$el.find("textarea").focus()},_closeEditor:function(){this.$el.find(".wrapper-memo-write").hide();this.$el.find(".panel-footer").hide();this.$el.find("table").show();this.$el.find("[data-value='deleteButton']").show()}},messageBox:{controlType:"widget.ep.messageBox",subTitle:"쪽지함리스트",_dateToday:Date.format("yyyy-MM-dd"),_alwaysLoadByApi:!0,_searchApiURL:"/Service/EP/GetListMessageForWidget",_searchApiParam:{},_newPageUrl:"",_movePageUrl:"/ECERP/SVC/ECC/ECC001M",_settingUrl:"",_functionBtns:["window","refresh","new"],_optionsLayer:["delete"],panelCss:"panel-ep-message-list",bodyDataConversion:function(n){for(var i,t,r={},u=0;u<n.data.length;u++){i=n.data[u];t="";i.LINK_TYPE=i.LINK_TYPE||"1";switch(i.LINK_TYPE){case"S":case"M":case"C":case"P":case"_":t="S";break;case"9":case"*":t="9";break;case"2":case"T":case"U":case"V":case"1":t=i.LINK_TYPE;break;default:t="INV"}r[t]||(r[t]=[]);r[t].push(i)}return $.map(r,function(n){return[n]})},getTemplateBody:function(n){var e="",r,s,t;if($.isNull(n.data))return"";if(this.groups=this.bodyDataConversion(n),$.isEmpty(this.groups))e=ecount.resource.MSG00205;else{var o=[],l='{{title}}\n<table class="table table-hover table-striped table-ellipsis">\n<colgroup>\n<col class="col1">\n<col class="col2">\n<col class="col3">\n<col class="col4">\n<\/colgroup>\n<tbody>\n{{body}}\n<\/tbody>\n<\/table>';for(r=0,s=this.groups.length;r<s;r++){var h=this.groups[r],c="",o=[];for(t=0;t<h.length;t++){var i=[],u=h[t],f=u.CONTENT;f=f.split("\\r\\n").join(" ");f=f.split("\r\n").join(" ");t==0&&(c=this._getTitle(u.LINK_TYPE));i.push("<tr>");i.push(String.format('<td><a href="javascript:;" data-i="{0}" data-j="{1}" data-msgtype=\'msgLink\' data-value="cellValue" data-function="click">{2}<\/a><\/td>',r,t,f));i.push(String.format("<td>{0}<\/td>",u.SENDER_NAME));i.push(String.format("<td>{0}<\/td>",this._getDateOrTime(u.TIME_SEND)));i.push(String.format("<td>{0}<\/td>",this._checkLinkGubun(u.LINK_TYPE,u.LINK_INFO)?String.format('<a href="javascript:;" data-i="{0}" data-j="{1}" data-msgtype=\'msgPage\' data-value="cellValue" data-function="click">A<\/a>',r,t):""));i.push("<\/tr>");o.push(i.join("\n"))}e+=ecount.widget.replaceAttr(l,{title:c,body:o.join("\n")})}}return e},openWindow:function(n){n.param&&(this.defaultParam=n.param);this.openPopup(n)},ON_CLICK_CELLVALUE:function(n){var i=(ecount.user.MEMO_POPUP_TYPE||"D")=="P",r=$(n),u=r.attr("data-msgtype"),t=this.groups[r.attr("data-i")][r.attr("data-j")];switch(u){case"msgLink":this.defaultParam={alreadyIncludedLayout:!i,Request:{Data:{defaultShowMemo:t.Key.COM_CODE+ecount.delimiter+t.Key.MEMO_SEQ}}};break;case"msgPage":this.defaultParam={alreadyIncludedLayout:!i,Request:{Data:{defaultShowMemoLink:{LINK_TYPE:t.LINK_TYPE,LINK_INFO:t.LINK_INFO,COM_CODE:t.Key.COM_CODE,MEMO_SEQ:t.Key.MEMO_SEQ}}}};break;default:return}this.openPopup({url:"/ECERP/SVC/ECC/ECC001M",param:{alreadyIncludedLayout:!i},name:"ECC001M",popupID:"ECC001M_MEMO",parentPageID:"MEMO",popupType:i,width:770,height:570,additional:!0,notCloseMenuChanged:!0})},ON_CLICK_NEW:function(){var n=(ecount.user.MEMO_POPUP_TYPE||"D")=="P";this.defaultParam={alreadyIncludedLayout:!n,Request:{Data:{defaultShowNewMemo:{}}}};this.openPopup({url:"/ECERP/SVC/ECC/ECC001M",param:{alreadyIncludedLayout:!n},name:"ECC001M",popupID:"ECC001M_MEMO",parentPageID:"MEMO",popupType:n,width:770,height:570,additional:!0,notCloseMenuChanged:!0})},ON_CLICK_WINDOW:function(){var n=!0;this.defaultParam={alreadyIncludedLayout:!n};this.openPopup({url:"/ECERP/SVC/ECC/ECC001M",param:{alreadyIncludedLayout:!n},name:"ECC001M",popupID:"ECC001M_MEMO",parentPageID:"MEMO",popupType:n,width:770,height:570,additional:!0,notCloseMenuChanged:!0})},_getTitle:function(n){var t="";if(n==null||n==""||n=="1")return"";switch(n){case"9":case"*":t=ecount.resource.LBL02468;break;case"2":t=ecount.resource.LBL06192;break;case"T":t=ecount.resource.LBL02586;break;case"V":t=ecount.resource.LBL02358;break;case"U":t=ecount.resource.LBL00672;break;case"S":case"M":case"C":case"P":case"_":t=ecount.resource.LBL00409;break;case"-":t=ecount.resource.LBL21878;break;default:t=ecount.resource.LBL05395}return String.format('<div class="wrapper-sub-title">{0}<\/div>',t)},_checkLinkGubun:function(n,t){return n==null||n==""||t==null||t==""?!1:!0},_getParamFromString:function(n){for(var u=n.split("&"),f={},r=0,i,t;r<u.length;r++){i=u[r].split("=");switch(i[0]){case"hidBoardCd":case"BOARD_CD":t="BOARD_CD";break;case"hidBoardSeq":case"BOARD_SEQ":t="BOARD_SEQ";break;case"hidMenuType":case"MENU_TYPE":t="MENU_TYPE";break;default:t=i[0]}f[t]=i[1]}return f},_getDateOrTime:function(n){return this._dateToday==Date.format("yyyy-MM-dd",n)?ecount.infra.getECDateFormat("DATE40",!1,n.toDate()):ecount.infra.getECDateFormat("DATE10",!1,n.toDate())}},schedule:{controlType:"widget.ep.schedule",subTitle:"일정관리",_alwaysLoadByApi:!0,_searchApiURL:"/Service/EP/GetListScheduleForWidget",_searchApiParam:{},_menuType:"7",_menuSeq:"38",_newPageUrl:ecount.common.buildSessionUrl("/ECERP/SVC/EGJ/EGJ006P_03"),_movePageUrl:"/ECERP/SVC/EGJ/EGJ006M",_settingUrl:"/ECERP/ECP/ECP001P_19",_needRequire:"widget-ep-require",_functionBtns:["window","refresh","new"],_optionsLayer:["setting","delete"],_moveUrlInfo:{menuType:"7",menuSeq:"238",subMenu:"M070104000000",subMenuSeq:"238"},_timeoutOption:{time:1e4},_periodType:"Monthly",panelCss:"panel-ep-schedule",_periodRes:{D:ecount.resource.LBL06491,M:ecount.resource.LBL02042,L:ecount.resource.LBL80303,U:ecount.resource.LBL01459},scheduleTableTemplate:'<table class="table table-ellipsis table-schedule-more-list"><colgroup><col class="col1"><col class="col2"><col class="col3"><\/colgroup><tbody>{{CONTENTS}}<\/tbody><\/table>',scheduleDataTemplate:'<tr><td>{0}<\/td><td><a href="javascript:;" data-schedulevalue="{1}">{2}{3}<\/a><\/td><td>{4}<\/td><\/tr>',init:function(n){$.extend(this,n);this.callbackID=ecount.global.registerCallback(this.ecPageID,this.onMessage,this);this.viewBag=ecount.global.findViewBag(this.ecPageID);this.eventID=ecount.common.uuid("event");this._popoverElement=[];this.bodyClickHandler=function(n){var t=$(n.target);this.$el.find(".btn-group.link-group").find(n.target).length<=0&&this.$el.find("#div-ep-period").find(n.target).length<=0&&(this.hideDropdown(),this.$el.css("z-index",""))}.bind(this)},render:function(){this.setInitData();this._super.render.apply(this,arguments)},afterRenderEl:function(){this.setDate();this.setSearchParamData();this._super.afterRenderEl.apply(this,arguments);this.setHeaderTitle()},setHeaderTitle:function(){var n;this._selectedDate=this._selectedDate||ecount.control.date.serverDate(this.ecPageID);n=['<a href="#" class="previous" data-function="click" data-value="previous"><\/a>','<span class="calendar-date">',this.setDateFormat(),"<\/span>",'<a href="#" class="next" data-function="click" data-value="next"><\/a>',this.epData.header.title||""].join("");this.$el.find("span.widget-name").html(n)},setInitData:function(){this.epData&&this.epData.param?(this.TIME_CHART_TYPE=this.epData.param.TIME_CHART_TYPE||"M",this.TYPE_VALUE=this.epData.param.TYPE_VALUE||"3",this.NUM_LINES=this.epData.param.NUM_LINES||0,this.TERM_TYPE=this.epData.param.TERM_TYPE||0):(this.TIME_CHART_TYPE="M",this.TYPE_VALUE="3",this.NUM_LINES=0,this.CAT_DV_VAL="1");this.STARTWEEK=this.viewBag.InitDatas.DateSettingsInfo[0]?this.viewBag.InitDatas.DateSettingsInfo[0].WEEKDAY:0},setDate:function(){this.todayDate=ecount.control.date.serverDate(this.ecPageID);this.todayYear=this.todayDate.getFullYear();this.todayMonth=this.todayDate.getMonth();this.todayDay=this.todayDate.getDate();this._selectedDate=this.todayDate},setSearchParamData:function(){this._searchApiParam={TIME_CHART_TYPE:this.TIME_CHART_TYPE,TYPE_VALUE:this.TYPE_VALUE,FROM_DATE:this._selectedDate.format("yyyyMMdd"),TO_DATE:this._selectedDate.format("yyyyMMdd"),IsIncludeEPInfo:!0,BASE_DATE_FROM:this._selectedDate.format("yyyyMMdd"),BASE_DATE_TO:this._selectedDate.format("yyyyMMdd"),NUM_LINES:this.NUM_LINES,BUSINESS_NO:this.BUSINESS_NO,CAT_DV_VAL:this.CAT_DV_VAL}},getOtherSlipInfo:function(n){return{E020715:{url:"/ECERP/SVC/EPD/EPD020M",colName:{Date:"SLIP_DATE",No:"SLIP_NO"},col_prefix:"SLIP"},E040307:{url:"/ECERP/SVC/ESG/ESG004M",colName:{Date:"Date",No:"No"},col_prefix:"ORD"},E040212:{url:"/ECERP/SVC/ESD/ESD004M",colName:{Date:"Date",No:"No"},col_prefix:"REQ"},E040228:{url:"/ECERP/SVC/ESE/ESE001M",colName:{Date:"Date",No:"No"},col_prefix:"OUT"}}[n]||{}},setBodyByApi:function(n,t){var r;if(t===!0&&this.calendar&&this.calendar.destroy(),t===!0&&($.extend(this.epData,n.options),this.$el.attr("ep-id",this.id),this.setHeaderTitle()),$.extend(this.epData,n.options),n.options&&n.options.param&&n.options.param.TIME_CHART_TYPE&&(this.TIME_CHART_TYPE=n.options.param.TIME_CHART_TYPE),n.options.allowed===!1)r=this.requestForPermissionTemplate;else{if(this.TIME_CHART_TYPE=="M"){var f=this,i=[[{}],[{}]],u={},e=function(n){var f=n.s_date.toDate(),c=n.e_date.toDate(),e=this.NUM_LINES,o,r,t,h,s;for(!this.NUM_LINES&&this.epData&&this.epData.param&&this.epData.param.NUM_LINES&&(e=this.epData.param.NUM_LINES),o=n.data[0].reduce(function(n,t){return t.TITLE=t.MONTHLY_SUNDAY,n[t.YYYYMMDD==t.TO_YYYYMMDD?0:1].push(t),n},[[],[]]),r=o[0].groupBy(function(n){return"DAY_"+n.SDAY});f<=c;)t="DAY_"+f.getDate(),r[t]||(r[t]=[]),r[t]=r[t].concat(o[1].filter(function(n){return n.YYYYMMDD<=f.format("yyyy-MM-dd")&&n.TO_YYYYMMDD>=f.format("yyyy-MM-dd")})),h=r[t].slice(0,e),s=r[t].slice(e),u[t]=h,i[0][0][t]=s.length,i[1][0][t]=s.filter(function(n){return n.PRIVATE_FLAG=="Y"}).length,f=f.addDays(1);return{scheduleCount:i,scheduleDayListArray:u,holiday:n.monthOption.HolyDays,cobsHoliDetail:n.monthOption.HolyDetail}}.bind(this),o=function(n){var t="",i="";return this.epData.param&&(t=this.BUSINESS_NO===undefined?this.epData.param.BUSINESS_NO:this.BUSINESS_NO,i=this.CAT_DV_VAL===undefined?this.epData.param.CAT_DV_VAL:this.CAT_DV_VAL),{ecPageID:this.ecPageID,isDisableDataControl:!0,_holiday:n.holiday,_scheduleCount:n.scheduleCount,_scheduleDayListArray:n.scheduleDayListArray,_holidayDetail:n.cobsHoliDetail,TYPE_VALUE:this.TYPE_VALUE,BUSINESS_NO:t,CAT_DV_VAL:i,WIDGET_SEQ:this.id,_container:this._container,delegator:this.delegator,callbackID:this.callbackID,_callBack:function(n){var t=f;t.subTitle=ecount.resource.LBL13224;n=$.extend(n,this._searchApiParam);n.IS_NUM_COUNT="N";n.BASE_DATE_FROM=n.FROM_DATE;n.BASE_DATE_TO=n.TO_DATE}.bind(this),_scheduleTableTemplate:'<table class="table table-ellipsis table-schedule-more-list table-border-no-h"><colgroup><col class="col1"><\/colgroup><tbody>{{CONTENTS}}<\/tbody><\/table>',_popoverContents:function(n){var t="";return n.forEach(function(n){var r=n.PRG_ID||"",i=this.getOtherSlipInfoPrefix(r);ymd=n.YYYYMMDD;t+=String.format('<tr class=\'{3}\'><td><a href="javascript:;" data-value="{1}" {4}>{2}<\/a><\/td><\/tr>',n.TIME,ymd.toDate().format("yyyy-MM-dd")+ecount.delimiter+n.SER_NO+ecount.delimiter+n.DEL_GUBUN+ecount.delimiter+n.SCH_REPT_TF+ecount.delimiter+n.PARENT_YYYYMMDD.toDate().format("yyyyMMdd")+ecount.delimiter+n.CLNDR_SNO+ecount.delimiter+r+ecount.delimiter+n[i+"_DATE"]+ecount.delimiter+n[i+"_NO"]+ecount.delimiter+n.HID+ecount.delimiter+i+ecount.delimiter+n.CLNDR_TYPCD,n.TITLE,n.DEL_GUBUN=="Y"?"text-danger":"",n.DEL_GUBUN=="Y"?'class="text-danger"':"")}.bind(this)),t},_popoverContentsClickCallBack:function(n,t){var i,u,r;if(!n||n.target.nodeName!="A"||n.target.getAttribute("class")=="close")return!1;if(t&&t.value?i=t.value.split(ecount.delimiter):(u=n.target.getAttribute("data-value"),i=u&&u.split(ecount.delimiter)),r={},i&&i.length>=2){if(i[11]=="O"){var e=i[6],f=this.getOtherSlipInfo(e),o=f.url,s=i[10];r={url:o,Request:{FromProgramId:"E070201",EditMode:ecenum.editMode.modify,EDIT_FLAG:"M",HID:i[9]}};r.Request[f.colName.Date]=i[7];r.Request[f.colName.No]=i[8]}else r={url:"/ECERP/SVC/EGJ/EGJ006P_01",ScheduleKey:{YYYYMMDD:Date.parse(i[0]).format("yyyyMMdd"),SER_NO:i[1]},Request:{YYYYMMDD:i[4],SER_NO:parseInt(i[1]),SCH_REPT_TF:ecount.common.isTrue(i[3]),YYYYMMDD_FIXED:i[0],CLNDR_SNO:i[5],FormType:"GI090"}};this.openPopupViewSchedule(r)}}.bind(this),_url:"/Service/EP/GetListScheduleForWidget"}},s=e(n),h=widget.generator.control();return this.calendar=h.define("widget.calendar.scheduleManagement",this.id+"calendar",this.id+"calendar").setOptions(o.call(this,s)).setOptions({openPopUpCallback:this.setOpenPopupParam.bind(this)}).setMonth(this._selectedDate.getMonth()).setYear(this._selectedDate.getFullYear()).getInstance(),this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer),this.initializer&&ecount.control.initializeByUserSetting(this.initializer,this.calendar),this.calendar.render(this.$el.find(".panel-body > div").empty()),this.epData.EditFlag="M",this.epData.isFormListEmpty=n.isFromListEmpty,this.setDateFormat(),this.clearPopover(),this.setUIAfterBodyLoad(this.epData),this.hideLoadingbar(),this._isLoading=!1,this._refresh=!1,!1}this.TERM_TYPE=n.options.param.TERM_TYPE;$.extend(this.epData,n.options);r=this.getTemplateBody(this.epData.body||{})}this.$el.find("div.panel-body > div").empty().append(r);this.epData.EditFlag="M";this.setDateFormat();this.clearPopover();this.hideLoadingbar();this._isLoading=!1;this._refresh=!1},openPopupViewSchedule:function(n){var t={width:ecount.infra.getPageWidthFromConfig(),height:750,responseID:this.callbackID,EditFlag:"M",RepeatSaveType:"1",parentPageID:this.parentPageID};this.openWindow({url:n.url,name:ecount.resource.LBL13224,param:$.extend({},t,n),popupType:!1,additional:!1})},setOpenPopupParam:function(){return{responseID:this.callbackID}},getTemplateBody:function(n){var t=n.data;if(t&&t.data)return this.TIME_CHART_TYPE=="L"?this.getTemplateBodyByList(n):this.TIME_CHART_TYPE=="D"?this.getTemplateBodyByDay(n):this.TIME_CHART_TYPE=="M"?this.getTemplateBodyByMonth(n):this.TIME_CHART_TYPE=="U"?this.getTemplateBodyByUser(n):""},getTemplateBodyByList:function(n){for(var s,l,p,h,b,f,e,d=n.data,a='{{DATEHTML}}<table class="table table-hover table-striped table-ellipsis"><colgroup>{{COLGROUP}}<\/colgroup><thead><tr>{{THHTML}}<\/tr><\/thead><tbody>{{CONTENTSHTML}}<\/tbody><\/table>',u=d.data[0].slice(),r,v="",y="",o="",i=0;i<n.columns.length;i++)v+="<col "+i+">",y+="<th>"+n.columns[i].title+"<\/th>";if(s="",l=-1,u=u.sort(function(n,t){return n.YYYYMMDD>t.YYYYMMDD?1:n.YYYYMMDD===t.YYYYMMDD?0:n.YYYYMMDD<t.YYYYMMDD?-1:void 0}),u.length==0)s+=ecount.widget.replaceAttr(a,{DATEHTML:"",COLGROUP:"",THHTML:"",CONTENTSHTML:'<tr><td colspan="4" class="text-center">'+ecount.resource.MSG00205+"<\/td><\/tr>"});else for(i=0,p=u.length;i<p;i++){if(r=u[i],r.YYYYMMDD!=l){var g=String.format('<div class="wrapper-sub-title">{0}<\/div>',ecount.infra.getECDateFormat("DATE10",!1,new Date(r.SYEAR,r.SMONTH-1,r.SDAY))),w=u.filter(function(n){return n.YYYYMMDD==r.YYYYMMDD}),o="";for(h=0,b=w.length;h<b;h++){var t=w[h],k=t.PRG_ID||"",c=this.getOtherSlipInfo(k),tt=c.col_prefix+"_DATE",nt=c.col_prefix+"_NO";for(f=0;f<n.columns.length;f++)e=t[n.columns[f].id.toUpperCase()],n.columns[f].id=="vcTitle"&&(e=String.format('<a href="javascript:;" data-schedulevalue="{0}" data-value="viewSchedule" data-function="click">{1}{2}<\/a>',t.YYYYMMDD.toDate().format("yyyy-MM-dd")+ecount.delimiter+t.SER_NO+ecount.delimiter+t.SMOON+ecount.delimiter+t.SCH_REPT_TF+ecount.delimiter+t.PARENT_YYYYMMDD+ecount.delimiter+t.CLNDR_SNO+ecount.delimiter+k+ecount.delimiter+t[c]+ecount.delimiter+t[nt]+ecount.delimiter+t.HID+ecount.delimiter+c.col_prefix+ecount.delimiter+t.CLNDR_TYPCD,"",e)),n.columns[f].id=="yyyymmdd"&&(e=ecount.infra.getECDateFormat("date13",!1,e.toDate())),o+="<td>"+e+"<\/td>";o="<tr>"+o+"<\/tr>"}s+=ecount.widget.replaceAttr(a,{DATEHTML:g,COLGROUP:v,THHTML:y,CONTENTSHTML:o})}l=r.YYYYMMDD}return s},getTemplateBodyByDay:function(n){for(var ft,y,h,p,w,c,nt,o,l=n.data,it='<table class="table table-hover table-striped table-ellipsis"><colgroup>{{COLGROUP}}<\/colgroup><thead><tr>{{THHTML}}<\/tr><\/thead><tbody>{{CONTENTSHTML}}<\/tbody><\/table>',k='<col class="col0">',d="<th>&nbsp;<\/th>",e="",i=l.data[0],r,rt=function(n){var r={},t,i=[];for(t in n)n.hasOwnProperty(t)&&i.push(t);for(i.sort(),t=0;t<i.length;t++)r[i[t]]=n[i[t]];return r},a=function(n){var t=n.TIME.split(":");return min=t[1],min!="00"&&(n.CHANGETIME=t[0]+":00"),n},t=0;t<this.TERM_TYPE+1;t++)k+='<col class="col1">',d+="<th>"+ecount.infra.getECDateFormat("DATE10",!1,new Date(this._selectedDate.addDays(t).getFullYear(),this._selectedDate.addDays(t).getMonth(),this._selectedDate.addDays(t).getDate())),+ "</th>";var v=Number(l.inTime.substr(0,2)),g=Number(l.outTime.substr(0,2)),ut=Math.abs(v-g),f={},s=function(n){f[n.TIME]=[]};for(_.isEmpty(i)||i[0].IS_ALL_DAY!=!0||(s({TIME:"00:00"}),r=i[0],a(r),s(r)),t=0;t<ut+1;t++)s({TIME:(v+t).toString().padLeft(2,"0")+":00"});for(t=0;t<i.length;t++)r=i[t],(v>Number(r.TIME.substr(0,2))||g<Number(r.TIME.substr(0,2)))&&(a(r),s(r));for(t=0;t<i.length;t++)r=i[t],ft=1,y=a(r),f[y.TIME_24]&&f[y.TIME_24].push(r);f=rt(f);for(h in f)for(i=f[h],p=1,w=h=="00:00"?ecount.resource.LBL13166:h,i[0]&&i[0]._MERGE_SET?(e+='<tr><td rowspan="'+i[0]._MERGE_SET[0]._ROWSPAN_COUNT+'">'+w+"<\/td>",p=i[0]._MERGE_SET[0]._ROWSPAN_COUNT):e+="<tr><td>"+w+"<\/td>",t=0;t<p;t++){for(c=0;c<this.TERM_TYPE+1;c++)if(nt=this._selectedDate.addDays(c).getDate(),o=i.find(function(n){return n.EX_DATA_0&&n.EX_DATA_0.SDAY==nt&&n.ROWTIMECNT==t+1}),o){var tt=o.PRG_ID||"",b=this.getOtherSlipInfo(tt),et=b.col_prefix+"_DATE",ot=b.col_prefix+"_NO",u=o.EX_DATA_0;e+=String.format('<td><a href="javascript:;" data-schedulevalue="{0}" data-value="viewSchedule" data-function="click" data-over="tooltip">{1}<\/a><\/td>',o.YYYYMMDD.split(ecount.delimiter)[0].toDate().format("yyyy-MM-dd")+ecount.delimiter+u.SER_NO+ecount.delimiter+u.SMOON+ecount.delimiter+u.SCH_REPT_TF+ecount.delimiter+u.PARENT_YYYYMMDD+ecount.delimiter+u.CLNDR_SNO+ecount.delimiter+tt+ecount.delimiter+u[et]+ecount.delimiter+u[ot]+ecount.delimiter+u.HID+ecount.delimiter+b.col_prefix+ecount.delimiter+u.CLNDR_TYPCD,o.d_date0||"[]")}else e+="<td>-<\/td>";e+="<\/tr>"}return ecount.widget.replaceAttr(it,{COLGROUP:k,THHTML:d,CONTENTSHTML:e})},getTemplateBodyByMonth:function(){var n=widget.generator.control();this.calendar=n.define("widget.calendar.scheduleManagement",this.id+"calendar",this.id+"calendar").setOptions({ecPageID:this.ecPageID,isDisableDataControl:!0}).setMonth(this._selectedDate.getMonth()).setYear(this._selectedDate.getFullYear()).getInstance();this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer);this.initializer&&ecount.control.initializeByUserSetting(this.initializer,this.calendar);this.calendar.render()},getTemplateBodyByUser:function(n){for(var e,f,o,l,s=n.data,tt='<table class="table table-hover table-striped table-ellipsis"><colgroup>{{COLGROUP}}<\/colgroup><thead><tr>{{THHTML}}<\/tr><tr>{{THHTML2}}<\/tr><\/thead><tbody>{{CONTENTSHTML}}<\/tbody><\/table>',v='<col class="col0">',y="<th>&nbsp;<\/th>",p="<th>&nbsp;<\/th>",r="",h=parseInt(s.inTime.left(2)),c=parseInt(s.outTime.left(2)),t=0;t<this.TERM_TYPE+1;t++)for(y+='<th colspan="'+(c-h+1)+'">'+ecount.infra.getECDateFormat("DATE10",!1,new Date(this._selectedDate.addDays(t).getFullYear(),this._selectedDate.addDays(t).getMonth(),this._selectedDate.addDays(t).getDate())),+ "</th>",f=h;f<=c;f++)v+='<col class="col1">',p+="<th>"+f+":00<\/th>";for(tempObj=s.data,e=1,t=0;t<tempObj.length;t++){var u=tempObj[t],w=t>0?tempObj[t-1]:null,b=w&&w.USER_ID==u.USER_ID,k=t+1<tempObj.length?tempObj[t+1]:null,d=k&&k.USER_ID==u.USER_ID,g={};for(r+="<tr>",b||d?b?d||(g["ROWSPAN_"+u.USER_ID]=' rowspan="'+e+'"',r=ecount.widget.replaceAttr(r,g),e=1):(r+="<td{{ROWSPAN_"+u.USER_ID+"}}>"+u.u_participant+"<\/td>",e=1):(r+="<td>"+u.u_participant+"<\/td>",e=1),e++,f=0;f<this.TERM_TYPE+1;f++)for(o=h;o<=c;o++)if(l=this._selectedDate.addDays(f).format("yyyyMMdd")+ecount.delimiter+(o+"00").padLeft(4,"0"),u.HAS_DATA&&u["EX_DATA_"+l]){var i=u["EX_DATA_"+l],nt=i.PRG_ID||"",a=this.getOtherSlipInfo(nt),it=a.col_prefix+"_DATE",rt=a.col_prefix+"_NO";r+=String.format('<td><a href="javascript:;" data-schedulevalue="{0}" data-value="viewSchedule" data-function="click" data-over="tooltip">{1}<\/a><\/td>',i.YYYYMMDD.toDate().format("yyyy-MM-dd")+ecount.delimiter+i.SER_NO+ecount.delimiter+i.SMOON+ecount.delimiter+i.SCH_REPT_TF+ecount.delimiter+i.PARENT_YYYYMMDD+ecount.delimiter+i.CLNDR_SNO+ecount.delimiter+nt+ecount.delimiter+i[it]+ecount.delimiter+i[rt]+ecount.delimiter+i.HID+ecount.delimiter+a.col_prefix+ecount.delimiter+i.CLNDR_TYPCD,i.u_date0||"[]")}else r+="<td>-<\/td>";r+="<\/tr>"}return ecount.widget.replaceAttr(tt,{COLGROUP:v,THHTML:y,THHTML2:p,CONTENTSHTML:r})},hideDropdown:function(){var n=!1;this._showOptionsLayer&&(this._showOptionsLayer=!1,this.$el.find("ul.dropdown-menu").removeClass("show"),n=!0);this._showPeriodLayer&&(this._showPeriodLayer=!1,this.$periodLayer.removeClass("open"),n=!0);(this._showOptionsLayer==!1||this._showPeriodLayer==!1)&&$(this.eventContainer||document).unbind("mousedown."+this.eventID,this.bodyClickHandler)},showPopover:function(n,t,i,r){function f(n){return n.reduce(function(n,t){var i=t.CLNDR_SNO;return n[i]===undefined&&(n[i]=0),n[i]++,n},{})}var e=f(t[0]),u=n.data("schedulevalue")?n.data("schedulevalue").split(ecount.delimiter):"",o=$.isArray(u)?u[0]:"",s={content:this.createPopoverContents(t),title:this.createPopoverHeader(o,e,r),container:"body",unusedbodyClickHandler:!0,contentsClickCallBack:this.ON_CLICK_VIEWSCHEDULE.bind(this),template:'<div class="popover popover-ep-schedule"><div class="arrow"><\/div><h3 class="popover-title"><\/h3><div class="popover-content"><\/div><\/div>',directShow:!0};ecount.popover.create(n,s)},clearPopover:function(){if(this.TIME_CHART_TYPE=="M")return!1;ecount.popover.clear(null,null,!0)},togglePopover:function(){if(arguments.length==1){for(var n=0,t=this._popoverElement.length;n<t;n++)this._popoverElement[n].popover("hide");this._popoverElement.push(arguments[0])}else this._popoverElement=[]},createPopoverHeader:function(n,t,i){for(var u="",r=0;r<i.length;r++){var f=i[r],e=t[f.Key.CLNDR_SNO]||0;u+=String.format("<span class ='label' style='background-color:{0}'>{1}<\/span>&nbsp;",f.CLNDR_COLOR_CD,e)}var o=n.substr(0,4),s=Number(n.substr(4,2))-1,h=Number(n.substr(6,2)),c=ecount.resource;return $(String.format('<div>{0} {1}&nbsp;&nbsp;{2}<a herf="#" class="close"><\/a><\/div>',ecount.infra.getECDateFormat("DATE10",!1,new Date(o,s,h)),c.LBL06862,u))},createPopoverContents:function(n){var u,r,f,t;for(n=n[0],u="",r=0,f=n.length;r<f;r++)if(t=n[r],t.ROWTIMECNT!=1){var e=t.PRG_ID||"",i=this.getOtherSlipInfo(e),o=i.col_prefix+"_DATE",s=i.col_prefix+"_NO";u+=String.format(this.scheduleDataTemplate,t.TIME,t.YYYYMMDD.toDate().format("yyyy-MM-dd")+ecount.delimiter+t.SER_NO+ecount.delimiter+t.SMOON+ecount.delimiter+t.SCH_REPT_TF+ecount.delimiter+t.PARENT_YYYYMMDD+ecount.delimiter+t.CLNDR_SNO+ecount.delimiter+e+ecount.delimiter+t[i.col_prefix+"_DATE"]+ecount.delimiter+t[i.col_prefix+"_NO"]+ecount.delimiter+t.HID+ecount.delimiter+i.col_prefix+ecount.delimiter+t.CLNDR_TYPCD,"",t.VCTITLE,t.VCWHERE||"")}return $(ecount.widget.replaceAttr(this.scheduleTableTemplate,{CONTENTS:u}))},redraw:function(n){this.showLoadingbar();this.clearPopover();this.setDateFormat(n);this.reloadBodyContents()},setChartTypeText:function(){this.showLoadingbar();var n={TIME_CHART_TYPE:this.TIME_CHART_TYPE,key:{WIDGET_SEQ:this.id}},t={WIDGET_SEQ:this.id,EPUserSet:n};ecount.common.api({ecPageID:this.ecPageID,url:"/Service/EP/SaveEPTemplate",data:Object.toJSON(t),success:function(){this.$el.find("button[data-value='periodOption']")[0].childNodes[0].nodeValue=this._periodRes[this.TIME_CHART_TYPE]}.bind(this),complete:function(){}.bind(this)})},setDateFormat:function(n){switch(this.TIME_CHART_TYPE){case"D":case"U":n=="next"?this._selectedDate=this._selectedDate.addDays(1):n=="prev"&&(this._selectedDate=this._selectedDate.addDays(-1));_dateFormat=ecount.infra.getECDateFormat("DATE10",!1,new Date(this._selectedDate.getFullYear(),this._selectedDate.getMonth(),this._selectedDate.getDate()));break;case"M":case"L":n=="next"?this._selectedDate=this._selectedDate.addMonths(1):n=="prev"&&(this._selectedDate=this._selectedDate.addMonths(-1));_dateFormat=ecount.infra.getECDateFormat("DATE20",!1,new Date(this._selectedDate.getFullYear(),this._selectedDate.getMonth(),this._selectedDate.getDate()))}return this.$el&&this.$el.find("span.calendar-date").text(_dateFormat),_dateFormat},getWeekDate:function(){var n=this._selectedDate.getDay(),r=this.STARTWEEK-1,t=r,i=0;return i=t<=n?t-n:-(7+n-t),this.startDate=this._selectedDate.addDays(i),this.endDate=this.startDate.addDays(6),[this.startDate,this.endDate]},reloadBodyContents:function(){this.setSearchParamData(!0);this.onMessage(this,{type:"reload"})},onMessage:function(n,t){var i=arguments;t.type=="reload"&&t.data&&(this.TIME_CHART_TYPE=t.data.TIME_CHART_TYPE||this.TIME_CHART_TYPE,this.TYPE_VALUE=t.data.TYPE_VALUE||this.TYPE_VALUE,this.NUM_LINES=t.data.NUM_LINES||this.NUM_LINES,this.BUSINESS_NO=t.data.BUSINESS_NO,this.CAT_DV_VAL=t.data.CAT_DV_VAL,this.TERM_TYPE=t.data.TERM_TYPE,this.setSearchParamData(),this.clearPopover(),this.showLoadingbar());ecount.global.setTimeout(this.ecPageID,function(){this._super.onMessage.apply(this,i)}.bind(this),100)},ON_CLICK_PERIODOPTION:function(){if(this._isLoading)return!1;if(this._showOptionsLayer&&(this._showOptionsLayer=!1,this.$el.find("ul.dropdown-menu").removeClass("show"),$(this.eventContainer||document).unbind("mousedown."+this.eventID,this.bodyClickHandler)),this.$periodLayer.toggleClass("open"),!this._showPeriodLayer){this._showPeriodLayer=!0;$(this.eventContainer||document).on("mousedown."+this.eventID,this.bodyClickHandler)}},ON_CLICK_OPTION:function(){if(this._isLoading=!0,this._showPeriodLayer&&(this._showPeriodLayer=!1,this.$periodLayer.removeClass("open"),$(this.eventContainer||document).unbind("mousedown."+this.eventID,this.bodyClickHandler)),this.$optionsLayer.toggleClass("show"),this._showOptionsLayer==!1){$(this.eventContainer||document).on("mousedown."+this.eventID,this.bodyClickHandler);this._showOptionsLayer=!0;this.$el.css("z-index",2)}},ON_CLICK_VIEWSCHEDULE:function(n){var u,t,i;if(arguments.length>1&&(n=arguments[1]),!n||n.target.nodeName!="A")return!1;if(n.target.getAttribute("class")=="close")return this.clearPopover(),!1;if(u=n.target.getAttribute("data-schedulevalue"),i={},u){if(t=u.split(ecount.delimiter),t[11]=="O"){var f=t[6],r=this.getOtherSlipInfo(f),e=r.url;i={url:e,Request:{FromProgramId:"E070201",EditMode:ecenum.editMode.modify,EDIT_FLAG:"M",HID:t[9]}};i.Request[r.colName.Date]=t[7];i.Request[r.colName.No]=t[8];i.Request.Key={};i.Request.Key[r.colName.Date]=t[7];i.Request.Key[r.colName.No]=t[8]}else i={url:"/ECERP/SVC/EGJ/EGJ006P_01",ScheduleKey:{YYYYMMDD:Date.parse(t[0]).format("yyyyMMdd"),SER_NO:t[1]},Request:{YYYYMMDD:t[4],SER_NO:parseInt(t[1]),SCH_REPT_TF:ecount.common.isTrue(t[3]),YYYYMMDD_FIXED:t[0],CLNDR_SNO:t[5],FormType:"GI090"}};return this.openPopupViewSchedule(i),!1}},ON_CLICK_POPOVER:function(n){var r;if(!n)return!1;var i=$(n),t=i.data("schedulevalue")?i.data("schedulevalue").split(ecount.delimiter):"",f=$.isArray(t)?t[0]:"",e=$.isArray(t)?t[1]:"",u=i.data("popoverindex");$.isNull(u)?(r={TIME_CHART_TYPE:this.TIME_CHART_TYPE,TYPE_VALUE:this.TYPE_VALUE,FROM_DATE:t[0],TO_DATE:t[0],BUSINESS_NO:this.BUSINESS_NO==undefined?this.epData.param.BUSINESS_NO:this.BUSINESS_NO,CAT_DV_VAL:this.CAT_DV_VAL==undefined?this.epData.param.CAT_DV_VAL:this.CAT_DV_VAL,HOURGRP:t[1],IsIncludeEPInfo:!1},ecount.common.api({ecPageID:this.ecPageID,url:"/Service/EP/GetListScheduleForWidget",data:r,error:function(){}.bind(this),success:function(t){t.Data.data.length>0&&(this.clearPopover(),this.showPopover(i,t.Data.data,n,t.Data.calendarList))}.bind(this)})):this.clearPopover()},ON_CLICK_PREVIOUS:function(){this.redraw("prev")},ON_CLICK_NEXT:function(){this.redraw("next")},ON_CLICK_NEW:function(){this.defaultParam={width:"785",height:"610",EditMode:ecenum.editMode.new,Request:{},isChangePopupType:!1};this.openPopup({url:this._newPageUrl,popupType:!0})},openWindow:function(n){this._getPopupMetadata(n);n.param=n.param||{};n.param.responseID=n.fResponseID||this.callbackID;n.param.ecRepositoryID=ecount.common.createPageOption(this.ecPageID,n.pageOption);n.onlyCloseMenuChange==!0&&(n.popupType=this.openPopupTypeCheck());n.parentPageID=this.popupID||this.pageID||n.param.parentPageID;ecount.popup.openWindow(n)},_getPopupMetadata:function(n){return n=n||{},n.parentPageID=this.popupID||this.pageID,n.__ecPageID=this.ecPageID,n.popupLevel=n.popupLevel==undefined?this.popupLevel?parseInt(this.popupLevel)+1:1:parseInt(n.popupLevel)+1,n.responseID=this.callbackID,n.alreadyIncludedLayout=!0,this.__ecOpenPopup==="popupType3fromIframe"&&(n.alreadyIncludedLayout=!0),n},ON_MOUSEOVER:function(n){_.get(n,"dataset.over")=="tooltip"&&this.createPopover(n,{popoverMessage:n.textContent})}},training:{controlType:"widget.ep.training",subTitle:"활용교육신청",_alwaysLoadByApi:!0,_searchApiURL:"/Service/EP/GetListTrainingSeminarsEP",_searchApiParam:{},_newPageUrl:"",_movePageUrl:"/ECERP/ECU/ECU600M",_popupCellRegisterUrl:"/ECERP/ECU/ECU601M",_popupCellcloseUrl:"/ECERP/ECU/ECU601M",_settingUrl:"",_functionBtns:["window","refresh"],_optionsLayer:["delete"],init:function(n){this._super.init.apply(this,arguments);n._overrideFunc&&_.merge(this,n._overrideFunc)},setBodyByApi:function(n){var t;$.extend(this.epData,n.options);this.$el.attr("ep-id",this.id);this.$el.find("span.widget-name").text(n.options.header.title);t=this.epData.allowed===!1?this.requestForPermissionTemplate:this.getTemplateBody(this.epData.body||{});this.$el.find("div.panel-body > div").empty().append(t);this.epData.EditFlag="M";this._refresh=!1;this.setUIAfterBodyLoad(this.epData);this.hideLoadingbar()},getTemplateBody:function(n){var t=this.bodyDataConversion(n),e=[],r=[],i,f,u;if(!$.isNull(t.columns))for(i=0;i<t.columns.length;i++)f=t.columns[i],e.push(ecount.widget.replaceAttr('<th class="{{css}}">{{title}}<\/th>',{title:f.title,css:f.css||""}));if(!$.isNull(t.data)){for(i=0;i<t.data.length;i++)for(f=t.data[i],r.push("<tr>"),u=0;u<t.columns.length;u++)r.push(ecount.widget.replaceAttr('<td class="{{css}}">{{cellValue}}<\/td>',{cellValue:this.getTagTemplate(t.columns[u],f["A"+u],i),css:t.columns[u].tagType.toUpperCase()=="LINK"?"text-center":""}));t.data.length==0&&(r.push("<tr>"),r.push('<td colspan="4">'+ecount.resource.MSG02033+"<\/td>"),r.push("<\/tr>"))}return ecount.widget.replaceAttr(this.tableTemplate,{header:e.join("")||"",body:r.join("")||""})},getTagTemplate:function(n,t,i){var f,u=t.split(ecount.delimiter),r,e;if(n.tagType&&n.tagType.toUpperCase()=="LINK"){for(r=0,e=u.length;r<e;r++)u[r]=n.id=="A2"?String.format('<a href="javascript:;" data-colCd="{0}" data-index="{1}" data-value="cellMap" data-function="click">{2}<\/a>',n.id,i,u[r]):t==ecount.resource.BTN10007?String.format('<a href="javascript:;" data-colCd="{0}" data-index="{1}" data-value="cellRegister" data-function="click">{2}<\/a>',n.id,i,u[r]):String.format('<a href="javascript:;" data-colCd="{0}" data-index="{1}" data-value="cellClose" data-function="click" class="text-muted">{2}<\/a>',n.id,i,u[r]);f=u.join(" ")}else f=t;return f},ON_CLICK_CELLMAP:function(n){var t=Number($(n).attr("data-index")),i={columns:this.epData.body.columns,data:this.epData.body.data[t]};this.defaultParam={IDX:i.data.IDX};this.openPopup({url:"/ECERP/ECU/ECU701P_04",width:700,height:600,popupType:!0})},ON_CLICK_CELLREGISTER:function(n){var i=Number($(n).attr("data-index")),t={columns:this.epData.body.columns,data:this.epData.body.data[i]};this.defaultParam={EDU_MNG700:t.data.IDX,navIndex:7,com_flag:"",strurlgubun:3,strtabgubun:000,hidMaGam:"I",EDU_TYPE:t.data.EDU_TYPE,EDU_STATE:0};this.openPopup({url:this._popupCellRegisterUrl,width:screen.availWidth<1100?screen.availWidth*.95:1100,height:screen.availHeight<740?screen.availWidth*.95:740,popupType:!1})},ON_CLICK_CELLCLOSE:function(n){var i=Number($(n).attr("data-index")),t={columns:this.epData.body.columns,data:this.epData.body.data[i]};if(t.data.IDX=="224")return ecount.alert(ecount.resource.MSG03151),!1;this.defaultParam={EDU_MNG700:t.data.IDX,navIndex:7,com_flag:"",strurlgubun:3,strtabgubun:000,hidMaGam:"E",EDU_TYPE:t.data.EDU_TYPE,EDU_STATE:0};this.openPopup({url:this._popupCellcloseUrl,width:screen.availWidth<1100?screen.availWidth*.95:1100,height:screen.availHeight<740?screen.availWidth*.95:740,popupType:!1})},ON_CLICK_WINDOW:function(){var n={url:this._movePageUrl,width:800,height:600,popupType:!1,notSubmitWindowOpen:!0};this.openPopup(n)}},emailList:{controlType:"widget.ep.emailList",subTitle:"Email",_alwaysLoadByApi:!0,_searchApiURL:"/Service/EP/GetListEmailForWidget",_searchApiParam:{},_newPageUrl:"",_movePageUrl:"",_settingUrl:"/ECERP/ECP/ECP001P_14",_functionBtns:["window","refresh","new"],_optionsLayer:["setting","delete"],_hidSessionData:"",_hidUrl:"",_hidPostData:"",panelCss:"panel-ep-mail-list",tableTemplate:'<table class="table table-hover table-striped table-layout-auto"><colgroup><col class="col1"><col class="col2"><col class="col3"><col class="col4"><\/colgroup><thead><tr>{{header}}<\/tr><\/thead><tbody>{{body}}<\/tbody><\/table>',setBodyByApi:function(n,t){$.isEmpty(n.options.param)||(this._hidSessionData=n.options.param.hidSessionData,this._hidUrl=n.options.param.hidUrl,this._hidPostData=n.options.param.hidPostData);var i;this.epData.EditFlag=="I"||t==!0?($.extend(this.epData,n.options),this.$el.attr("ep-id",this.id),this.$el.find("span.widget-name").text(n.options.header.title)):$.extend(this.epData.body,{data:n.options.body.data});i=this.epData.allowed===!1?"<div><\/div>":$.isEmpty(this.epData.body)?"<div>"+ecount.resource.MSG00205+"<\/div>":this.getTemplateBody(this.epData.body||{});this.$el.find("div.panel-body > div").empty().append(i);this.epData.EditFlag="M";this._refresh=!1;this.setUIAfterBodyLoad(this.epData);this.hideLoadingbar()},setUIAfterBodyLoad:function(n){this._super.setUIAfterBodyLoad.apply(this,arguments);n.header.title!="Email"&&this.$el.find(".widget-name").text("Email ("+n.header.title+")")},getTemplateBody:function(n){return $.isNull(n.data)?"":n.data.length==1&&!$.isEmpty(n.data[0].message)?n.data[0].message:this._super.getTemplateBody.apply(this,arguments)},getTagTemplate:function(n,t,i){var r='<a class="{{css}}" href="javascript:;" data-index="{{index}}" data-column="{{column}}" data-value="cellValue" data-function="click" {{attachment}}>{{data}}<\/a>',u=t,f="",e="";if(n.id=="FileUse"){if(t==0)return"";if(t==1)r=String.format('<div class="text-center">{0}<\/div>',r),u="[1]",e='data-attachment="0"';else return this._getDropdownTemplate(n,t,i,r)}if(n.tagType&&(n.tagType.toUpperCase()=="LINK"||n.tagType.toUpperCase()=="ICON"))f="";else return t;return ecount.widget.replaceAttr(r,{css:f,data:u,index:i,column:n.id,attachment:e})},_getDropdownTemplate:function(n,t,i,r){var o=this.epData.body.data[i],f=o.hidAttachments,e="",s=['<div class="text-center">','<div class="btn-group link-group">','<a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false">[{{count}}]<\/a>','<ul class="dropdown-menu dropdown-menu-right" role="menu" style="max-height:250px;overflow-y:scroll;">',"{{items}}","<\/ul>","<\/div>","<\/div>",].join("\n"),u;if(r=String.format("<li>{0}<\/li>",r),!f)return"";for(u=0;u<f.length;u++)e+=ecount.widget.replaceAttr(r,{css:"",data:$.isNull(f[u].FileName)?f[u].filename:f[u].FileName,index:i,column:n.id,attachment:String.format('data-attachment="{0}"',u)});return ecount.widget.replaceAttr(s,{count:t,items:e})},ON_CLICK_CELLVALUE:function(n){var r=Number($(n).attr("data-index")),u=$(n).attr("data-column"),t={columns:this.epData.body.columns,data:this.epData.body.data[r]},i;u=="FileUse"?(i=t.data.hidAttachments[n.getAttribute("data-attachment")],i.isBigFile?this.downloadFile(i.url):this.downloadFile({email:t.data.hidEmail,uboxName:t.data.hidUboxName,uId:t.data.hidUid,partID:i.PartID,fileName:i.FileName})):(this.defaultParam={RetUrl:t.data.hidUrl,SessionData:t.data.hidSessionData,PostData:t.data.hidPostData},this.openPopup({url:"/ECERP/Popup.Common/CM306P",width:1200,height:800,popupType:!0}))},ON_CLICK_WINDOW:function(){var n=this.epData.body.data[0];if($.isEmpty(this._hidUrl)||$.isEmpty(this._hidSessionData)){n.canRequestMail?ecmodule.navigation.OpenMail("Y",""):ecount.alert(ecount.resource.MSG00751);return}this.defaultParam={RetUrl:this._hidUrl,SessionData:this._hidSessionData};this.openPopup({url:"/ECERP/Popup.Common/CM306P",width:1200,height:800,popupType:!0})},ON_CLICK_NEW:function(){var n=this.epData.body.data[0];if($.isEmpty(this._hidUrl)||$.isEmpty(this._hidSessionData)||$.isEmpty(this._hidPostData)){n.canRequestMail?ecmodule.navigation.OpenMail("Y",""):ecount.alert(ecount.resource.MSG00751);return}this.defaultParam={RetUrl:this._hidUrl,SessionData:this._hidSessionData,PostData:this._hidPostData};this.openPopup({url:"/ECERP/Popup.Common/CM306P",width:1200,height:800,popupType:!0})},onMessage:function(){var n=arguments;ecount.global.setTimeout(this.ecPageID,function(){this._super.onMessage.apply(this,n)}.bind(this),1e3)},downloadFile:function(n){var t="/ecerp/ecp/ecp001p_24";$.isString(n)?t=n:t+="?"+$.param(n);ecount.document.downloadFile({downloadURL:ecount.common.buildSessionUrl(t),ecPageID:this.ecPageID})}},flowChart:{controlType:"widget.ep.flowChart",subTitle:"FlowChart",_alwaysLoadByApi:!0,_searchApiURL:"/Service/EP/GetListFlowChartForWidget",_searchApiParam:{},_newPageUrl:"",_movePageUrl:"",_settingUrl:"",_functionBtns:[],_optionsLayer:["delete"],_connectLines:[],_detailTemplate:['<div class="panel panel-default flowchart-{{id}}">','<div class="panel-heading">','<div class="close"><\/div>','<div class="flowchart-icon"><\/div>','<div class="item-detail-title">{{title}}<\/div>',"{{goToMenu}}","<\/div>",'<div class="panel-body">{{nodes}}<\/div>',"<\/div>",].join("\n"),_itemTemplate:'<li id="{{id}}" class="flowchart-{{id}}" data-type="flowchart_item">\n<div class="flowchart-icon"><\/div>\n<div class="label {{labelCss}}">{{label}}<\/div>\n<\/li>',getTemplateBody:function(n){if($.isNull(n.data))return"";var i='<div class="wrapper-flowchart">\n{{rows}}\n{{connectLines}}\n<div class="flowchart-item-detail">\n{{details}}\n<\/div>\n<\/div>',t=this._createRows(n.data);return ecount.widget.replaceAttr(i,{rows:t.rows,connectLines:t.connectLines,details:t.details})},setUIAfterBodyLoad:function(){this._super.setUIAfterBodyLoad.apply(this,arguments);this.$el.find("li[data-type='flowchart_item']").on("click",this.ON_CLICK_ITEM.bind(this));this.$el.find(".flowchart-item-detail > .panel .close").on("click",this.ON_CLICK_CLOSEBUTTON.bind(this))},_createRows:function(n){for(var t,f=[],e=[],o=[],r,i,u=0;u<n.length;u++){for(i=n[u],r=["<ul>"],t=0;t<i.Items.length;t++)i.Items[t].Id?(r.push(ecount.widget.replaceAttr(this._itemTemplate,{id:i.Items[t].Id,labelCss:i.Items[t].LabelCss,label:i.Items[t].Title})),o.push(this._createDetailPanel(i.Items[t]))):r.push("<li><\/li>");for(r.push("<\/ul>"),f.push(r.join("\n")),t=0;t<i.ConnectLines.length;t++)e.push(String.format('<div class="flowchart-connect-line {0}"><\/div>',i.ConnectLines[t]))}return{rows:f.join("\n"),connectLines:e.join("\n"),details:o.join("\n")}},_createDetailPanel:function(n){var r=n.Title,t=n.Detail,i="";return t.GoToMenu==!0&&(i=String.format('<a href="javascript:;" data-key="{0}" data-value="GoToMenu" data-function="click">{1}<\/a>',t.Url,ecount.resource.LBL02839)),ecount.widget.replaceAttr(this._detailTemplate,{id:n.Id,title:r,goToMenu:i,nodes:this._createNodes(t.Nodes,!0,n)})},_createNodes:function(n,t,i){for(var f=[],r=0,u;r<n.length;r++){u=["<li>"];switch(n[r].Type){case"VIDEO_TUTORIAL":case"VIEW_MANUAL":case"REDIRECT":u.push(String.format('<a href="javascript:;" data-type="{0}" data-key="{1}" data-value="Manual" data-function="click" data-title="{3}">{2}<\/a>',n[r].Type,n[r].Data,n[r].Text,i.Title));break;case"GO_TO_MENU":u.push(n[r].Text);u.push(String.format('<a class="ml-5" href="javascript:;" data-key="{0}" data-value="GoToMenu" data-function="click">{1}<\/a>',n[r].Data,ecount.resource.LBL02839));break;default:u.push(n[r].Text)}$.isArray(n[r].ChildNodes)&&n[r].ChildNodes.length>0&&u.push(this._createNodes(n[r].ChildNodes,!1,i));u.push("<\/li>");f.push(u.join("\n"))}return t==!0?(f.unshift("<ol>"),f.push("<\/ol>")):(f.unshift("<ul>"),f.push("<\/ul>")),f.join("\n")},ON_CLICK_ITEM:function(n){var t=$(n.currentTarget);this.open(t.attr("id"));n.preventDefault()},ON_CLICK_GOTOMENU:function(n){var t=$(n),i=t.attr("data-key");ecount.router.go({url:"/ECERP/ECP/ECP050M",hash:"#"+i},"_top")},ON_CLICK_MANUAL:function(n){var r=$(n),u=r.attr("data-type"),f=r.attr("data-key"),s=r.attr("data-title"),i=ecount.global.findViewBag(this.ecPageID).Language;if(u=="REDIRECT"){this.ON_CLICK_GOTOMENU(n);return}if(u=="VIDEO_TUTORIAL"){var t=f.split("§§"),e="",o=0;o=i=="es"?t[1]:i=="ko-KR"?t[2]:i=="zh-CN"?t[3]:i=="zh-TW"?t[4]:i=="vi-VN"?t[5]:i=="th-TH"?t[6]:i=="id-ID"?t[7]:t[0];ecount.common.api({url:"/SVC/Service/EP/GetListEcHelpVideoForFlowChart",data:{Request:{Data:{LNGG_CLAS_CD:ecount.global.findViewBag(this.ecPageID).Language,TGT_DV_CD:"C",SETUP_TGT_KEY:o,SUB_SETUP_TGT_KEY:t[0]}}},success:function(n){if(n.Status!="200"){ecount.alert(ecount.resource.MSG09954);return}$.isEmpty(n.Data[0])||(n.Data.length==1?(e=n.Data[0].BLTN_SNO,this.defaultParam={width:880,height:700,parentPageID:this.ecPageID,responseID:this.callbackID,BLTN_SNO:e,LANG_TYPE:n.Data[0].language,OPEN_TARGET:"ONLINE",isMovie:!0,menuType:"startEcount"},this.openPopup({type:"GET",url:"/ECERP/SVC/EAM/EAM012M",name:"Preview",popupType:!1,additional:!1})):(n.Data.forEach(function(n){n.MENU_MN=s}),this.defaultParam={EduVideoList:n.Data,menuType:"startEcount"},this.openPopup({type:"GET",url:"/ECERP/ESC/ESC004M_02",name:ecount.resource.LBL08885,popupType:!1,additional:!1})))}.bind(this),error:function(){ecount.alert(ecount.resource.MSG09954)}})}else u=="VIEW_MANUAL"&&this.openPopup({url:"/ECERP/SVC/ECU/ECU930M?navIndex=1&gubun=1&prg_id="+f,name:"ONLINE_MANUAL",width:880,height:610,popupType:!1,prg_id:f})},ON_CLICK_CLOSEBUTTON:function(n){this.close();n.preventDefault()},open:function(n){var t=String.format(".flowchart-item-detail > div.flowchart-{0}",n);this.close();this.$el.find(t).addClass("open")},close:function(){this.$el.find(".flowchart-item-detail > div.open").removeClass("open")}},bulletinBoard:{controlType:"widget.ep.bulletinBoard",subTitle:"bulletinBoard",_alwaysLoadByApi:!0,_searchApiURL:"/Service/EP/GetBoardForWidget",_searchApiParam:{},_newPageUrl:"/ECERP/EGM/EGM025M",_movePageUrl:"/ECERP/EGM/EGM024M",_settingUrl:"/ECERP/ECP/ECP001P_15",_functionBtns:["window","refresh","new"],_optionsLayer:["setting","delete"],setBodyByApi:function(n,t){var i;this.epData.EditFlag=="I"||t==!0?($.extend(this.epData,n.options),this.$el.attr("ep-id",this.id),this.$el.find("span.widget-name").text(n.options.header.title)):$.extend(this.epData,n.options);i=_.isEmpty(this.epData.prgId)?"<div>"+ecount.resource.MSG11317&&ecount.resource.MSG00295+"<\/div>":this.epData.gwUse==="C"?"<div>"+ecount.resource.MSG11182+"<\/div>":this.epData.gwUse==="U"?"<div>"+String.format(ecount.resource.MSG03961,"("+this.epData.header.title+")")+"<\/div>":this.epData.allowed===!1?this.requestForPermissionTemplate:this.getTemplateBody(this.epData||{});this.$el.find("div.panel-body > div").empty().append(i);this.epData.EditFlag="M";this._refresh=!1;this.setUIAfterBodyLoad(this.epData);this.setActiveControlBtn(this.$el.find(".widget-option > div:eq(0)"),n);this.hideLoadingbar()},setActiveControlBtn:function(n,t){var i=t.param!=undefined?t.param.BOARD_CD:"";i!=undefined&&i!=""?($(n).find(".ep-refresh").removeClass("disabled"),$(n).find(".ep-new-post").removeClass("disabled"),$(n).find(".ep-new-window").removeClass("disabled")):($(n).find(".ep-refresh").toggleClass("disabled"),$(n).find(".ep-new-post").toggleClass("disabled"),$(n).find(".ep-new-window").toggleClass("disabled"))},getTagTemplate:function(n,t,i){return["TITLE","VIEW_READ","WRITER_NAME"].contains(n.id)?String.format('<a href="javascript:;" data-index="{0}" data-column="{1}" data-value="cellValue" data-function="click">{2}<\/a>',i,n.id,t):n.tagType&&!!~_.indexOf(["link","file"],n.tagType.toLowerCase())?String.format('<a href="javascript:;" data-index="{0}" data-type="{1}" data-value="cellValue" data-function="click">{2}<\/a>',i,n.tagType,t):t},getTemplateBody:function(n){var t='<div class="wrapper-toolbar">\n<div class="pull-left">\n{{title}}\n<\/div>\n<div class="pull-right">\n{{prevButton}}\n{{nextButton}}\n<\/div>\n<\/div>\n<div class="ep-board-view-contents">{{contents}}<\/div>',i;if(n&&n.param)return n.param.TYPE_VALUE=="1"?(i="",$.isNull(n.param.TYPE_MOVE_PAGE)?ecount.widget.replaceAttr(t,{title:String.format('<span class="text-bold">{0}<\/span>',ecount.resource.MSG00202),contents:ecount.resource.MSG00202,prevButton:"",nextButton:""}):(n.param.TYPE_MOVE_PAGE=="PREV"&&n.param.HAS_PREV!="Y"?ecount.alert(ecount.resource.MSG00429):n.param.TYPE_MOVE_PAGE=="NEXT"&&n.param.HAS_NEXT!="Y"&&ecount.alert(ecount.resource.MSG00184),ecount.widget.replaceAttr(t,{title:String.format('<a href="javascript:;" data-value="title" data-function="click">{0}<\/a>',n.param.POST_TITLE),contents:n.param.TXT.replace(/\n/g,"").replace(/\r/g,""),prevButton:'<a href="javascript:;" class="ep-icon-arrow-left" data-value="prev" data-function="click"><\/a>',nextButton:'<a href="javascript:;" class="ep-icon-arrow-right" data-value="next" data-function="click"><\/a>'}))):this._super.getTemplateBody.apply(this,[n.body])},setUIAfterBodyLoad:function(n){var r,i,t,e,u,f;if(n.body&&$.isArray(n.body.columns)&&$.isArray(n.body.data)&&(r=n.body.data,i=n.body.columns.first(function(n){return n.id=="TITLE"}),n.param.TYPE_VALUE==2))for(t=0;t<r.length;t++)r[t].NOTICE_YN=="Y"&&(e=String.format("table > tbody > tr:nth-child({0})",t+1),u=this.$el.find(e),u.addClass("warning"),i&&$.isNumeric(i.index)&&(f=u.find(String.format("td:nth-child({0})",i.index+1)),f.length>0&&f.prepend(String.format('<span class="label label-warning">{0}<\/span>',ecount.resource.LBL00578))));this._super.setUIAfterBodyLoad.apply(this,arguments)},makeDropdownFile:function(n,t){_.isArray(n)&&n.length==1?this.delegator&&this.delegator.triggerEvent("page.customPageInvoke",_.merge({commandName:_.camelCase("on_dropdown_file")},{control:this,originItem:n[0],value:n[0].value})):_.isArray(n)&&n.length>1&&this.createDropdownList({items:n,boundary:ec$.getZoomedBoundary(t),hasDropdownLayerIcon:!0})},ON_CLICK_TITLE:function(){this.defaultParam={BOARD_CD:this.epData.param.BOARD_CD,BOARD_SEQ:this.epData.param.BOARD_SEQ,MENU_TYPE:this.epData.param.MENU_TYPE};this.openPopup({url:"/ECERP/EGM/EGM026M",width:ecount.infra.getPageWidthFromConfig(),height:800})},ON_CLICK_CELLVALUE:function(n){var i=Number($(n).attr("data-index")),r=$(n).attr("data-column"),u=$(n).attr("data-type"),t=this.epData.body.data[i];if(u=="FILE"){_.isArray(t.DROPDOWN_ITEMS)&&t.DROPDOWN_ITEMS.length>0?this.makeDropdownFile(t.DROPDOWN_ITEMS,n):ecount.common.api({url:"/SVC/Common/Infra/GetRefData",async:!0,data:Object.toJSON({HID:t.HID}),success:function(r){var u,f,h,l;for(r.Data=r.Data||{},u=[],u=ecmodule.common.slipLink.setRefDataChange(r.Data,t),t.FILE=u,t.DROPDOWN_ITEMS=[],f=0,h=u.length;f<h;f++){var o=u[f].name,e="",c="",s=-1;typeof o=="string"&&(s=o.lastIndexOf("."),s>-1?(e=o.substring(0,s),c=o.substring(s)):e=o);l=e.byte();l>50&&(e=e.substring(50)+"...");t.DROPDOWN_ITEMS.push({id:u[f].name,label:e+c,liCss:u[f].iconType,value:i+ecount.delimiter+f})}this.makeDropdownFile(t.DROPDOWN_ITEMS,n)}.bind(this),error:function(n,t,i){ecount.error(i.Message,{title:"System Error "+t,trace:i.MessageDetail})}});return}switch(r){case"TITLE":this.defaultParam={BOARD_CD:t.BOARD_CD,BOARD_SEQ:t.BOARD_SEQ,MENU_TYPE:t.MENU_TYPE};this.openPopup({url:"/ECERP/EGM/EGM026M",width:ecount.infra.getPageWidthFromConfig(),height:800});break;case"VIEW_READ":this.defaultParam={BOARD_CD:t.BOARD_CD,BOARD_SEQ:t.BOARD_SEQ,WRITER_ID:t.WRITER_ID};this.openPopup({url:"/ECERP/EGM/EGM024P_02"});break;case"WRITER_NAME":ecount.common.api({url:"/Common/Menu/GetProfileUserInfomation",ecPageID:this.ecPageID,data:{WRITER_ID:t.WRITER_ID},success:function(n){var t,i,r;n.Status=="200"&&n.Data.length!=0&&(t=n.Data.Data,i=t.DefaultImage,t.IS_EXIST&&(i=t.FILE_PATH),r={ID:t.data.ID,name:t.data.UNAME,phone:t.data.HP_NO,email:t.data.EMAIL,message:t.CHAT_STATUS_PHRASE,url:i,chatYN:t.CHAT_YN,userName:t.data.UNAME,RetUrl:n.Data.Data.RetUrl,SessionData:n.Data.Data.SessionData,PostData:n.Data.Data.PostData,profileViewData:t.profileViewData},ecount.profile.show(r))},complete:function(){self.hideProgressbar()}.bind(this)})}},ON_CLICK_SERVICE:function(n,t,i,r){r.command=_.camelCase("on_dropdown_file")},ON_CLICK_PREV:function(){var n=this,t={type:"reload",callback:function(){n._searchApiParam=null}};this._searchApiParam={ACTION:"PREV",CUR_BOARD_SEQ:this.epData.param.BOARD_SEQ};this.onMessage(this,t)},ON_CLICK_NEXT:function(){var n=this,t={type:"reload",callback:function(){n._searchApiParam=null}};this._searchApiParam={ACTION:"NEXT",CUR_BOARD_SEQ:this.epData.param.BOARD_SEQ};this.onMessage(this,t)},ON_CLICK_REFRESH:function(){this.epData.param.BOARD_CD!=undefined&&this.epData.param.BOARD_CD!==""&&this.reload()},ON_CLICK_NEW:function(){if(this.epData.param.BOARD_CD!=undefined&&this.epData.param.BOARD_CD!==""){this.defaultParam={BOARD_CD:this.epData.param.BOARD_CD,BOARD_SEQ:0,BOARD_TYPE:"N",EditFlag:"I",MENU_TYPE:this.epData.param.MENU_TYPE,ROOM_MEMBERS_STRING:null,ROOM_SEQ:0,STATUS_CD:0};var n={url:this._newPageUrl,width:800,height:800};this.openPopup(n)}else return},ON_CLICK_WINDOW:function(){if(this.epData.param.BOARD_CD!=undefined&&this.epData.param.BOARD_CD!==""){this.defaultParam={BOARD_CD:this.epData.param.BOARD_CD,BOARD_SEQ:0,BOARD_TYPE:"N",EditFlag:"I",MENU_TYPE:this.epData.param.MENU_TYPE,ROOM_MEMBERS_STRING:null,ROOM_SEQ:0,STATUS_CD:0};var n={url:this._movePageUrl,width:800,height:800};this.openPopup(n)}else return},onMessage:function(n,t){n.is_from_v5==undefined||n.is_from_v5==!1?t.type=="reload"?(t.BOARD_SEQ&&(this._searchApiParam={ACTION:"RELOAD",CUR_BOARD_SEQ:this.epData.param.BOARD_SEQ}),this._super.onMessage.apply(this,arguments),this._searchApiParam=null):t.callback&&t.callback():(n.callback&&n.callback(),this.reload())}},approval:{controlType:"widget.ep.approval",subTitle:"전자결재",_alwaysLoadByApi:!0,_searchApiURL:"/SVC/Service/EP/GetListEApprovalForWidget",_searchApiParam:{},_menuType:"7",_menuSeq:"39",_newPageUrl:"/ECERP/SVC/EGD/EGD001M",_movePageUrl:"/ECERP/SVC/EGD/EGD003M",_settingUrl:"/ECERP/ECP/ECP001P_18",_functionBtns:["window","refresh","new"],_optionsLayer:["setting","delete"],panelCss:"panel-ep-eapproval",_moveUrlInfo:{menuType:"7",menuSeq:"247",subMenu:"M070202000000",subMenuSeq:"247"},bodyDataConversion:function(n){var r=[],i=[],o="",u="",t,f,e;if($.isEmpty(n.data))return[];for(t=0,e=n.data.length;t<=e;t++){if(t==e){r.push(i);break}else f=n.data[t],u=f.type;o!=u&&(o=u,t>0&&(r.push(i),i=[]));i.push(f)}return r},getTemplateBody:function(n){var s="",r,l,t,p,o,i,v;if($.isNull(n.data))return"";if(this.groups=this.bodyDataConversion(n),$.isEmpty(this.groups))s=ecount.resource.MSG00205;else{var w=[],y='{{title}}\n<table class="table table-hover table-striped table-layout-auto">\n<colgroup>\n{{COLGROUP}}\n<\/colgroup>\n<thead>\n<tr>\n{{THHTML}}\n<\/tr>\n<\/thead>\n<tbody>\n{{body}}\n<\/tbody>\n<\/table>',h="",c="",e=n.columns;for(r=0;r<e.length;r++)h+='<col style="min-width:40px">',c+="<th>"+e[r].title+"<\/th>";for(r=0,l=this.groups.length;r<l;r++){var u=this.groups[r],a="",w=[],f="";for(t=0;t<u.length;t++){for(p=[],t==0&&(a=this._getTitle(u[t].type)),f+="<tr>",o=0;o<e.length;o++)i=e[o],i.id=="CTE.EDITER_TYPE"?f+=String.format('<td><a href="javascript:;" data-value="cellValue" data-index="{0}" data-group="{1}" data-column="{2}" data-function="click">{3}<\/a><\/td>',t,r,i.id,ecount.resource.BTN00027):i.id=="CTE.PRINT"?f+=String.format('<td><a href="javascript:;" data-value="cellValue" data-index="{0}" data-group="{1}" data-column="{2}" data-function="click">{3}<\/a><\/td>',t,r,i.id,ecount.resource.BTN00054):i.id=="REF_DATA"?(v=u[t][i.id].text?String.format("[{0}]",u[t][i.id].text):"",f+=String.format('<td><a href="javascript:;" data-value="cellValue" data-index="{0}" data-group="{1}" data-column="{2}" data-function="click" data-type="file">{3}<\/a><\/td>',t,r,i.id,v)):f+=i.id=="CTE.APP_TYPE"?String.format("<td>{0}<\/td>",this._getResource(u[t]["CTE.APP_TYPE"])):i.id=="CTE.WNAME"?String.format('<td><a href="javascript:;" data-value="cellValue" data-index="{0}" data-group="{1}" data-column="{2}" data-function="click">{3}<\/a><\/td>',t,r,i.id,u[t][i.id]||""):i.id=="CTE.btnCopy"?String.format('<td><a href="javascript:;" data-value="cellValue" data-index="{0}" data-group="{1}" data-column="{2}" data-function="click">{3}<\/a><\/td>',t,r,i.id,ecount.resource.BTN00028):i.id=="CTE.btnView"&&(u[t].APP_TYPE!="0"&&u[t].REFER_CHK=="Y"||u[t].APP_TYPE=="9")&&u[t].CC_CNT>0?String.format('<td><a href="javascript:;" data-value="cellValue" data-index="{0}" data-group="{1}" data-column="{2}" data-function="click">{3}<\/a><\/td>',t,r,i.id,"R"):i.id=="CTE.ABOL_TF"?String.format("<td>{0}<\/td>",u[t].EDMS_ABOL_TF=="1"?ecount.resource.LBL16314:ecount.resource.LBL21052):String.format("<td>{0}<\/td>",u[t][i.id]||"");f+="<\/tr>\n"}s+=ecount.widget.replaceAttr(y,{COLGROUP:h,THHTML:c,title:a,body:f})}}return s},setUIAfterBodyLoad:function(n){this._super.setUIAfterBodyLoad.apply(this,arguments);this.$el.find(".widget-name").text(n.header.title)},makeDropdownFile:function(n,t){_.isArray(n)&&n.length==1?this.delegator&&this.delegator.triggerEvent("page.customPageInvoke",_.merge({commandName:_.camelCase("on_dropdown_file")},{control:this,originItem:n[0],value:n[0].value})):_.isArray(n)&&n.length>1&&this.createDropdownList({items:n,boundary:ec$.getZoomedBoundary(t),hasDropdownLayerIcon:!0})},ON_CLICK_SERVICE:function(n,t,i,r){r.command=_.camelCase("on_dropdown_file")},ON_CLICK_CELLVALUE:function(n){var i=Number($(n).attr("data-index")),r=Number($(n).attr("data-group")),u=$(n).attr("data-column"),t=this.groups[r][i];switch(u){case"CTE.PRINT":this.openWindow({url:"/ECERP/SVC/EGD/EGD016P_06",param:{Request:{Drafts:[{EDMS_IDX:t.GWER_EDMS_IDX}],Data:{ROLE_CC_YN:"N",MODE:"PRINT"}}},width:900,height:700,name:ecount.resource.LBL02468,popupID:"EGD016P_06"});break;case"CTE.WNAME":ecount.common.api({url:"/Common/Menu/GetProfileUserInfomation",ecPageID:this.ecPageID,data:{WRITER_ID:t.WID},success:function(n){var t,i,r;n.Status=="200"&&n.Data.length!=0&&(t=n.Data.Data,i=t.DefaultImage,t.IS_EXIST&&(i=t.FILE_PATH),r={ID:t.data.ID,name:t.data.UNAME,phone:t.data.HP_NO,email:t.data.EMAIL,message:t.CHAT_STATUS_PHRASE,url:i,chatYN:t.CHAT_YN,userName:t.data.UNAME,RetUrl:n.Data.Data.RetUrl,SessionData:n.Data.Data.SessionData,PostData:n.Data.Data.PostData,profileViewData:t.profileViewData},ecount.profile.show(r))},complete:function(){self.hideProgressbar()}});break;case"CTE.btnCopy":this.viewBag={};ecmodule.common.eapproval.createGWERDoc(this,{FROM_EDMS_IDX:t.GWER_EDMS_IDX,FORM_SEQ:t.FORM_SEQ});break;case"CTE.btnView":ecmodule.common.eapproval.viewGWERDocCC(this,t.GWER_EDMS_IDX);break;case"REF_DATA":_.isArray(t.DROPDOWN_ITEMS)&&t.DROPDOWN_ITEMS.length>0?this.makeDropdownFile(t.DROPDOWN_ITEMS,n):ecount.common.api({url:"/SVC/Common/Infra/GetRefData",async:!0,data:Object.toJSON({HID:t.HID}),success:function(u){var f,e,c,a;for(u.Data=u.Data||{},f=[],f=ecmodule.common.slipLink.setRefDataChange(u.Data,t),t.FILE=f,t.DROPDOWN_ITEMS=[],e=0,c=f.length;e<c;e++){var s=f[e].name,o="",l="",h=-1;typeof s=="string"&&(h=s.lastIndexOf("."),h>-1?(o=s.substring(0,h),l=s.substring(h)):o=s);a=o.byte();a>50&&(o=o.substring(50)+"...");t.DROPDOWN_ITEMS.push({id:f[e].name,label:o+l,liCss:f[e].iconType,value:i+ecount.delimiter+e+ecount.delimiter+r})}this.makeDropdownFile(t.DROPDOWN_ITEMS,n)}.bind(this),error:function(n,t,i){ecount.error(i.Message,{title:"System Error "+t,trace:i.MessageDetail})}});break;default:ecmodule.common.eapproval.viewGWERDoc(this,t.GWER_EDMS_IDX,{ROLE_CC_YN:"N"})}},openWindow:function(n){n.param&&(this.defaultParam=n.param);this.openPopup(n)},_getResource:function(n){var t=ecount.resource.LBL03616;switch(n){case"1":t=ecount.resource.LBL02690;break;case"3":t=ecount.resource.LBL01241;break;case"9":t=ecount.resource.LBL04665;break;case"8":t=ecount.resource.LBL03684;break;case"99":t=ecount.resource.LBL03615;break;default:t=ecount.resource.LBL03616}return t},_getTitle:function(n){var t="";if(n=="1")return"";switch(n){case"MyDraft":t=ecount.resource.LBL09533;break;case"UnApproval":t=ecount.resource.LBL09534;break;case"RefDocument":t=ecount.resource.LBL09561;break;case"SharedDocument":t=ecount.resource.LBL19397}return String.format('<div class="wrapper-sub-title">{0}<\/div>',t)},ON_CLICK_WINDOW:function(){var n=!1;this.defaultParam={alreadyIncludedLayout:!n,IS_EP:!0};this.openPopup({url:"/ECERP/SVC/EGD/EGD003M",param:{alreadyIncludedLayout:!n},name:"EGD003M",popupID:null,parentPageID:null,popupType:n,width:800,height:800,additional:!0,notCloseMenuChanged:!0})}},upgradeDetails:{controlType:"widget.ep.upgradeDetails",subTitle:"업그레이드 내역",_alwaysLoadByApi:!0,_searchApiURL:"/Service/EP/GetUpgrateDetailsEPData",_searchApiParam:{},_newPageUrl:"",_movePageUrl:"",_settingUrl:"",_functionBtns:["window","refresh"],_optionsLayer:["delete"],init:function(){this._super.init.apply(this,arguments);this.viewBag=ecount.global.findViewBag(this.ecPageID);this.optionsLayerResource.passupgrade=ecount.resource.LBL09029;this._searchApiParam={SEQ:"0",LANG_CD:this.viewBag.Language,FOREIGN_YN:ecount.company.FOREIGN_YN||""}},setBodyByApi:function(n){var t;$.isNull(this.epData.body)&&(this.epData.body={});this.epData.body.data=n;this.$el.attr("ep-id",this.id);this.$el.find("span.widget-name").text(this.epData.body.data.UpgradeDate);t=this.epData.allowed===!1?this.requestForPermissionTemplate:this.getTemplateBody(this.epData.body||{});this.$el.find("div.panel-body > div").empty().append(t);this.epData.EditFlag="M";this._refresh=!1;this.setUIAfterBodyLoad(this.epData);this.hideLoadingbar()},getTemplateBody:function(n){if(n.data!=null)return String.format('<div class="ep-upgrade-history">{0}<\/div>',n.data.Content)},ON_CLICK_WINDOW:function(n){var r=Number($(n).attr("data-index")),t="",i=this.epData.body.data.FOREIGN_YN;switch(i){case"00":t="10";break;case"01":case"03":case"04":t="6";break;default:t="5"}this.defaultParam={isChangePopupType:!1};this.openPopup({url:String.format("/ECERP/ECU/ECU200M?navIndex={0}&boardId=0&tabFlag=&strBoardId=U",t),popupType:!1,width:screen.availWidth<1100?screen.availWidth*.95:1100,height:screen.availHeight<740?screen.availHeight*.9:740,boardId:0,tabFlag:"",strBoardId:"U"})}},supportCenter:{controlType:"widget.ep.supportCenter",subTitle:"상담지원센터",_alwaysLoadByApi:!0,_searchApiURL:"",_searchApiParam:{},_newPageUrl:"",_movePageUrl:"",_settingUrl:"",_functionBtns:["new"],_optionsLayer:["delete"],_isDemo:!0},demoSelect:{controlType:"widget.ep.demoSelect",subTitle:"방문설명 요청",_alwaysLoadByApi:!0,_searchApiURL:"",_searchApiParam:{},_newPageUrl:"",_movePageUrl:"",_settingUrl:"",_functionBtns:[],_optionsLayer:["delete"],_isDemo:!0},drivingLog:{controlType:"widget.ep.drivingLog",subTitle:ecount.resource.LBL02939,_menuType:"7",_menuSeq:"38",_alwaysLoadByApi:!0,_searchApiURL:"/SVC/Service/EP/GetListDrivingLogForWidget",_searchApiParam:{},_newPageUrl:"/ECERP/EGK/EGK003P",_movePageUrl:"/ECERP/SVC/EGK/EGK002M",_settingUrl:"/ECERP/ECP/ECP001P_21",_functionBtns:["window","refresh","new"],_optionsLayer:["setting","delete"],_decimalGroup:"S",_moveUrlInfo:{menuType:"7",menuSeq:"1766",subMenu:"M070130002000",subMenuSeq:"1766"},IsUseTagTemplate:function(n){return["DRIVING_LOG.SLIP_DATE_NO","DRIVING_LOG.SLIP_DATE"].contains(n.id)},OpenLinkPopup:function(n){var t="";switch(n.colCd){case"DRIVING_LOG.SLIP_DATE_NO":case"DRIVING_LOG.SLIP_DATE":t="/ECERP/EGK/EGK003P";this.defaultParam={Request:{Key:{Date:n.data.SLIP_DATE,No:n.data.REQ_NO},EditMode:ecenum.editMode.modify,FromProgramId:"E070254",PrevUrl:"/ECERP/ECP/ECP001M",UIOption:{Width:850,Height:900,FocusRowNumber:n.data.SER_NO||1}}}}_.isEmpty(t)||this.openPopup({url:t,name:""})},ON_CLICK_CELLVALUE:function(n){var t={},i=Number($(n).attr("data-index"));t={columns:this.epData.body.columns,data:this.epData.body.data[i]};this.defaultParam={SLIP_DATE:t.data.SLIP_DATE,SLIP_NO:t.data.SLIP_NO,EditFlag:"M"};this.openPopup({url:"/ECERP/EGK/EGK003P",width:800,height:600,popupType:!1})},ON_CLICK_NEW:function(){this.defaultParam={EditFlag:ecenum.editFlag.New};this.openPopup({url:this._newPageUrl,width:800})}},eNote:{controlType:"widget.ep.eNote",subTitle:"E Note",_alwaysLoadByApi:!0,_searchApiURL:"/SVC/Service/EP/GetListENoteWidget",_searchApiParam:{},_menuType:"",_menuSeq:"",_newPageUrl:"/ECERP/SVC/ENT/ENT003M",_movePageUrl:"/ECERP/SVC/ENT/ENT001M",_settingUrl:"/ECERP/SVC/ECP/ECP001P_26",_functionBtns:["window","refresh","new"],_optionsLayer:["setting","delete"],_decimalGroup:"C",_moveUrlInfo:{menuType:"",menuSeq:"",subMenu:"",subMenuSeq:""},typeValue:{ToDo:1,Memo:2,MyStorage:3,Image:4},afterRenderEl:function(){this._super.afterRenderEl.apply(this,arguments);this.setHeaderTitle()},setHeaderTitle:function(){var n=ecount.resource.LBL18478;this.epData&&this.epData.param&&this.epData.param.TYPE_VALUE&&(this.epData.param.TYPE_VALUE==this.typeValue.Memo?n=ecount.resource.BTN00973:this.epData.param.TYPE_VALUE==this.typeValue.MyStorage?n=ecount.resource.LBL18541:this.epData.param.TYPE_VALUE==this.typeValue.Image&&(n=ecount.resource.LBL18540));this.$el.find("span.widget-name").html(n)},getTemplateBody:function(n){return $.isNull(n.data)?ecount.resource.MSG00205:(this.groups=this.getGroupDataTable(n),this.getTemplateBodyCustom(this.groups))},getGroupDataTable:function(n){var i,r,u,f,t;if($.isEmpty(n.data))return[];if(i=[],r=this.getArrayCatId(n.data),r.length<1)i.push({columns:n.columns,data:n.data});else for(u=0;u<r.length;u++){for(f=[],t=0;t<n.data.length;t++)r[u]==n.data[t].CAT_ID.toString()&&f.push(n.data[t]);i.push({columns:n.columns,data:f})}return i},getArrayCatId:function(n){if(!n[0].CAT_ID)return[];var t=[],r=[];for(i=0;i<n.length;i++)t[n[i].CAT_ID]||(t[n[i].CAT_ID]=!0,r.push(n[i].CAT_ID));return r},getTemplateBodyCustom:function(n){var r,u,i,f,t;if($.isEmpty(n))return ecount.resource.MSG00205;for(r="",u='{{title}}\n<table class="table table-hover table-striped table-ellipsis">\n<thead>\n<tr>\n{{head}}\n<\/tr>\n<\/thead>\n<tbody>\n{{body}}\n<\/tbody>\n<\/table>',i=0,f=n.length;i<f;i++)t=n[i],$.isEmpty(t.data)||(r+=ecount.widget.replaceAttr(u,{title:this.getTemplateCategoryTitle(t.data[0].CAT_NM),head:this.getTemplateHeadTable(t.columns).join("\n"),body:this.getTemplateBodyTable(t.columns,t.data,i).join("\n")}));return r},getTemplateCategoryTitle:function(n){return n?String.format('<div class="wrapper-sub-title">{0}<\/div>',ecount.resource[n]?ecount.resource[n]:n):""},getTemplateHeadTable:function(n){for(var i,r=[],t=0;t<n.length;t++)i=[],["ENOTE_CTT","MYIMAGE_TITLE","MYSTORAGE_TITLE"].contains(n[t].id)?i.push(String.format("<th style='width: 30%;'>{0}<\/th>",n[t].title)):n[t].id.contains("_DT",!0)||n[t].id.contains("_ATTACHMENT",!0)?i.push(String.format("<th style='width: 70px;'>{0}<\/th>",n[t].title)):i.push(String.format("<th>{0}<\/th>",n[t].title)),r.push(i.join("\n"));return r},getTemplateBodyTable:function(n,t,i){for(var f,u,e,s,o=[],r=0;r<t.length;r++){for(f=[],f.push("<tr>"),u=0;u<n.length;u++)if(n[u].tagType=="LINK")switch(this.epData.param.TYPE_VALUE){case this.typeValue.ToDo:case this.typeValue.Memo:t[r].NEW_TF==1?f.push(String.format('<td><span style="margin-left: -0.1px;" class="icon-list-new {0}">&nbsp;<\/span><a style="margin-left: 3px;" href="javascript:;" data-value="cellValue" data-hid="{0}" data-new-tf="{1}" data-function="click">{2}<\/a><\/td>',t[r].HID,t[r].NEW_TF,t[r][n[u].name])):f.push(String.format('<td><a href="javascript:;" data-value="cellValue" data-hid="{0}" data-function="click">{1}<\/a><\/td>',t[r].HID,t[r][n[u].name]));break;case this.typeValue.MyStorage:f.push(String.format('<td><a href="javascript:;" data-tag-type="{0}" data-value="cellValue" data-idx="{1}" data-function="click">{2}<\/a><\/td>',n[u].tagType,t[r].IDX,t[r][n[u].name]));break;case this.typeValue.Image:f.push(String.format('<td><a href="javascript:;" data-tag-type="{0}" data-value="cellValue" data-seq="{1}" data-cat="{2}" data-function="click">{3}<\/a><\/td>',n[u].tagType,t[r].SEQ,t[r].CAT_ID,t[r][n[u].name]))}else n[u].tagType=="LABEL"?f.push(String.format("<td>{0}<\/td>",this.getTemplateLabel(t[r][n[u].name]))):n[u].tagType=="ATTACH"?(e=0,t[r][n[u].name]&&(e=t[r][n[u].name].length),s=this.getAttachTemplate(n[u],e,r,i),f.push(String.format("<td style='overflow: visible;'>{0}<\/td>",s))):f.push(String.format("<td style='text-align: center;'>{0}<\/td>",t[r][n[u].name]));f.push("<\/tr>");o.push(f.join("\n"))}return o},getAttachTemplate:function(n,t,i,r){if(t==0)return"";var u='<a class="{{css}}" href="javascript:;" data-tag-type="ATTACH" data-group-index="{{groupIndex}}" data-index="{{index}}" data-column="{{column}}" data-value="cellValue" data-function="click" {{attachment}}>{{data}}<\/a>',f=t,e="";if(t==1)u=String.format('<div class="text-center">{0}<\/div>',u),f="[1]",e='data-attachment="0"';else return this.getDropdownTemplate(n,t,i,u,r);return ecount.widget.replaceAttr(u,{css:"",data:f,groupIndex:r,index:i,column:n.id,attachment:e})},getDropdownTemplate:function(n,t,i,r,u){var s=this.epData.body.data[i],e=s[n.id],o="",h=['<div class="text-center">','<div class="btn-group link-group">','<a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false">[{{count}}]<\/a>','<ul class="dropdown-menu dropdown-menu-right" role="menu" style="max-height:250px;overflow-y:scroll;">',"{{items}}","<\/ul>","<\/div>","<\/div>",].join("\n"),f;if(r=String.format("<li>{0}<\/li>",r),!e)return"";for(f=0;f<e.length;f++)o+=ecount.widget.replaceAttr(r,{css:"",data:e[f].FileName,index:i,groupIndex:u,column:n.id,attachment:String.format('data-attachment="{0}"',f)});return ecount.widget.replaceAttr(h,{count:t,items:o})},getTemplateLabel:function(n){var i="",t;return n&&(t='<span class="label mr-5" style="background-color:{{0}};">{{1}}<\/span>',n.forEach(function(n){n.color>"#dddddd"&&(t=t.replace("label","label label-light"));i+=t.replace("{{0}}",n.color).replace("{{1}}",n.label);t='<span class="label  mr-5" style="background-color:{{0}};">{{1}}<\/span>'})),i},ON_CLICK_CELLVALUE:function(n){switch(this.epData.param.TYPE_VALUE){case this.typeValue.ToDo:case this.typeValue.Memo:this.defaultParam={width:ecount.infra.getPageWidthFromConfig(),height:540,Request:{EditMode:ecenum.editMode.modify,Data:{HID:$(n).attr("data-hid"),FROM_NEW_TF:$(n).attr("data-new-tf")==1}}};this.openPopup({url:"/ECERP/SVC/ENT/ENT003M",name:ecount.resource.LBL18290});break;case this.typeValue.MyStorage:if($(n).attr("data-tag-type")=="LINK")this.defaultParam={width:ecount.infra.getPageWidthFromConfig(),height:540,editFlag:ecenum.editFlag.modify,IDX:$(n).attr("data-idx")},this.openPopup({url:"/ECERP/SVC/ENT/ENT006M",name:ecount.resource.LBL05860});else if($(n).attr("data-tag-type")=="ATTACH"){var i=$(n).attr("data-group-index"),r=$(n).attr("data-index"),u=$(n).attr("data-attachment"),f=$(n).attr("data-column"),t=this.groups[i].data[r][f][u],e={FsComCode:t.ComCode,FsOwnerKey:t.fsOwnerKey,FsFileName:t.FileName,FileStorage:ecmodule.common.fileStorage.getFileStorageHost(1),ecPageID:this.ecPageID};ecount.document.downloadFile(e)}break;case this.typeValue.Image:if($(n).attr("data-tag-type")=="LINK")this.defaultParam={width:ecount.infra.getPageWidthFromConfig(),height:540,Request:{Data:{SEQ:$(n).attr("data-seq"),THUMB_NUMBER:2,TYPE:$(n).attr("data-cat")}}},this.openPopup({url:"/ECERP/SVC/ENT/ENT009M",name:ecount.resource.LBL08150});else if($(n).attr("data-tag-type")=="ATTACH"){var i=$(n).attr("data-group-index"),r=$(n).attr("data-index"),u=$(n).attr("data-attachment"),f=$(n).attr("data-column"),t=this.groups[i].data[r][f][u],e={FsComCode:t.ComCode,FsOwnerKey:t.fsOwnerKey,FsFileName:t.FileName,FileStorage:ecmodule.common.fileStorage.getFileStorageHost(0),ecPageID:this.ecPageID};ecount.document.downloadFile(e)}}},ON_CLICK_NEW:function(){switch(this.epData.param.TYPE_VALUE){case this.typeValue.ToDo:case this.typeValue.Memo:this.defaultParam={width:ecount.infra.getPageWidthFromConfig(),height:540,Request:{EditMode:ecenum.editMode.new,Data:{ENOTE_TYPE_CD:this.epData.param.TYPE_VALUE==this.typeValue.ToDo?"T":"M"}}};this.openPopup({url:"/ECERP/SVC/ENT/ENT003M",name:ecount.resource.LBL18290});break;case this.typeValue.MyStorage:this.defaultParam={width:ecount.infra.getPageWidthFromConfig(),height:540,editFlag:ecenum.editFlag.New,Data:{IDX:0},Request:{editFlag:ecenum.editFlag.New,Data:{IDX:0}}};this.openPopup({url:"/ECERP/SVC/ENT/ENT005M",name:ecount.resource.LBL05860});break;case this.typeValue.Image:this.defaultParam={width:ecount.infra.getPageWidthFromConfig(),height:540,Request:{EditMode:ecenum.editMode.new}};this.openPopup({url:"/ECERP/SVC/ENT/ENT008M",name:ecount.resource.LBL18285})}},ON_CLICK_WINDOW:function(){switch(this.epData.param.TYPE_VALUE){case this.typeValue.ToDo:this._movePageUrl="/ECERP/SVC/ENT/ENT001M";break;case this.typeValue.Memo:this._movePageUrl="/ECERP/SVC/ENT/ENT002M";break;case this.typeValue.MyStorage:this._movePageUrl="/ECERP/SVC/ENT/ENT004M";break;case this.typeValue.Image:this._movePageUrl="/ECERP/SVC/ENT/ENT007M"}var n={url:this._movePageUrl,width:ecount.infra.getPageWidthFromConfig(),height:580};this.openPopup(n)},onMessage:function(n,t){if(n.pageID=="ENT003M"&&t.type=="remo-new-icon"){var i=this.$el.find("."+t.hid);i&&i.length>0&&(i.remove(),i=this.$el.find("a[data-hid="+t.hid+"]"),i&&i.length>0&&i.removeAttr("style"))}else this._super.onMessage.apply(this,arguments)}},create:function(n){var t,r,i;(n=n||"_default",t=widget.ep.repository[n]||{},widget.ep._baseLoaded||(r=$.Class(ecount.control,widget.ep.repository._default),widget.ep=$.extend(r,widget.ep),widget.ep._baseLoaded=!0,n!="_default"))&&(widget.ep[n]||(t.init||(t.init=function(){widget.ep.prototype.init.apply(this,arguments)}),t.render||(t.render=function(){widget.ep.prototype.render.apply(this,arguments)}),t.__inheritParent?(t.__inheritParent.indexOf("widget.ep.")==0&&ecount.control.lazyLoad(t.__inheritParent),i=ecount.common.createNamespace(t.__inheritParent)):i=widget.ep,widget.ep[n]=$.Class(i,t)))}}},function(n){if(typeof define=="function"&&define.amd)define(["jquery","lodash"],n);else if(typeof module=="object"&&typeof module.exports=="object"){try{jQuery=require("jquery")}catch(t){}try{_=require("lodash")}catch(t){}n(jQuery,_)}else n(jQuery,_)}(function(n,t){function e(n){this.grid=n}var s=window,u=function(n,t,i){var r=function(){return console.warn("gridstack.js: Function `"+t+"` is deprecated as of v0.2.5 and has been replaced with `"+i+"`. It will be **completely** removed in v1.0."),n.apply(this,arguments)};return r.prototype=n.prototype,r},o=function(n,t){console.warn("gridstack.js: Option `"+n+"` is deprecated as of v0.2.5 and has been replaced with `"+t+"`. It will be **completely** removed in v1.0.")},f={isIntercepted:function(n,t){return!(n.x+n.width<=t.x||t.x+t.width<=n.x||n.y+n.height<=t.y||t.y+t.height<=n.y)},sort:function(n,i,r){return r=r||t.chain(n).map(function(n){return n.x+n.width}).max().value(),i=i!=-1?1:-1,t.sortBy(n,function(n){return i*(n.x+n.y*r)})},createStylesheet:function(n){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.setAttribute("data-gs-style-id",n),t.styleSheet?t.styleSheet.cssText="":t.appendChild(document.createTextNode("")),document.getElementsByTagName("head")[0].appendChild(t),t.sheet},removeStylesheet:function(t){n("STYLE[data-gs-style-id="+t+"]").remove()},insertCSSRule:function(n,t,i,r){typeof n.insertRule=="function"?n.insertRule(t+"{"+i+"}",r):typeof n.addRule=="function"&&n.addRule(t,i,r)},toBool:function(n){return typeof n=="boolean"?n:typeof n=="string"?(n=n.toLowerCase(),!(n===""||n=="no"||n=="false"||n=="0")):Boolean(n)},_collisionNodeCheck:function(n){return n!=this.node&&f.isIntercepted(n,this.nn)},_didCollide:function(n){return f.isIntercepted({x:this.n.x,y:this.newY,width:this.n.width,height:this.n.height},n)},_isAddNodeIntercepted:function(n){return f.isIntercepted({x:this.x,y:this.y,width:this.node.width,height:this.node.height},n)},parseHeight:function(n){var i=n,u="px",r;if(i&&t.isString(i)){if(r=i.match(/^(-[0-9]+\.[0-9]+|[0-9]*\.[0-9]+|-[0-9]+|[0-9]+)(px|em|rem|vh|vw)?$/),!r)throw new Error("Invalid height");u=r[2]||"px";i=parseFloat(r[1])}return{height:i,unit:u}}},h,r,i;return f.is_intercepted=u(f.isIntercepted,"is_intercepted","isIntercepted"),f.create_stylesheet=u(f.createStylesheet,"create_stylesheet","createStylesheet"),f.remove_stylesheet=u(f.removeStylesheet,"remove_stylesheet","removeStylesheet"),f.insert_css_rule=u(f.insertCSSRule,"insert_css_rule","insertCSSRule"),e.registeredPlugins=[],e.registerPlugin=function(n){e.registeredPlugins.push(n)},e.prototype.resizable=function(){return this},e.prototype.draggable=function(){return this},e.prototype.droppable=function(){return this},e.prototype.isDroppable=function(){return!1},e.prototype.on=function(){return this},h=0,r=function(n,t,i,r,u){this.width=n;this.float=i||!1;this.height=r||0;this.nodes=u||[];this.onchange=t||function(){};this._updateCounter=0;this._float=this.float;this._addedNodes=[];this._removedNodes=[]},r.prototype.batchUpdate=function(){this._updateCounter=1;this.float=!0},r.prototype.commit=function(){this._updateCounter!==0&&(this._updateCounter=0,this.float=this._float,this._packNodes(),this._notify())},r.prototype.getNodeDataByDOMEl=function(n){return t.find(this.nodes,function(t){return n.get(0)===t.el.get(0)})},r.prototype._fixCollisions=function(n){var e=this,r,u,i;for(this._sortNodes(-1),r=n,u=Boolean(t.find(this.nodes,function(n){return n.locked})),this.float||u||(r={x:0,y:n.y,width:this.width,height:n.height});;){if(i=t.find(this.nodes,t.bind(f._collisionNodeCheck,{node:n,nn:r})),typeof i=="undefined")return;this.moveNode(i,i.x,n.y+n.height,i.width,i.height,!0)}},r.prototype.isAreaEmpty=function(n,i,r,u){var o={x:n||0,y:i||0,width:r||1,height:u||1},e=t.find(this.nodes,t.bind(function(n){return f.isIntercepted(n,o)},this));return e===null||typeof e=="undefined"},r.prototype._sortNodes=function(n){this.nodes=f.sort(this.nodes,n,this.width)},r.prototype._packNodes=function(){this._sortNodes();this.float?t.each(this.nodes,t.bind(function(n){var i,r;if(!n._updating&&typeof n._origY!="undefined"&&n.y!=n._origY)for(i=n.y;i>=n._origY;)r=t.chain(this.nodes).find(t.bind(f._didCollide,{n:n,newY:i})).value(),r||(n._dirty=!0,n.y=i),--i},this)):t.each(this.nodes,t.bind(function(n,i){var r,u,e;if(!n.locked)while(n.y>0){if(r=n.y-1,u=i===0,i>0&&(e=t.chain(this.nodes).take(i).find(t.bind(f._didCollide,{n:n,newY:r})).value(),u=typeof e=="undefined"),!u)break;n._dirty=n.y!=r;n.y=r}},this))},r.prototype._prepareNode=function(n,i){return n=t.defaults(n||{},{width:1,height:1,x:0,y:0}),n.x=parseInt(""+n.x),n.y=parseInt(""+n.y),n.width=parseInt(""+n.width),n.height=parseInt(""+n.height),n.autoPosition=n.autoPosition||!1,n.noResize=n.noResize||!1,n.noMove=n.noMove||!1,n.width>this.width?n.width=this.width:n.width<1&&(n.width=1),n.height<1&&(n.height=1),n.x<0&&(n.x=0),n.x+n.width>this.width&&(i?n.width=this.width-n.x:n.x=this.width-n.width),n.y<0&&(n.y=0),n},r.prototype._notify=function(){var n=Array.prototype.slice.call(arguments,0),t;if(n[0]=typeof n[0]=="undefined"?[]:[n[0]],n[1]=typeof n[1]=="undefined"?!0:n[1],!this._updateCounter){t=n[0].concat(this.getDirtyNodes());this.onchange(t,n[1])}},r.prototype.cleanNodes=function(){this._updateCounter||t.each(this.nodes,function(n){n._dirty=!1})},r.prototype.getDirtyNodes=function(){return t.filter(this.nodes,function(n){return n._dirty})},r.prototype.addNode=function(n,i){var r,u,e;if(n=this._prepareNode(n),typeof n.maxWidth!="undefined"&&(n.width=Math.min(n.width,n.maxWidth)),typeof n.maxHeight!="undefined"&&(n.height=Math.min(n.height,n.maxHeight)),typeof n.minWidth!="undefined"&&(n.width=Math.max(n.width,n.minWidth)),typeof n.minHeight!="undefined"&&(n.height=Math.max(n.height,n.minHeight)),n._id=++h,n._dirty=!0,n.autoPosition)for(this._sortNodes(),r=0;;++r)if((u=r%this.width,e=Math.floor(r/this.width),!(u+n.width>this.width))&&!t.find(this.nodes,t.bind(f._isAddNodeIntercepted,{x:u,y:e,node:n}))){n.x=u;n.y=e;break}return this.nodes.push(n),typeof i!="undefined"&&i&&this._addedNodes.push(t.clone(n)),this._fixCollisions(n),this._packNodes(),this._notify(),n},r.prototype.removeNode=function(n,i){i=typeof i=="undefined"?!0:i;this._removedNodes.push(t.clone(n));n._id=null;this.nodes=t.without(this.nodes,n);this._packNodes();this._notify(n,i)},r.prototype.canMoveNode=function(i,u,f,e,o){var l,s,h,c;return this.isNodeChangedPosition(i,u,f,e,o)?(l=Boolean(t.find(this.nodes,function(n){return n.locked})),!this.height&&!l)?!0:(h=new r(this.width,null,this.float,0,t.map(this.nodes,function(t){return t==i?s=n.extend({},t):n.extend({},t)})),typeof s=="undefined")?!0:(h.moveNode(s,u,f,e,o),c=!0,l&&(c&=!Boolean(t.find(h.nodes,function(n){return n!=s&&Boolean(n.locked)&&Boolean(n._dirty)}))),this.height&&(c&=h.getGridHeight()<=this.height),c):!1},r.prototype.canBePlacedWithRespectToHeight=function(i){if(!this.height)return!0;var u=new r(this.width,null,this.float,0,t.map(this.nodes,function(t){return n.extend({},t)}));return u.addNode(i),u.getGridHeight()<=this.height},r.prototype.isNodeChangedPosition=function(n,t,i,r,u){return(typeof t!="number"&&(t=n.x),typeof i!="number"&&(i=n.y),typeof r!="number"&&(r=n.width),typeof u!="number"&&(u=n.height),typeof n.maxWidth!="undefined"&&(r=Math.min(r,n.maxWidth)),typeof n.maxHeight!="undefined"&&(u=Math.min(u,n.maxHeight)),typeof n.minWidth!="undefined"&&(r=Math.max(r,n.minWidth)),typeof n.minHeight!="undefined"&&(u=Math.max(u,n.minHeight)),n.x==t&&n.y==i&&n.width==r&&n.height==u)?!1:!0},r.prototype.moveNode=function(n,t,i,r,u,f){if(!this.isNodeChangedPosition(n,t,i,r,u)||(typeof t!="number"&&(t=n.x),typeof i!="number"&&(i=n.y),typeof r!="number"&&(r=n.width),typeof u!="number"&&(u=n.height),typeof n.maxWidth!="undefined"&&(r=Math.min(r,n.maxWidth)),typeof n.maxHeight!="undefined"&&(u=Math.min(u,n.maxHeight)),typeof n.minWidth!="undefined"&&(r=Math.max(r,n.minWidth)),typeof n.minHeight!="undefined"&&(u=Math.max(u,n.minHeight)),n.x==t&&n.y==i&&n.width==r&&n.height==u))return n;var e=n.width!=r;return n._dirty=!0,n.x=t,n.y=i,n.width=r,n.height=u,n.lastTriedX=t,n.lastTriedY=i,n.lastTriedWidth=r,n.lastTriedHeight=u,n=this._prepareNode(n,e),this._fixCollisions(n),f||(this._packNodes(),this._notify()),n},r.prototype.getGridHeight=function(){return t.reduce(this.nodes,function(n,t){return Math.max(n,t.y+t.height)},0)},r.prototype.beginUpdate=function(n){t.each(this.nodes,function(n){n._origY=n.y});n._updating=!0},r.prototype.endUpdate=function(){t.each(this.nodes,function(n){n._origY=n.y});var n=t.find(this.nodes,function(n){return n._updating});n&&(n._updating=!1)},i=function(i,u){var f=this,h,l,a,v,p,s,y,c;if(u=u||{},this.container=n(i),typeof u.handle_class!="undefined"&&(u.handleClass=u.handle_class,o("handle_class","handleClass")),typeof u.item_class!="undefined"&&(u.itemClass=u.item_class,o("item_class","itemClass")),typeof u.placeholder_class!="undefined"&&(u.placeholderClass=u.placeholder_class,o("placeholder_class","placeholderClass")),typeof u.placeholder_text!="undefined"&&(u.placeholderText=u.placeholder_text,o("placeholder_text","placeholderText")),typeof u.vertical_margin!="undefined"?(u.verticalMargin=u.vertical_margin,o("vertical_margin","verticalMargin")):u.verticalMargin=20,typeof u.cell_blockSize!="undefined"?(u.cellHeight=u.cell_blockSize,u.cellWidth=u.cell_blockSize+u.verticalMargin):(typeof u.cell_height!="undefined"&&(u.cellHeight=u.cell_height,o("cell_height","cellHeight")),typeof u.cell_width!="undefined"&&(u.cellWidth=u.cell_width,o("cell_height","cellHeight"))),typeof u.min_width!="undefined"&&(u.minWidth=u.min_width,o("min_width","minWidth")),typeof u.static_grid!="undefined"&&(u.staticGrid=u.static_grid,o("static_grid","staticGrid")),typeof u.is_nested!="undefined"&&(u.isNested=u.is_nested,o("is_nested","isNested")),typeof u.always_show_resize_handle!="undefined"&&(u.alwaysShowResizeHandle=u.always_show_resize_handle,o("always_show_resize_handle","alwaysShowResizeHandle")),u.itemClass=u.itemClass||"grid-stack-item",a=this.container.closest("."+u.itemClass).length>0,this.opts=t.defaults(u||{},{width:parseInt(this.container.attr("data-gs-width"))||12,height:parseInt(this.container.attr("data-gs-height"))||0,itemClass:"grid-stack-item",placeholderClass:"grid-stack-placeholder",placeholderText:"",handle:".grid-stack-item-content",handleClass:null,cellHeight:100,cellWidth:120,verticalMargin:20,auto:!0,minWidth:1200,float:!1,staticGrid:!1,_class:"grid-stack-instance-"+(Math.random()*1e4).toFixed(0),animate:Boolean(this.container.attr("data-gs-animate"))||!1,alwaysShowResizeHandle:u.alwaysShowResizeHandle||!1,resizable:t.defaults(u.resizable||{},{autoHide:!1,handles:"se"}),draggable:t.defaults(u.draggable||{},{handle:(u.handleClass?"."+u.handleClass:u.handle?u.handle:"")||".grid-stack-item-content",scroll:!1,appendTo:"body",cancel:u.cancelClass?"."+u.cancelClass:""}),disableDrag:u.disableDrag||!1,disableResize:u.disableResize||!1,rtl:"auto",removable:!1,removeTimeout:2e3,verticalMarginUnit:"px",cellHeightUnit:"px",ddPlugin:null}),this.opts.ddPlugin===!1?this.opts.ddPlugin=e:this.opts.ddPlugin===null&&(this.opts.ddPlugin=t.first(e.registeredPlugins)||e),this.dd=new this.opts.ddPlugin(this),this.opts.rtl==="auto"&&(this.opts.rtl=this.container.css("direction")==="rtl"),this.opts.rtl&&this.container.addClass("grid-stack-rtl"),this.opts.isNested=a,l=this.opts.cellHeight==="auto",l?f.cellHeight(f.cellWidth(),!0):this.cellHeight(this.opts.cellHeight,!0),this.verticalMargin(this.opts.verticalMargin,!0),this.container.addClass(this.opts._class),this.container.css({position:"absolute",left:0,right:0,bottom:0,top:0,overflow:"auto"}),this._setStaticClass(),a&&this.container.addClass("grid-stack-nested"),this._initStyles(),this.grid=new r(this.opts.width,function(n,i){i=typeof i=="undefined"?!0:i;var r=0,u=0;t.each(n,function(n){i&&n._id===null?n.el&&n.el.remove():(n.el.attr("data-gs-x",n.x).attr("data-gs-y",n.y).attr("data-gs-width",n.width).attr("data-gs-height",n.height),r=Math.max(r,n.y+n.height),u=Math.max(u,n.x+n.width))});f._updateStyles(r+10,u+10)},this.opts.float,this.opts.height),this.opts.auto&&(v=[],p=this,this.container.children("."+this.opts.itemClass+":not(."+this.opts.placeholderClass+")").each(function(t,i){i=n(i);v.push({el:i,i:parseInt(i.attr("data-gs-x"))+parseInt(i.attr("data-gs-y"))*p.opts.width})}),t.chain(v).sortBy(function(n){return n.i}).each(function(n){f._prepareElement(n.el)}).value()),this.setAnimation(this.opts.animate),this.placeholder=n('<div class="'+this.opts.placeholderClass+" "+this.opts.itemClass+'"><div class="placeholder-content">'+this.opts.placeholderText+"<\/div><\/div>").hide(),this._updateContainerHeight(),this._updateHeightsOnResize=t.throttle(function(){f.cellHeight(f.cellWidth(),!1)},100),this.onResizeHandler=function(){if(l&&f._updateHeightsOnResize(),f._isOneColumnMode()){if(h)return;f.container.addClass(f.opts.oneColumnModeClass);h=!0;f.grid._sortNodes();t.each(f.grid.nodes,function(n){(f.container.append(n.el),f.opts.staticGrid)||((n.noMove||f.opts.disableDrag)&&f.dd.draggable(n.el,"disable"),(n.noResize||f.opts.disableResize)&&f.dd.resizable(n.el,"disable"),n.el.trigger("resize"))})}else{if(!h)return;if(f.container.removeClass(f.opts.oneColumnModeClass),h=!1,f.opts.staticGrid)return;t.each(f.grid.nodes,function(n){n.noMove||f.opts.disableDrag||f.dd.draggable(n.el,"enable");n.noResize||f.opts.disableResize||f.dd.resizable(n.el,"enable");n.el.trigger("resize")})}},n(window).resize(this.onResizeHandler),this.onResizeHandler(),!f.opts.staticGrid&&typeof f.opts.removable=="string"){s=n(f.opts.removable);this.dd.isDroppable(s)||this.dd.droppable(s,{accept:"."+f.opts.itemClass});this.dd.on(s,"dropover",function(t,i){var r=n(i.draggable),u=r.data("_gridstack_node");u._grid===f&&f._setupRemovingTimeout(r)}).on(s,"dropout",function(t,i){var r=n(i.draggable),u=r.data("_gridstack_node");u._grid===f&&f._clearRemovingTimeout(r)})}if(!f.opts.staticGrid&&f.opts.acceptWidgets){y=null;c=function(n,t){var e=y,i=e.data("_gridstack_node"),o=f.getCellFromPixel(t.offset,!0,n),r=Math.max(0,o.x),u=Math.max(0,o.y);if(i._added){if(!f.grid.canMoveNode(i,r,u))return;f.grid.moveNode(i,r,u);f._updateContainerHeight()}else i._added=!0,i.el=e,i.x=r,i.y=u,f.grid.cleanNodes(),f.grid.beginUpdate(i),f.grid.addNode(i),f.container.append(f.placeholder),f.placeholder.attr("data-gs-x",i.x).attr("data-gs-y",i.y).attr("data-gs-width",i.width).attr("data-gs-height",i.height).show(),i.el=f.placeholder,i._beforeDragX=i.x,i._beforeDragY=i.y,f._updateContainerHeight()};this.dd.droppable(f.container,{accept:function(t,i){t=n(t);var r=t.data("_gridstack_node");return r&&r._grid===f&&t.hasClass("grid-stack-item")?i==!0?!0:!1:t.is(f.opts.acceptWidgets===!0?".grid-stack-item":f.opts.acceptWidgets)}}).on(f.container,"dropover",function(t,i){var s=f.container.offset(),r=n(i.draggable),h=f.cellWidth(),l=f.cellHeight(),o=r.data("_gridstack_node"),u=4,e;(r[0].getAttribute("control-type")||"")==="schedule"&&(u=7);y=r;e=f.grid._prepareNode({width:8,height:u,_added:!1,_temporary:!0});r.data("_gridstack_node",e);r.data("_gridstack_node_orig",o);r.on("drag",c)}).on(f.container,"dropout",function(t,i){var r=n(i.draggable),u;r.unbind("drag",c);u=r.data("_gridstack_node");u.el=null;f.grid.removeNode(u);f.placeholder.detach();f._updateContainerHeight();r.data("_gridstack_node",r.data("_gridstack_node_orig"))}).on(f.container,"drop",function(t,i){var r,u,e;f.placeholder.detach();r=n(i.draggable).data("_gridstack_node");r._grid=f;u=!1;e=function(n){n!==!1?(n.data("_gridstack_node",r),r.el=n,f.placeholder.hide(),n.attr("data-gs-x",r.x).attr("data-gs-y",r.y).attr("data-gs-width",r.width).attr("data-gs-height",r.height).addClass(f.opts.itemClass).removeAttr("style").enableSelection().removeData("draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled").unbind("drag",c),f.container.append(n),f._prepareElementsByNode(n,r)):f.grid.removeNode(r);f._updateContainerHeight();f._triggerChangeEvent();f.grid.endUpdate()}.bind(this);f.opts.afterListDropCallback?f.opts.afterListDropCallback(n(i.draggable),r).then(function(n){e(n)}):(u=n(i.draggable).clone(!1),e(u))})}},i.prototype._triggerChangeEvent=function(n){var t=this.grid.getDirtyNodes(),i=!1,r=[];t&&t.length&&(r.push(t),i=!0);(i||n===!0)&&this.container.trigger("change",r)},i.prototype._triggerAddEvent=function(){this.grid._addedNodes&&this.grid._addedNodes.length>0&&(this.container.trigger("added",[t.map(this.grid._addedNodes,t.clone)]),this.grid._addedNodes=[])},i.prototype._triggerRemoveEvent=function(){this.grid._removedNodes&&this.grid._removedNodes.length>0&&(this.container.trigger("removed",[t.map(this.grid._removedNodes,t.clone)]),this.grid._removedNodes=[])},i.prototype._initStyles=function(){this._stylesId&&f.removeStylesheet(this._stylesId);this._stylesId="gridstack-style-"+(Math.random()*1e5).toFixed();this._styles=f.createStylesheet(this._stylesId);this._styles!==null&&(this._styles._max=0,this._styles._maxWidth=0)},i.prototype._updateStyles=function(n,t){var u,r,e,i;if(this._styles!==null&&typeof this._styles!="undefined"&&(u="."+this.opts._class+" ."+this.opts.itemClass,r=this,typeof n=="undefined"&&(n=this._styles._max,this._initStyles(),this._updateContainerHeight()),typeof t=="undefined"&&(t=this._styles._maxWidth,this._initStyles()),this.opts.cellHeight&&this.opts.cellWidth)&&(this._styles._max===0||!(n<=this._styles._max)||this._styles._maxWidth===0||!(t<=this._styles._maxWidth))){if(this.opts.verticalMargin&&this.opts.cellHeightUnit!==this.opts.verticalMarginUnit?(e=function(n,t){return!n||!t?r.opts.cellHeight*n+r.opts.verticalMargin*t+r.opts.cellHeightUnit:"calc("+(r.opts.cellHeight*n+r.opts.cellHeightUnit)+" + "+(r.opts.verticalMargin*t+r.opts.verticalMarginUnit)+")"},getWidth=function(n,t,i){return!n||!t?r.opts.cellWidth*n+r.opts.verticalMargin*t+r.opts.cellHeightUnit:"calc("+(r.opts.cellWidth*n+r.opts.cellHeightUnit)+" + "+((i==!0?r.opts.verticalMargin*t:0)+r.opts.verticalMarginUnit)+")"}):(e=function(n,t){return r.opts.cellHeight*n+r.opts.verticalMargin*t+r.opts.cellHeightUnit},getWidth=function(n,t,i){return r.opts.cellWidth*n+(i==!0?r.opts.verticalMargin*t:0)+r.opts.cellHeightUnit}),this._styles._max===0&&f.insertCSSRule(this._styles,u,"min-height: "+e(1,0)+";",0),n>this._styles._max){for(i=this._styles._max;i<n;++i)f.insertCSSRule(this._styles,u+'[data-gs-height="'+(i+1)+'"]',"height: "+e(i+1,i)+";",i),f.insertCSSRule(this._styles,u+'[data-gs-min-height="'+(i+1)+'"]',"min-height: "+e(i+1,i)+";",i),f.insertCSSRule(this._styles,u+'[data-gs-max-height="'+(i+1)+'"]',"max-height: "+e(i+1,i)+";",i),f.insertCSSRule(this._styles,u+'[data-gs-y="'+i+'"]',"top: "+e(i,i)+";",i);this._styles._max=n}if(t>this._styles._maxWidth){for(i=this._styles._maxWidth;i<t;++i)f.insertCSSRule(this._styles,u+'[data-gs-width="'+(i+1)+'"]',"width: "+getWidth(i+1,i)+";",i),f.insertCSSRule(this._styles,u+'[data-gs-min-width="'+(i+1)+'"]',"min-width: "+getWidth(i+1,i)+";",i),f.insertCSSRule(this._styles,u+'[data-gs-max-width="'+(i+1)+'"]',"max-width: "+getWidth(i+1,i)+";",i),f.insertCSSRule(this._styles,u+'[data-gs-x="'+i+'"]',"left: "+getWidth(i,i)+";",i);this._styles._maxWidth=t}}},i.prototype._updateContainerHeight=function(){var t=this.opts.getFrameHeight(),i=Math.round(t/(this.opts.cellHeight+this.opts.verticalMargin)),n;this.grid._updateCounter||(n=i,this.container.attr("data-gs-current-height",n),!this.opts.cellHeight)},i.prototype._isOneColumnMode=function(){return(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<=this.opts.minWidth},i.prototype._setupRemovingTimeout=function(t){var r=this,i=n(t).data("_gridstack_node");!i._removeTimeout&&r.opts.removable&&(i._removeTimeout=setTimeout(function(){t.addClass("grid-stack-item-removing");i._isAboutToRemove=!0},r.opts.removeTimeout))},i.prototype._clearRemovingTimeout=function(t){var i=n(t).data("_gridstack_node");i._removeTimeout&&(clearTimeout(i._removeTimeout),i._removeTimeout=null,t.removeClass("grid-stack-item-removing"),i._isAboutToRemove=!1)},i.prototype._prepareElementsByNode=function(t,i){if(typeof n.ui!="undefined"){var r=this,u,f,e=function(n,e){var o,s,h,c,l,a;if(r.scrollTop!=r.container.scrollTop()&&(e.position.top+=r.container.scrollTop()),o=Math.round(e.position.left/u),s=Math.floor((e.position.top+f/2)/f),n.type!="drag"&&(h=Math.round(e.size.width/u),c=Math.round(e.size.height/f)),n.type=="drag")o<0||o>=r.grid.width||s<0?(r.opts.removable===!0&&r._setupRemovingTimeout(t),o=i._beforeDragX,s=i._beforeDragY,r.placeholder.detach(),r.placeholder.hide(),r.grid.removeNode(i),r._updateContainerHeight(),i._temporaryRemoved=!0):(r._clearRemovingTimeout(t),i._temporaryRemoved&&(r.grid.addNode(i),r.placeholder.attr("data-gs-x",o).attr("data-gs-y",s).attr("data-gs-width",h).attr("data-gs-height",c).show(),r.container.append(r.placeholder),i.el=r.placeholder,i._temporaryRemoved=!1));else if(n.type=="resize"&&o<0)return;(l=typeof h!="undefined"?h:i.lastTriedWidth,a=typeof c!="undefined"?c:i.lastTriedHeight,r.grid.canMoveNode(i,o,s,h,c)&&(i.lastTriedX!==o||i.lastTriedY!==s||i.lastTriedWidth!==l||i.lastTriedHeight!==a))&&(i.lastTriedX=o,i.lastTriedY=s,i.lastTriedWidth=h,i.lastTriedHeight=c,r.grid.moveNode(i,o,s,h,c),r._updateContainerHeight())},o=function(e){var o,s;r.scrollTop=r.container.scrollTop();r.container.append(r.placeholder);o=n(this);r.grid.cleanNodes();r.grid.beginUpdate(i);u=r.cellWidth();s=Math.ceil(o.outerHeight()/o.attr("data-gs-height"));f=r.container.height()/parseInt(r.container.attr("data-gs-current-height"));r.placeholder.attr("data-gs-x",o.attr("data-gs-x")).attr("data-gs-y",o.attr("data-gs-y")).attr("data-gs-width",o.attr("data-gs-width")).attr("data-gs-height",o.attr("data-gs-height")).show();i.el=r.placeholder;i._beforeDragX=i.x;i._beforeDragY=i.y;r.dd.resizable(t,"option","minWidth",u*(i.minWidth||1));r.dd.resizable(t,"option","minHeight",s*(i.minHeight||1));e.type=="resizestart"&&o.find(".grid-stack-item").trigger("resizestart");r.opts.beforeMoveCallback&&r.opts.beforeMoveCallback(o)},s=function(u){var f=n(this),e,o;f.data("_gridstack_node")&&(e=!1,r.placeholder.detach(),i.el=f,r.placeholder.hide(),i._isAboutToRemove?(e=!0,t.removeData("_gridstack_node"),t.remove()):(r._clearRemovingTimeout(t),i._temporaryRemoved?(f.attr("data-gs-x",i._beforeDragX).attr("data-gs-y",i._beforeDragY).attr("data-gs-width",i.width).attr("data-gs-height",i.height).removeAttr("style"),i.x=i._beforeDragX,i.y=i._beforeDragY,r.grid.addNode(i)):f.attr("data-gs-x",i.x).attr("data-gs-y",i.y).attr("data-gs-width",i.width).attr("data-gs-height",i.height).removeAttr("style")),r._updateContainerHeight(),r._triggerChangeEvent(e),r.grid.endUpdate(),o=f.find(".grid-stack"),o.length&&u.type=="resizestop"&&(o.each(function(t,i){n(i).data("gridstack").onResizeHandler()}),f.find(".grid-stack-item").trigger("resizestop")),u.type=="resizestop"&&f.attr("data-gs-originheight",f.attr("data-gs-height")),r.opts.afterMoveCallback&&r.opts.afterMoveCallback(f))};this.dd.draggable(t,{start:o,stop:s,drag:e}).resizable(t,{start:o,stop:s,resize:e});(i.noMove||this._isOneColumnMode()||this.opts.disableDrag)&&this.dd.draggable(t,"disable");(i.noResize||this._isOneColumnMode()||this.opts.disableResize)&&this.dd.resizable(t,"disable");t.attr("data-gs-locked",i.locked?"yes":null)}},i.prototype._prepareElement=function(t,i){var r,u;i=typeof i!="undefined"?i:!1;r=this;t=n(t);t.addClass(this.opts.itemClass);u=r.grid.addNode({x:t.attr("data-gs-x"),y:t.attr("data-gs-y"),width:t.attr("data-gs-width"),height:t.attr("data-gs-height"),maxWidth:t.attr("data-gs-max-width"),minWidth:t.attr("data-gs-min-width"),maxHeight:t.attr("data-gs-max-height"),minHeight:t.attr("data-gs-min-height"),autoPosition:f.toBool(t.attr("data-gs-auto-position")),noResize:f.toBool(t.attr("data-gs-no-resize")),noMove:f.toBool(t.attr("data-gs-no-move")),locked:f.toBool(t.attr("data-gs-locked")),el:t,id:t.attr("data-gs-id"),_grid:r},i);t.data("_gridstack_node",u);this._prepareElementsByNode(t,u)},i.prototype.setAnimation=function(n){n?this.container.addClass("grid-stack-animate"):this.container.removeClass("grid-stack-animate")},i.prototype.addWidget=function(t,i,r,u,f,e,o,s,h,c,l){return t=n(t),typeof i!="undefined"&&t.attr("data-gs-x",i),typeof r!="undefined"&&t.attr("data-gs-y",r),typeof u!="undefined"&&t.attr("data-gs-width",u),typeof f!="undefined"&&t.attr("data-gs-height",f),typeof e!="undefined"&&t.attr("data-gs-auto-position",e?"yes":null),typeof o!="undefined"&&t.attr("data-gs-min-width",o),typeof s!="undefined"&&t.attr("data-gs-max-width",s),typeof h!="undefined"&&t.attr("data-gs-min-height",h),typeof c!="undefined"&&t.attr("data-gs-max-height",c),typeof l!="undefined"&&t.attr("data-gs-id",l),this.container.append(t),this._prepareElement(t,!0),this._triggerAddEvent(),this._updateContainerHeight(),this._triggerChangeEvent(!0),t},i.prototype.makeWidget=function(t){return t=n(t),this._prepareElement(t,!0),this._triggerAddEvent(),this._updateContainerHeight(),this._triggerChangeEvent(!0),t},i.prototype.willItFit=function(n,t,i,r,u){var f={x:n,y:t,width:i,height:r,autoPosition:u};return this.grid.canBePlacedWithRespectToHeight(f)},i.prototype.removeWidget=function(t,i){i=typeof i=="undefined"?!0:i;t=n(t);var r=t.data("_gridstack_node");r||(r=this.grid.getNodeDataByDOMEl(t));this.grid.removeNode(r,i);t.removeData("_gridstack_node");this._updateContainerHeight();i&&t.remove();this._triggerChangeEvent(!0);this._triggerRemoveEvent()},i.prototype.removeAll=function(n){t.each(this.grid.nodes,t.bind(function(t){this.removeWidget(t.el,n)},this));this.grid.nodes=[];this._updateContainerHeight()},i.prototype.destroy=function(t){n(window).off("resize",this.onResizeHandler);this.disable();typeof t=="undefined"||t?this.container.remove():(this.removeAll(!1),this.container.removeData("gridstack"));f.removeStylesheet(this._stylesId);this.grid&&(this.grid=null)},i.prototype.resizable=function(t,i){var r=this;return t=n(t),t.each(function(t,u){u=n(u);var f=u.data("_gridstack_node");typeof f!="undefined"&&f!==null&&typeof n.ui!="undefined"&&(f.noResize=!(i||!1),f.noResize||r._isOneColumnMode()?r.dd.resizable(u,"disable"):r.dd.resizable(u,"enable"))}),this},i.prototype.movable=function(t,i){var r=this;return t=n(t),t.each(function(t,u){u=n(u);var f=u.data("_gridstack_node");typeof f!="undefined"&&f!==null&&typeof n.ui!="undefined"&&(f.noMove=!(i||!1),f.noMove||r._isOneColumnMode()?(r.dd.draggable(u,"disable"),u.removeClass("ui-draggable-handle")):(r.dd.draggable(u,"enable"),u.addClass("ui-draggable-handle")))}),this},i.prototype.enableMove=function(n,t){this.movable(this.container.children("."+this.opts.itemClass),n);t&&(this.opts.disableDrag=!n)},i.prototype.enableResize=function(n,t){this.resizable(this.container.children("."+this.opts.itemClass),n);t&&(this.opts.disableResize=!n)},i.prototype.disable=function(){this.movable(this.container.children("."+this.opts.itemClass),!1);this.resizable(this.container.children("."+this.opts.itemClass),!1);this.container.trigger("disable")},i.prototype.enable=function(){this.movable(this.container.children("."+this.opts.itemClass),!0);this.resizable(this.container.children("."+this.opts.itemClass),!0);this.container.trigger("enable")},i.prototype.locked=function(t,i){return t=n(t),t.each(function(t,r){r=n(r);var u=r.data("_gridstack_node");typeof u!="undefined"&&u!==null&&(u.locked=i||!1,r.attr("data-gs-locked",u.locked?"yes":null))}),this},i.prototype.maxHeight=function(t,i){return t=n(t),t.each(function(t,r){r=n(r);var u=r.data("_gridstack_node");typeof u!="undefined"&&u!==null&&(isNaN(i)||(u.maxHeight=i||!1,r.attr("data-gs-max-height",i)))}),this},i.prototype.minHeight=function(t,i){return t=n(t),t.each(function(t,r){r=n(r);var u=r.data("_gridstack_node");typeof u!="undefined"&&u!==null&&(isNaN(i)||(u.minHeight=i||!1,r.attr("data-gs-min-height",i)))}),this},i.prototype.maxWidth=function(t,i){return t=n(t),t.each(function(t,r){r=n(r);var u=r.data("_gridstack_node");typeof u!="undefined"&&u!==null&&(isNaN(i)||(u.maxWidth=i||!1,r.attr("data-gs-max-width",i)))}),this},i.prototype.minWidth=function(t,i){return t=n(t),t.each(function(t,r){r=n(r);var u=r.data("_gridstack_node");typeof u!="undefined"&&u!==null&&(isNaN(i)||(u.minWidth=i||!1,r.attr("data-gs-min-width",i)))}),this},i.prototype._updateElement=function(t,i){var u,r;(t=n(t).first(),u=t.data("_gridstack_node"),typeof u!="undefined"&&u!==null)&&(r=this,r.grid.cleanNodes(),r.grid.beginUpdate(u),i.call(this,t,u),r._updateContainerHeight(),r._triggerChangeEvent(),r.grid.endUpdate())},i.prototype.resize=function(n,t,i){this._updateElement(n,function(n,r){t=t!==null&&typeof t!="undefined"?t:r.width;i=i!==null&&typeof i!="undefined"?i:r.height;this.grid.moveNode(r,r.x,r.y,t,i)})},i.prototype.move=function(n,t,i){this._updateElement(n,function(n,r){t=t!==null&&typeof t!="undefined"?t:r.x;i=i!==null&&typeof i!="undefined"?i:r.y;this.grid.moveNode(r,t,i,r.width,r.height)})},i.prototype.update=function(n,t,i,r,u){this._updateElement(n,function(n,f){t=t!==null&&typeof t!="undefined"?t:f.x;i=i!==null&&typeof i!="undefined"?i:f.y;r=r!==null&&typeof r!="undefined"?r:f.width;u=u!==null&&typeof u!="undefined"?u:f.height;this.grid.moveNode(f,t,i,r,u)})},i.prototype.verticalMargin=function(n,t){if(typeof n=="undefined")return this.opts.verticalMargin;var i=f.parseHeight(n);(this.opts.verticalMarginUnit!==i.unit||this.opts.height!==i.height)&&(this.opts.verticalMarginUnit=i.unit,this.opts.verticalMargin=i.height,t||this._updateStyles())},i.prototype.cellHeight=function(n,t){var r,i;if(typeof n=="undefined")return this.opts.cellHeight?this.opts.cellHeight:(r=this.container.children("."+this.opts.itemClass).first(),Math.ceil(r.outerHeight()/r.attr("data-gs-height")));(i=f.parseHeight(n),this.opts.cellHeightUnit!==i.heightUnit||this.opts.height!==i.height)&&(this.opts.cellHeightUnit=i.unit,this.opts.cellHeight=i.height,t||this._updateStyles())},i.prototype.cellWidth=function(){return this.opts.cellWidth},i.prototype.getCellFromPixel=function(n,t,i){var o=typeof t!="undefined"&&t?this.container.offset():this.container.position(),r=i.clientX,u=i.clientY,f=this.cellWidth(),e=Math.floor(this.container.height()/parseInt(this.container.attr("data-gs-current-height")));return{x:Math.floor(r/f),y:Math.floor(u/e)}},i.prototype.batchUpdate=function(){this.grid.batchUpdate()},i.prototype.commit=function(){this.grid.commit();this._updateContainerHeight()},i.prototype.isAreaEmpty=function(n,t,i,r){return this.grid.isAreaEmpty(n,t,i,r)},i.prototype.setStatic=function(n){this.opts.staticGrid=n===!0;this.enableMove(!n);this.enableResize(!n);this._setStaticClass()},i.prototype._setStaticClass=function(){var n="grid-stack-static";this.opts.staticGrid===!0?this.container.addClass(n):this.container.removeClass(n)},i.prototype._updateNodeWidths=function(n,t){var i,r;for(this.grid._sortNodes(),this.grid.batchUpdate(),i={},r=0;r<this.grid.nodes.length;r++)i=this.grid.nodes[r],this.update(i.el,Math.round(i.x*t/n),undefined,Math.round(i.width*t/n),undefined);this.grid.commit()},i.prototype.setGridWidth=function(n,t){this.container.removeClass("grid-stack-"+this.opts.width);t!==!0&&this._updateNodeWidths(this.opts.width,n);this.opts.width=n;this.grid.width=n;this.container.addClass("grid-stack-"+n)},r.prototype.batch_update=u(r.prototype.batchUpdate),r.prototype._fix_collisions=u(r.prototype._fixCollisions,"_fix_collisions","_fixCollisions"),r.prototype.is_area_empty=u(r.prototype.isAreaEmpty,"is_area_empty","isAreaEmpty"),r.prototype._sort_nodes=u(r.prototype._sortNodes,"_sort_nodes","_sortNodes"),r.prototype._pack_nodes=u(r.prototype._packNodes,"_pack_nodes","_packNodes"),r.prototype._prepare_node=u(r.prototype._prepareNode,"_prepare_node","_prepareNode"),r.prototype.clean_nodes=u(r.prototype.cleanNodes,"clean_nodes","cleanNodes"),r.prototype.get_dirty_nodes=u(r.prototype.getDirtyNodes,"get_dirty_nodes","getDirtyNodes"),r.prototype.add_node=u(r.prototype.addNode,"add_node","addNode, "),r.prototype.remove_node=u(r.prototype.removeNode,"remove_node","removeNode"),r.prototype.can_move_node=u(r.prototype.canMoveNode,"can_move_node","canMoveNode"),r.prototype.move_node=u(r.prototype.moveNode,"move_node","moveNode"),r.prototype.get_grid_height=u(r.prototype.getGridHeight,"get_grid_height","getGridHeight"),r.prototype.begin_update=u(r.prototype.beginUpdate,"begin_update","beginUpdate"),r.prototype.end_update=u(r.prototype.endUpdate,"end_update","endUpdate"),r.prototype.can_be_placed_with_respect_to_height=u(r.prototype.canBePlacedWithRespectToHeight,"can_be_placed_with_respect_to_height","canBePlacedWithRespectToHeight"),i.prototype._trigger_change_event=u(i.prototype._triggerChangeEvent,"_trigger_change_event","_triggerChangeEvent"),i.prototype._init_styles=u(i.prototype._initStyles,"_init_styles","_initStyles"),i.prototype._update_styles=u(i.prototype._updateStyles,"_update_styles","_updateStyles"),i.prototype._update_container_height=u(i.prototype._updateContainerHeight,"_update_container_height","_updateContainerHeight"),i.prototype._is_one_column_mode=u(i.prototype._isOneColumnMode,"_is_one_column_mode","_isOneColumnMode"),i.prototype._prepare_element=u(i.prototype._prepareElement,"_prepare_element","_prepareElement"),i.prototype.set_animation=u(i.prototype.setAnimation,"set_animation","setAnimation"),i.prototype.add_widget=u(i.prototype.addWidget,"add_widget","addWidget"),i.prototype.make_widget=u(i.prototype.makeWidget,"make_widget","makeWidget"),i.prototype.will_it_fit=u(i.prototype.willItFit,"will_it_fit","willItFit"),i.prototype.remove_widget=u(i.prototype.removeWidget,"remove_widget","removeWidget"),i.prototype.remove_all=u(i.prototype.removeAll,"remove_all","removeAll"),i.prototype.min_height=u(i.prototype.minHeight,"min_height","minHeight"),i.prototype.min_width=u(i.prototype.minWidth,"min_width","minWidth"),i.prototype._update_element=u(i.prototype._updateElement,"_update_element","_updateElement"),i.prototype.cell_height=u(i.prototype.cellHeight,"cell_height","cellHeight"),i.prototype.cell_width=u(i.prototype.cellWidth,"cell_width","cellWidth"),i.prototype.get_cell_from_pixel=u(i.prototype.getCellFromPixel,"get_cell_from_pixel","getCellFromPixel"),i.prototype.batch_update=u(i.prototype.batchUpdate,"batch_update","batchUpdate"),i.prototype.is_area_empty=u(i.prototype.isAreaEmpty,"is_area_empty","isAreaEmpty"),i.prototype.set_static=u(i.prototype.setStatic,"set_static","setStatic"),i.prototype._set_static_class=u(i.prototype._setStaticClass,"_set_static_class","_setStaticClass"),s.GridStackUI=i,s.GridStackUI.Utils=f,s.GridStackUI.Engine=r,s.GridStackUI.GridStackDragDropPlugin=e,n.fn.gridstack=function(t){return this.each(function(){var r=n(this);r.data("gridstack")||r.data("gridstack",new i(this,t))})},s.GridStackUI}),function(n){if(typeof define=="function"&&define.amd)define(["jquery","lodash","gridstack","jquery-ui/data","jquery-ui/disable-selection","jquery-ui/focusable","jquery-ui/form","jquery-ui/ie","jquery-ui/keycode","jquery-ui/labels","jquery-ui/jquery-1-7","jquery-ui/plugin","jquery-ui/safe-active-element","jquery-ui/safe-blur","jquery-ui/scroll-parent","jquery-ui/tabbable","jquery-ui/unique-id","jquery-ui/version","jquery-ui/widget","jquery-ui/widgets/mouse","jquery-ui/widgets/draggable","jquery-ui/widgets/droppable","jquery-ui/widgets/resizable"],n);else if(typeof module=="object"&&typeof module.exports=="object"){try{jQuery=require("jquery")}catch(t){}try{_=require("lodash")}catch(t){}try{GridStackUI=require("gridstack")}catch(t){}n(jQuery,_,GridStackUI)}else n(jQuery,_,GridStackUI)}(function(n,t,i){function r(n){i.GridStackDragDropPlugin.call(this,n)}var u=window;return i.GridStackDragDropPlugin.registerPlugin(r),r.prototype=Object.create(i.GridStackDragDropPlugin.prototype),r.prototype.constructor=r,r.prototype.resizable=function(i,r){if(i=n(i),r==="disable"||r==="enable")i.resizable(r);else if(r==="option"){var u=arguments[2],f=arguments[3];i.resizable(r,u,f)}else i.resizable(t.extend({},this.grid.opts.resizable,{start:r.start||function(){},stop:r.stop||function(){},resize:r.resize||function(){}}));return this},r.prototype.draggable=function(i,r){return i=n(i),r==="disable"||r==="enable"?i.draggable(r):i.draggable(t.extend({},this.grid.opts.draggable,{containment:this.grid.opts.isNested?this.grid.container.parent():null,start:r.start||function(){},stop:r.stop||function(){},drag:r.drag||function(){}})),this},r.prototype.droppable=function(t,i){return t=n(t),i==="disable"||i==="enable"?t.droppable(i):t.droppable({accept:i.accept}),this},r.prototype.isDroppable=function(t){return t=n(t),Boolean(t.data("droppable"))},r.prototype.on=function(t,i,r){n(t).on(i,r);return this},r});